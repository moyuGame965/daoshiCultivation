<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é“å£«ä¿®ç‚¼æ¨¡æ‹Ÿå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            background-color: #f3ece7;
            /* background-image: url('https://img.freepik.com/free-photo/chinese-pavilion-mountains_1150-17812.jpg'); */
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            padding: 10px;
            font-size: 16px;
            /* æ·»åŠ é»˜è®¤å­—ä½“å¤§å° */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
            /* å¢å¼ºé˜´å½±æ•ˆæœ */
            backdrop-filter: blur(5px);
            /* æ·»åŠ èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
            -webkit-backdrop-filter: blur(5px);
            /* Safariæ”¯æŒ */
        }

        header {
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        h1 {
            color: #8b4513;
            font-size: 1.8em;
            text-shadow: 1px 1px 2px #ccc;
        }

        .section {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border-left: 4px solid #8b4513;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .section-header {
            background-color: rgba(139, 69, 19, 0.1);
            padding: 10px 15px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
        }

        .section-content {
            padding: 15px;
        }

        h2 {
            color: #8b4513;
            margin: 0;
            font-size: 1.3em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
        }

        .stat {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.95em;
            transition: all 0.2s;
        }

        .stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stat-name {
            font-weight: bold;
            color: #555;
        }

        .stat-value {
            float: right;
            color: #8b4513;
            font-weight: bold;
        }

        .activities {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .activity {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .activity:hover,
        .activity:active {
            background-color: #e9e9e9;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .activity.active {
            background-color: rgba(139, 69, 19, 0.15);
            border-color: #8b4513;
            box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.3);
        }

        .activity.locked {
            background-color: #f0f0f0;
            opacity: 0.7;
            cursor: not-allowed;
            position: relative;
            overflow: hidden;
        }

        .activity.locked::before {
            content: "ğŸ”’";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            color: #8b4513;
        }

        .activity.locked::after {
            content: "æœªè§£é”";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 5px;
            background-color: rgba(139, 69, 19, 0.5);
            color: white;
            font-size: 0.8em;
            text-align: center;
        }

        .unlock-tooltip {
            position: absolute;
            bottom: 25px;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px;
            font-size: 0.75em;
            border-radius: 4px;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            text-align: left;
            line-height: 1.4;
        }

        .activity.locked:hover .unlock-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .activity-name {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        .activity-desc {
            font-size: 0.85em;
            color: #777;
            flex-grow: 1;
        }

        /* çŠ¶æ€å’Œæ—¥å¿—éƒ¨åˆ†æ–°æ ·å¼ */
        .afk-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .status-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .current-status {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .status-icon {
            width: 40px;
            height: 40px;
            background-color: #8b4513;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 1.2em;
        }

        .status-details {
            flex-grow: 1;
        }

        .status-title {
            font-weight: bold;
            color: #555;
        }

        .status-value {
            color: #8b4513;
        }

        .status-time {
            font-size: 0.9em;
            color: #777;
        }

        .afk-active {
            background-color: rgba(139, 69, 19, 0.15);
            border-color: #8b4513;
            box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.3);
        }

        .afk-active .status-icon {
            background-color: #a0522d;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .btn {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            width: 100%;
            -webkit-appearance: none;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(139, 69, 19, 0.3);
        }

        .btn:hover,
        .btn:active {
            background-color: #a0522d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(139, 69, 19, 0.4);
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .logs {
            height: 230px;
            overflow-y: auto;
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.9em;
            -webkit-overflow-scrolling: touch;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 10px;
        }

        .log-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .log-entry:before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background-color: #8b4513;
            border-radius: 2px;
        }

        .log-entry.system {
            color: #888;
            font-style: italic;
            font-size: 0.9em;
        }

        .log-entry.system:before {
            background-color: #888;
        }

        .time {
            float: right;
            color: #999;
            font-size: 0.8em;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tab-container {
            display: flex;
            flex-direction: column;
            border-radius: 5px;
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            border-radius: 5px 5px 0 0;
        }

        .tab {
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f5f5f5;
            color: #666;
            font-weight: bold;
            text-align: center;
            flex-grow: 1;
            border-right: 1px solid #ddd;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab:hover {
            background-color: #e9e9e9;
        }

        .tab.active {
            background-color: #fff;
            color: #8b4513;
            border-bottom: 3px solid #8b4513;
        }

        .tab-content {
            display: none;
            background-color: #fff;
            padding: 15px;
            border-radius: 0 0 5px 5px;
            border: 1px solid #ddd;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .challenges {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .challenge {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            transition: all 0.3s;
        }

        .challenge:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .challenge-name {
            font-weight: bold;
            color: #555;
        }

        .challenge-desc {
            font-size: 0.85em;
            color: #777;
            margin-top: 3px;
        }

        .challenge-progress {
            margin-top: 8px;
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .challenge-progress-bar {
            height: 100%;
            background-color: #8b4513;
            width: 0%;
            transition: width 0.5s;
        }

        .event {
            background-color: #fff8e1;
            border-left: 4px solid #ffd54f;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .event-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        #event-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        #event-options .btn {
            margin-top: 0;
        }

        @media (max-width: 700px) {
            .afk-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 10px;
                border-radius: 8px;
                gap: 10px;
            }

            h1 {
                font-size: 1.5em;
            }

            h2 {
                font-size: 1.2em;
            }

            .tab {
                padding: 10px 8px;
                font-size: 0.9em;
            }

            .activity {
                min-height: 70px;
                padding: 10px;
            }

            .activity-name {
                font-size: 0.9em;
            }

            .activity-desc {
                font-size: 0.8em;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .activities {
                grid-template-columns: repeat(2, 1fr);
            }

            .btn {
                padding: 12px 10px;
                font-size: 0.95em;
            }

            .logs {
                height: 180px;
            }

            .log-entry {
                font-size: 0.9em;
            }

            .event {
                width: 95%;
                padding: 12px;
            }
        }

        @media (max-width: 320px) {

            .stats-grid,
            .activities {
                grid-template-columns: 1fr;
            }

            .activity {
                min-height: auto;
            }
        }

        /* è‡ªåŠ¨ä¿å­˜æç¤ºæ ·å¼ */
        .save-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(92, 184, 92, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 0.9em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            animation: fadeInOut 2s ease-in-out;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            20% {
                opacity: 1;
                transform: translateY(0);
            }

            80% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 0;
                transform: translateY(-20px);
            }
        }

        /* æ·»åŠ æ·±è‰²æ¨¡å¼æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            body {
                color: #f0f0f0;
            }

            .container {
                background-color: rgba(40, 40, 40, 0.9);
                color: #f0f0f0;
            }
        }

        /* æ·»åŠ å“åº”å¼è®¾è®¡å¢å¼º */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
        }
    </style>
</head>

<body>
    

    <div class="container">
        <header>
            <h1>é“å£«ä¿®ç‚¼æŒ‚æœºæ¨¡æ‹Ÿå™¨</h1>
            <p>ä½“éªŒé“å£«çš„ä¿®ç‚¼ä¹‹æ—…ï¼Œæ„Ÿæ‚Ÿå¤©åœ°è‡ªç„¶</p>
            <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                <button class="btn" id="reset-game"
                    style="width: auto; padding: 5px 10px; background-color: #d9534f;">é‡ç½®æ¸¸æˆ</button>
                <div class="game-settings">
                    <button class="btn" id="toggle-settings"
                        style="width: auto; padding: 5px 10px; background-color: #5bc0de;">è®¾ç½®</button>
                    <div id="settings-panel"
                        style="display: none; position: absolute; right: 15px; background: white; border: 1px solid #ddd; border-radius: 5px; padding: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; width: 200px;">
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="sound-toggle" style="margin-right: 8px;">
                                <span>å¯ç”¨éŸ³æ•ˆ</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="auto-save-toggle" style="margin-right: 8px;" checked>
                                <span>è‡ªåŠ¨ä¿å­˜</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px;">è‡ªåŠ¨ä¿å­˜é¢‘ç‡ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <select id="auto-save-interval"
                                style="width: 100%; padding: 5px; border-radius: 3px; border: 1px solid #ddd;">
                                <option value="1">1åˆ†é’Ÿ</option>
                                <option value="3">3åˆ†é’Ÿ</option>
                                <option value="5">5åˆ†é’Ÿ</option>
                                <option value="10">10åˆ†é’Ÿ</option>
                            </select>
                        </div>
                        <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                            <button class="btn" id="clear-cache"
                                style="width: 100%; padding: 5px; background-color: #f0ad4e; margin-bottom: 5px;">æ¸…ç†ç¼“å­˜</button>
                            <button class="btn" id="export-save"
                                style="width: 100%; padding: 5px; background-color: #5cb85c; margin-bottom: 5px;">å¯¼å‡ºå­˜æ¡£</button>
                            <button class="btn" id="import-save"
                                style="width: 100%; padding: 5px; background-color: #5bc0de; margin-bottom: 5px;">å¯¼å…¥å­˜æ¡£</button>
                            <input type="file" id="save-file-input" style="display:none" accept=".json">
                        </div>
                        <!-- ç§»é™¤å­˜æ¡£æ§½ä½åŠŸèƒ½ -->
                    </div>
                </div>
            </div>
        </header>

        <div class="section">
            <div class="section-header">
                <h2>é“é•¿ä¿¡æ¯</h2>
            </div>
            <div class="section-content">
                <div class="stats-grid">
                    <div class="stat">
                        <span class="stat-name">é“å·</span>
                        <span class="stat-value" id="name">æ¸…è™šå­</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">å¢ƒç•Œ</span>
                        <span class="stat-value" id="level">åˆå…¥é“é—¨</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">ä¿®ä¸º</span>
                        <span class="stat-value"><span id="cultivation">0</span></span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">ç²¾ç¥åŠ›</span>
                        <span class="stat-value"><span id="spirit">10</span>/100</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">ä½“åŠ›</span>
                        <span class="stat-value"><span id="energy">100</span>/100</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">æ‚Ÿæ€§</span>
                        <span class="stat-value" id="enlightenment">1</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">ç¦ç¼˜</span>
                        <span class="stat-value" id="luck">1</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">é“æ³•</span>
                        <span class="stat-value" id="taoism">1</span>
                    </div>
                </div>
                <!-- ç§»é™¤äº†åŸæ¥ä½ç½®çš„é‡ç½®æ¸¸æˆæŒ‰é’® -->
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µç³»ç»Ÿ -->
        <div class="section">
            <div class="tab-container">
                <div class="tab-nav">
                    <div class="tab active" data-tab="cultivation">å½“å‰ä¿®ç‚¼</div>
                    <div class="tab" data-tab="challenges">æŒ‚æœºæŒ‘æˆ˜</div>
                    <div class="tab" data-tab="inventory">é“å…·ä»“åº“</div>
                </div>

                <div class="tab-content active" id="cultivation-tab">
                    <div class="section-content">
                        <div class="activities">
                            <div class="activity" data-activity="meditation">
                                <div class="activity-name">ç›˜åå†¥æƒ³</div>
                                <div class="activity-desc">é™åå†¥æƒ³ï¼Œæå‡ç²¾ç¥åŠ›å’Œä¿®ä¸º</div>
                            </div>
                            <div class="activity" data-activity="reading">
                                <div class="activity-name">ç ”è¯»é“ç»</div>
                                <div class="activity-desc">é˜…è¯»å¤ç±ï¼Œæå‡æ‚Ÿæ€§å’Œé“æ³•</div>
                            </div>
                            <div class="activity" data-activity="breathing">
                                <div class="activity-name">åçº³æ³•</div>
                                <div class="activity-desc">ä¿®ç‚¼å‘¼å¸æ³•é—¨ï¼Œæ¢å¤ä½“åŠ›å’Œç²¾ç¥åŠ›</div>
                            </div>
                            <div class="activity" data-activity="tea">
                                <div class="activity-name">å“èŒ—æ‚Ÿé“</div>
                                <div class="activity-desc">å“èŒ¶é™æ€ï¼Œæå‡æ‚Ÿæ€§å’Œç¦ç¼˜</div>
                            </div>
                            <div class="activity" data-activity="talisman">
                                <div class="activity-name">ç‚¼åˆ¶ç¬¦ç®“</div>
                                <div class="activity-desc">ç»˜åˆ¶é“ç¬¦ï¼Œæå‡é“æ³•å’Œä¿®ä¸º</div>
                            </div>
                            <div class="activity" data-activity="herbs">
                                <div class="activity-name">é‡‡é›†è¯è‰</div>
                                <div class="activity-desc">å±±ä¸­é‡‡è¯ï¼Œæå‡ä½“åŠ›å’Œç¦ç¼˜</div>
                            </div>
                            <div class="activity" data-activity="teaching" data-requirement="taoism:5">
                                <div class="activity-name">æˆå¾’è®²é“</div>
                                <div class="activity-desc">ä¼ é“æˆä¸šï¼Œè·å¾—çµçŸ³å’Œæå‡é“æ³•</div>
                            </div>
                            <div class="activity" data-activity="alchemy"
                                data-requirement="cultivation:200,enlightenment:3">
                                <div class="activity-name">ç‚¼ä¸¹ä¿®ç‚¼</div>
                                <div class="activity-desc">ç‚¼åˆ¶ä¸¹è¯ï¼Œæå‡ä¿®ä¸ºå’Œæ‚Ÿæ€§</div>
                            </div>
                            <div class="activity" data-activity="swordsmanship" data-requirement="energy:120">
                                <div class="activity-name">å‰‘æœ¯ä¿®ç‚¼</div>
                                <div class="activity-desc">ä¿®ç‚¼å‰‘æ³•ï¼Œæå‡ä½“åŠ›ä¸Šé™</div>
                            </div>
                            <div class="activity" data-activity="waterfall" data-requirement="level:ä¿®è¡Œå°æˆ">
                                <div class="activity-name">ç€‘å¸ƒå†¥æƒ³</div>
                                <div class="activity-desc">åœ¨ç€‘å¸ƒä¸‹é™ä¿®ï¼Œå¤§å¹…æå‡ç²¾ç¥åŠ›</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="challenges-tab">
                    <div class="section-content">
                        <div class="challenges" id="challenges-container">
                            <div class="challenge">
                                <div class="challenge-name">åˆå…¥é“é—¨</div>
                                <div class="challenge-desc">ç´¯ç§¯ä¿®ç‚¼100ç‚¹ä¿®ä¸º</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-1" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">å°æœ‰æ‰€æˆ</div>
                                <div class="challenge-desc">æ‚Ÿæ€§è¾¾åˆ°5ç‚¹</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-2" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">å¾—é“é«˜äºº</div>
                                <div class="challenge-desc">é“æ³•è¾¾åˆ°10ç‚¹</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-3" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">ä½“é­„å¼ºå¥</div>
                                <div class="challenge-desc">ä½“åŠ›ä¸Šé™è¾¾åˆ°150ç‚¹</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-4" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">ç²¾ç¥é¥±æ»¡</div>
                                <div class="challenge-desc">ç²¾ç¥åŠ›ä¸Šé™è¾¾åˆ°150ç‚¹</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-5" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">å¹¿ç§¯ç¦ç¼˜</div>
                                <div class="challenge-desc">ç¦ç¼˜è¾¾åˆ°10ç‚¹</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-6" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">é“è¡Œç²¾æ·±</div>
                                <div class="challenge-desc">è¾¾åˆ°ç­‘åŸºæœŸå¢ƒç•Œ</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-7" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">ä¸¹è¯å¤§å¸ˆ</div>
                                <div class="challenge-desc">ç‚¼åˆ¶10é¢—ä¸¹è¯</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-8" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">ç¬¦ç®“å®—å¸ˆ</div>
                                <div class="challenge-desc">åˆ¶ä½œ20å¼ çµç¬¦</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-9" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="inventory-tab">
                    <div class="section-content">
                        <div class="stats-grid">
                            <div class="stat">
                                <span class="stat-name">è¯æ</span>
                                <span class="stat-value" id="herbs-count">0</span>
                            </div>
                            <div class="stat">
                                <span class="stat-name">çµç¬¦</span>
                                <span class="stat-value" id="talismans-count">0</span>
                            </div>
                            <div class="stat">
                                <span class="stat-name">ä¸¹è¯</span>
                                <span class="stat-value" id="potions-count">0</span>
                            </div>
                            <div class="stat">
                                <span class="stat-name">çµçŸ³</span>
                                <span class="stat-value" id="stones-count">0</span>
                            </div>
                        </div>
                        <div style="margin-top:15px">
                            <button class="btn" id="use-potion" onclick="usePotion()">æœç”¨ä¸¹è¯</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æŒ‚æœºçŠ¶æ€å’Œä¿®ç‚¼è®°å½• -->
        <div class="afk-container">
            <div class="section">
                <div class="section-header">
                    <h2>æŒ‚æœºçŠ¶æ€</h2>
                </div>
                <div class="section-content status-section">
                    <div class="current-status">
                        <div class="status-icon">âš¡</div>
                        <div class="status-details">
                            <div class="status-title">å½“å‰çŠ¶æ€</div>
                            <div class="status-value" id="current-activity">é—²æ•£</div>
                        </div>
                    </div>

                    <div class="current-status">
                        <div class="status-icon">â±ï¸</div>
                        <div class="status-details">
                            <div class="status-title">ä¿®ç‚¼æ—¶é—´</div>
                            <div class="status-value"><span id="time-passed">0</span> åˆ†é’Ÿ</div>
                        </div>
                    </div>

                    <div class="current-status" id="afk-status">
                        <div class="status-icon">ğŸ”„</div>
                        <div class="status-details">
                            <div class="status-title">æŒ‚æœºçŠ¶æ€</div>
                            <div class="status-value">æœªå¼€å§‹</div>
                        </div>
                    </div>

                    <button class="btn" id="toggle-afk">å¼€å§‹æŒ‚æœºä¿®ç‚¼</button>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>ä¿®ç‚¼è®°å½•</h2>
                </div>
                <div class="section-content">
                    <div class="logs" id="log-container">
                        <div class="log-entry">
                            å¼€å§‹äº†ä½ çš„ä¿®é“ä¹‹æ—…...
                            <span class="time">0åˆ†é’Ÿ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="event-overlay" id="event-overlay"></div>
        <div class="event" id="random-event">
            <h3 id="event-title">éšæœºäº‹ä»¶</h3>
            <p id="event-desc">äº‹ä»¶æè¿°</p>
            <div id="event-options"></div>
        </div>
    </div>

    <div style="position: fixed; right: 2%; top: 20px;">
        <div onclick="gotoPage('https://moyugame965.github.io/GameList/')"
            style="margin: 10px 0; line-height:24px;width:50px; height: 24px;border: 1px solid #e6d5c3; background-color: #c7b299; color: #ffffff; text-align: center;border-radius: 5px;cursor: pointer;font-size: 15px;">
            æ›´å¤š</div>
        <div onclick="gotoPage('https://moyugame965.github.io/Shopping/baodan.html')"
            style="margin: 10px 0;line-height:24px;width:50px;height: 24px;border: 1px solid #e6d5c3; background-color: #c7b299; color: #ffffff; text-align: center;border-radius: 5px;cursor: pointer;font-size: 15px;">
            å•†åº—</div>
        <div onclick="gotoPage('https://moyugame965.github.io/Coupon/')"
            style="margin: 10px 0;line-height:24px;width:50px;height: 24px;border: 1px solid #e6d5c3; background-color: #c7b299; color: #ffffff; text-align: center;border-radius: 5px;cursor: pointer;font-size: 15px;">
            å¤–å–</div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            stats: {
                name: "æ¸…è™šå­",
                level: "åˆå…¥é“é—¨",
                cultivation: 0,
                spirit: 10,
                energy: 100,
                enlightenment: 1,
                luck: 1,
                taoism: 1,
                maxSpirit: 100,
                maxEnergy: 100
            },
            currentActivity: null,
            afk: false,
            timeElapsed: 0,
            eventChance: 0.1,
            events: [
                {
                    title: "é«˜äººæŒ‡ç‚¹",
                    desc: "ä¸€ä½ç™½å‘é“é•¿è·¯è¿‡ï¼Œä¸ºä½ æŒ‡ç‚¹è¿·æ´¥ã€‚",
                    options: [
                        { text: "æ­æ•¬è¯·æ•™", effect: () => { addStat('enlightenment', 1); addStat('cultivation', 10); } },
                        { text: "å©‰è¨€è°¢ç»", effect: () => { addStat('luck', 1); } }
                    ]
                },
                {
                    title: "çµè¯å‡ºä¸–",
                    desc: "ä½ å‘ç°ä¸€æ ªåƒå¹´çµèŠåœ¨å±±æ´ä¸­ç”Ÿé•¿ã€‚",
                    options: [
                        { text: "é‡‡æ‘˜æœç”¨", effect: () => { addStat('energy', 50); addStat('spirit', 20); } },
                        { text: "ç•™å®ƒç”Ÿé•¿", effect: () => { addStat('luck', 2); } }
                    ]
                },
                {
                    title: "å¤©é™å¼‚è±¡",
                    desc: "å¤©ç©ºä¸­å‡ºç°ç´«æ°”ä¸œæ¥çš„ç¥¥ç‘ä¹‹å…†ã€‚",
                    options: [
                        { text: "é™å¿ƒå‚æ‚Ÿ", effect: () => { addStat('cultivation', 20); addStat('enlightenment', 1); } },
                        { text: "é»˜é»˜è®°ä¸‹", effect: () => { addStat('taoism', 1); } }
                    ]
                },
                {
                    title: "å¤ç±å¯†è—",
                    desc: "ä½ åœ¨å±±æ´ä¸­å‘ç°äº†ä¸€éƒ¨å¤±ä¼ å·²ä¹…çš„é“å®¶ç§˜ç±ã€‚",
                    options: [
                        { text: "ç»†å¿ƒç ”è¯»", effect: () => { addStat('taoism', 2); addStat('enlightenment', 1); } },
                        { text: "å¸¦å›é“è§‚", effect: () => { addStat('luck', 1); addStat('cultivation', 15); } }
                    ]
                },
                {
                    title: "ç¥ç§˜è®¿å®¢",
                    desc: "ä¸€ä½è‡ªç§°æ¸¸æ–¹é“äººçš„è®¿å®¢å‘ä½ è¯·æ•™é“æ³•ã€‚",
                    options: [
                        { text: "å€¾å›Šç›¸æˆ", effect: () => { addStat('luck', 2); } },
                        { text: "è°¨æ…äº¤æµ", effect: () => { addStat('taoism', 1); addStat('spirit', 10); } }
                    ]
                },
                {
                    title: "å±±æ—è¿·é€”",
                    desc: "åœ¨æ·±å±±ä¸­é‡‡è¯ï¼Œä½ ä¸æ…è¿·å¤±äº†æ–¹å‘ã€‚",
                    options: [
                        { text: "å†·é™åˆ†æ", effect: () => { addStat('enlightenment', 1); gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 2; addLog("æ‰¾åˆ°å‡ºè·¯çš„åŒæ—¶ï¼Œä½ è¿˜å‘ç°äº†çè´µè¯æï¼"); } },
                        { text: "é“æ³•è¿½è¸ª", effect: () => { addStat('taoism', 1); addStat('energy', -10); } }
                    ]
                },
                {
                    title: "å‡¡å°˜å†ç»ƒ",
                    desc: "ä¸€ä½æ‘æ°‘è¯·æ±‚ä½ å¸®åŠ©æ²»ç–—ä»–ç”Ÿç—…çš„å­©å­ã€‚",
                    options: [
                        {
                            text: "æ–½å±•é“æ³•", effect: () => {
                                if (gameState.stats.taoism >= 5) {
                                    addStat('cultivation', 30);
                                    addLog("ä½ æˆåŠŸæ²»æ„ˆäº†å­©å­ï¼Œæ‘æ°‘æ„Ÿæ¿€ä¸å°½ï¼", "achievement");
                                } else {
                                    addStat('spirit', -30);
                                    addLog("ä½ çš„é“æ³•ä¸è¶³ï¼Œæ¶ˆè€—äº†å¤§é‡ç²¾ç¥åŠ›...", "error");
                                }
                            }
                        },
                        {
                            text: "èµ é€ä¸¹è¯", effect: () => {
                                if (gameState.inventory.potions && gameState.inventory.potions > 0) {
                                    gameState.inventory.potions--;
                                    addStat('luck', 3);
                                    updateInventory();
                                    addLog("ä½ çš„ä¸¹è¯æ²»å¥½äº†å­©å­ï¼Œç§¯ç´¯äº†ç¦ç¼˜ï¼", "achievement");
                                } else {
                                    addStat('luck', -1);
                                    addLog("ä½ æ²¡æœ‰ä¸¹è¯å¯ä»¥ç»™äºˆï¼Œåªèƒ½é—æ†¾ç¦»å¼€...", "error");
                                }
                            }
                        }
                    ]
                },
                {
                    title: "é›·åŠ«è€ƒéªŒ",
                    desc: "ä¿®ä¸ºæå‡å¼•æ¥å¤©é›·ï¼Œè¿™æ˜¯ä¸€æ¬¡çªç ´çš„æœºä¼šã€‚",
                    options: [
                        {
                            text: "è¿æ¥é›·åŠ«", effect: () => {
                                const success = Math.random() < (gameState.stats.spirit / gameState.stats.maxSpirit);
                                if (success) {
                                    addStat('cultivation', 50);
                                    addStat('maxSpirit', 10);
                                    addStat('maxEnergy', 10);
                                    addLog("ä½ æˆåŠŸæ¸¡è¿‡é›·åŠ«ï¼Œä¿®ä¸ºå¤§è¿›ï¼", "achievement");
                                } else {
                                    addStat('energy', -50);
                                    addStat('spirit', -50);
                                    addLog("é›·åŠ«å¨åŠ›å¤ªå¼ºï¼Œä½ å—äº†é‡ä¼¤...", "error");
                                }
                            }
                        },
                        { text: "é¿å¼€é”‹èŠ’", effect: () => { addStat('energy', -20); } }
                    ]
                },
                {
                    title: "ä»™äººèµå®",
                    desc: "ä¸€ä½éšä¸–ä»™äººè¢«ä½ çš„ä¿®è¡Œæ‰€æ„ŸåŠ¨ï¼Œæƒ³è¦èµäºˆä½ å®ç‰©ã€‚",
                    options: [
                        { text: "è¯·æ•™é“æ³•", effect: () => { addStat('taoism', 3); addStat('enlightenment', 2); } },
                        {
                            text: "è¯·æ±‚æ³•å®", effect: () => {
                                gameState.inventory.talismans = (gameState.inventory.talismans || 0) + 3;
                                updateInventory();
                                addLog("è·å¾—äº†ä¸‰å¼ å¼ºå¤§çš„çµç¬¦ï¼", "achievement");
                            }
                        }
                    ]
                },
                {
                    title: "å¿ƒé­”è€ƒéªŒ",
                    desc: "ä¿®è¡Œåˆ°ä¸€å®šé˜¶æ®µï¼Œå†…å¿ƒçš„å¿ƒé­”å¼€å§‹æ˜¾ç°ã€‚",
                    options: [
                        {
                            text: "æ­£é¢å¯¹æŠ—", effect: () => {
                                if (gameState.stats.enlightenment >= 5) {
                                    addStat('enlightenment', 3);
                                    addStat('cultivation', 30);
                                    addLog("ä½ æˆ˜èƒœäº†å¿ƒé­”ï¼Œæ‚Ÿæ€§å¤§å¢ï¼", "achievement");
                                } else {
                                    addStat('spirit', -40);
                                    addLog("å¿ƒé­”å¤ªå¼ºï¼Œä½ ç²¾ç¥å—åˆ›...", "error");
                                }
                            }
                        },
                        { text: "é¡ºå…¶è‡ªç„¶", effect: () => { addStat('spirit', -10); addStat('luck', 1); } }
                    ]
                },
                // æ–°å¢äº‹ä»¶å¼€å§‹
                {
                    title: "äº‘æ¸¸é“äºº",
                    desc: "ä¸€ä½äº‘æ¸¸é“äººæ¥è®¿ï¼Œè¡¨ç¤ºå¯ä»¥ä¼ æˆä½ ç§˜æ³•æˆ–èµ é€ä½ è¯æã€‚",
                    options: [
                        {
                            text: "å­¦ä¹ ç§˜æ³•", effect: () => {
                                addStat('taoism', 2);
                                addStat('cultivation', 15);
                                addLog("ä½ å­¦ä¼šäº†ä¸€ç§å…¨æ–°çš„ä¿®ç‚¼ç§˜æ³•ï¼", "achievement");
                            }
                        },
                        {
                            text: "æ¥å—è¯æ", effect: () => {
                                gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 5;
                                updateInventory();
                                addLog("è·å¾—äº†5ä»½çè´µè¯æï¼");
                            }
                        }
                    ]
                },
                {
                    title: "å¤æ´å¥‡é‡",
                    desc: "ä½ åœ¨å±±ä¸­å‘ç°ä¸€ä¸ªå‘å…‰çš„å¤æ´ï¼Œé‡Œé¢ä¼ æ¥å¥‡å¼‚çš„èƒ½é‡æ³¢åŠ¨ã€‚",
                    options: [
                        {
                            text: "æ·±å…¥æ¢ç´¢", effect: () => {
                                if (Math.random() < 0.7) {
                                    addStat('cultivation', 30);
                                    addStat('spirit', 30);
                                    addLog("ä½ åœ¨å¤æ´ä¸­æ„Ÿå—åˆ°æµ“éƒçš„çµæ°”ï¼Œä¿®ä¸ºå¤§è¿›ï¼", "achievement");
                                } else {
                                    addStat('energy', -30);
                                    addLog("å¤æ´ä¸­çš„é˜µæ³•æ”»å‡»äº†ä½ ï¼ŒæŸå¤±äº†ä¸å°‘ä½“åŠ›...", "error");
                                }
                            }
                        },
                        {
                            text: "è°¨æ…è§‚å¯Ÿ", effect: () => {
                                addStat('enlightenment', 1);
                                gameState.inventory.stones = (gameState.inventory.stones || 0) + 2;
                                updateInventory();
                                addLog("ä½ ä»æ´å£æ”¶é›†åˆ°äº†å‡ å—é—ªçƒçš„çµçŸ³ã€‚");
                            }
                        }
                    ]
                },
                {
                    title: "é£å‰‘ä¼ ä¹¦",
                    desc: "ä¸€æŠŠå¾®å‹é£å‰‘å¸¦ç€ä¹¦ä¿¡é£åˆ°ä½ é¢å‰ï¼Œæ˜¯è¿œæ–¹çš„é“å‹é‚€è¯·ä½ å…±åŒä¿®ç‚¼ã€‚",
                    options: [
                        {
                            text: "æ¬£ç„¶å‰å¾€", effect: () => {
                                if (gameState.stats.level === "åˆå…¥é“é—¨") {
                                    addStat('cultivation', 10);
                                    addLog("ä¸é“å‹åˆ‡ç£‹ï¼Œè·ç›Šè‰¯å¤šã€‚");
                                } else {
                                    addStat('taoism', 2);
                                    addStat('enlightenment', 1);
                                    addLog("ä½ ä»¬äº¤æ¢äº†ä¿®ç‚¼å¿ƒå¾—ï¼Œäº’ç›¸å¯å‘ã€‚", "achievement");
                                }
                            }
                        },
                        {
                            text: "å©‰æ‹’é‚€è¯·", effect: () => {
                                addStat('spirit', 15);
                                addLog("ä½ ä¸“æ³¨äºè‡ªå·±çš„ä¿®è¡Œï¼Œç²¾ç¥æ›´åŠ é›†ä¸­ã€‚");
                            }
                        }
                    ]
                },
                {
                    title: "çµå…½ç°èº«",
                    desc: "ä¸€åªæµ‘èº«æ•£å‘çµå…‰çš„ç™½é¹¿åœ¨ä½ ä¿®ç‚¼æ—¶ç°èº«ï¼Œé™é™åœ°æ³¨è§†ç€ä½ ã€‚",
                    options: [
                        {
                            text: "å°è¯•æ²Ÿé€š", effect: () => {
                                if (gameState.stats.spirit >= 50) {
                                    addStat('enlightenment', 2);
                                    addStat('luck', 2);
                                    addLog("ä½ ä¸çµå…½å»ºç«‹äº†å¿ƒçµæ„Ÿåº”ï¼Œè·å¾—äº†å®ƒçš„ç¥ç¦ï¼", "achievement");
                                } else {
                                    addLog("ä½ çš„ç²¾ç¥åŠ›ä¸è¶³ï¼Œæ— æ³•ä¸çµå…½æ²Ÿé€šã€‚");
                                }
                            }
                        },
                        {
                            text: "å®‰é™è§‚å¯Ÿ", effect: () => {
                                addStat('spirit', 10);
                                addLog("çµå…½ç¦»å»äº†ï¼Œä½†å®ƒçš„å‡ºç°è®©ä½ æ„Ÿåˆ°å¹³é™ã€‚");
                            }
                        }
                    ]
                },
                {
                    title: "çµé›¨é™ä¸´",
                    desc: "å¤©ç©ºçªç„¶ä¸‹èµ·äº†çµæ°”å……ç›ˆçš„é›¨ï¼Œè¿™æ˜¯éš¾å¾—çš„ä¿®ç‚¼è‰¯æœºã€‚",
                    options: [
                        {
                            text: "é›¨ä¸­æ‰“å", effect: () => {
                                addStat('cultivation', 25);
                                addStat('spirit', 25);
                                addLog("çµé›¨æ´—æ¶¤èº«å¿ƒï¼Œä½ çš„ä¿®ä¸ºå¤§å¹…æå‡ï¼", "achievement");
                            }
                        },
                        {
                            text: "æ”¶é›†é›¨æ°´", effect: () => {
                                gameState.inventory.potions = (gameState.inventory.potions || 0) + 1;
                                updateInventory();
                                addLog("ä½ æ”¶é›†äº†çµé›¨ç‚¼åˆ¶æˆä¸¹è¯ï¼Œè·å¾—äº†1é¢—ä¸¹è¯ï¼");
                            }
                        }
                    ]
                },
                {
                    title: "å±±ç¥è¯•ç‚¼",
                    desc: "å½“åœ°å±±ç¥æ˜¾çµï¼Œæƒ³è¦è€ƒéªŒä½ çš„é“å¿ƒå’Œå®åŠ›ã€‚",
                    options: [
                        {
                            text: "æ¥å—è¯•ç‚¼", effect: () => {
                                const successRate = (gameState.stats.taoism * 0.1) + (gameState.stats.cultivation / 100) + (gameState.stats.luck * 0.05);
                                if (Math.random() < successRate) {
                                    addStat('taoism', 3);
                                    addStat('cultivation', 40);
                                    addLog("ä½ é€šè¿‡äº†å±±ç¥çš„è¯•ç‚¼ï¼Œè·å¾—äº†å±±ç¥èµç¦ï¼", "achievement");
                                } else {
                                    addStat('energy', -40);
                                    addLog("è¯•ç‚¼å¤±è´¥ï¼Œä½ æ¶ˆè€—äº†å¤§é‡ä½“åŠ›...", "error");
                                }
                            }
                        },
                        {
                            text: "è°¦è™šè‡´æ­‰", effect: () => {
                                addStat('luck', 1);
                                addLog("å±±ç¥æ¬£èµä½ çš„è°¦é€Šæ€åº¦ï¼Œç¦»å¼€å‰ç»™äº†ä½ ä¸€ä¸ç¦ç¼˜ã€‚");
                            }
                        }
                    ]
                },
                {
                    title: "æµæ˜Ÿå è½",
                    desc: "ä¸€é¢—æµæ˜Ÿå è½åœ¨é™„è¿‘çš„å±±è°·ä¸­ï¼Œæ•£å‘ç€å¥‡å¼‚çš„èƒ½é‡ã€‚",
                    options: [
                        {
                            text: "å¯»æ‰¾é™¨çŸ³", effect: () => {
                                if (Math.random() < 0.6) {
                                    gameState.inventory.stones = (gameState.inventory.stones || 0) + 5;
                                    updateInventory();
                                    addLog("ä½ æ‰¾åˆ°äº†å‡ å—è•´å«å¼ºå¤§èƒ½é‡çš„é™¨çŸ³ï¼", "achievement");
                                } else {
                                    addStat('energy', -20);
                                    addLog("ä½ æœå¯»äº†å¾ˆä¹…ä½†ä¸€æ— æ‰€è·ï¼Œå¾’åŠ³æ¶ˆè€—äº†ä½“åŠ›ã€‚", "error");
                                }
                            }
                        },
                        {
                            text: "è¿œç¨‹æ„Ÿåº”", effect: () => {
                                addStat('spirit', 15);
                                addStat('enlightenment', 0.5);
                                addLog("ä½ æ„Ÿåº”åˆ°æµæ˜Ÿçš„èƒ½é‡ï¼Œæå‡äº†ç²¾ç¥åŠ›ã€‚");
                            }
                        }
                    ]
                },
                {
                    title: "ç™¾è‰äº‰é¸£",
                    desc: "ä½ ç»è¿‡çš„è‰åœ°ä¸Šï¼Œæ‰€æœ‰æ¤ç‰©çªç„¶æ•£å‘çµå…‰ï¼Œå¼€å§‹ç”Ÿé•¿ï¼Œè¿™æ˜¯éš¾å¾—çš„å¤©åœ°å¼‚è±¡ã€‚",
                    options: [
                        {
                            text: "æ±²å–çµæ°”", effect: () => {
                                addStat('cultivation', 20);
                                addStat('spirit', 20);
                                addLog("ä½ å¸æ”¶äº†å¤§é‡æ¤ç‰©ç²¾åï¼Œä¿®ä¸ºå¤§å¢ï¼");
                            }
                        },
                        {
                            text: "é‡‡é›†ä»™è‰", effect: () => {
                                gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 3;
                                addStat('luck', 1);
                                updateInventory();
                                addLog("ä½ é‡‡é›†åˆ°äº†å‡ æ ªçè´µçš„ä»™è‰ï¼");
                            }
                        }
                    ]
                },
                {
                    title: "å¹»å¢ƒè¯•ç‚¼",
                    desc: "ä½ ä¸çŸ¥ä¸è§‰èµ°å…¥äº†ä¸€ä¸ªå¹»å¢ƒï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€åœºé’ˆå¯¹å¿ƒæ€§çš„è€ƒéªŒã€‚",
                    options: [
                        {
                            text: "å‚æ‚Ÿå¹»è±¡", effect: () => {
                                if (gameState.stats.enlightenment >= 4) {
                                    addStat('enlightenment', 2);
                                    addStat('cultivation', 30);
                                    addLog("ä½ çœ‹ç ´å¹»è±¡ï¼Œè·å¾—äº†æ·±åˆ»çš„é¢†æ‚Ÿï¼", "achievement");
                                } else {
                                    addStat('spirit', -20);
                                    addLog("å¹»å¢ƒå¤ªè¿‡å¤æ‚ï¼Œè€—è´¹äº†ä½ ä¸å°‘ç²¾ç¥åŠ›...", "error");
                                }
                            }
                        },
                        {
                            text: "æ‰“ç ´å¹»å¢ƒ", effect: () => {
                                addStat('taoism', 1);
                                addStat('energy', -10);
                                addLog("ä½ ç”¨é“æ³•ç ´é™¤äº†å¹»å¢ƒï¼Œè·å¾—äº†ä¸€äº›æ„Ÿæ‚Ÿã€‚");
                            }
                        }
                    ]
                }
                // æ–°å¢äº‹ä»¶ç»“æŸ
            ],
            challenges: [
                { name: "åˆå…¥é“é—¨", desc: "ç´¯ç§¯ä¿®ç‚¼100ç‚¹ä¿®ä¸º", target: 100, stat: "cultivation", completed: false },
                { name: "å°æœ‰æ‰€æˆ", desc: "æ‚Ÿæ€§è¾¾åˆ°5ç‚¹", target: 5, stat: "enlightenment", completed: false },
                { name: "å¾—é“é«˜äºº", desc: "é“æ³•è¾¾åˆ°10ç‚¹", target: 10, stat: "taoism", completed: false },
                { name: "ä½“é­„å¼ºå¥", desc: "ä½“åŠ›ä¸Šé™è¾¾åˆ°150ç‚¹", target: 150, stat: "maxEnergy", completed: false },
                { name: "ç²¾ç¥é¥±æ»¡", desc: "ç²¾ç¥åŠ›ä¸Šé™è¾¾åˆ°150ç‚¹", target: 150, stat: "maxSpirit", completed: false },
                { name: "å¹¿ç§¯ç¦ç¼˜", desc: "ç¦ç¼˜è¾¾åˆ°10ç‚¹", target: 10, stat: "luck", completed: false },
                { name: "é“è¡Œç²¾æ·±", desc: "è¾¾åˆ°ç­‘åŸºæœŸå¢ƒç•Œ", target: "ç­‘åŸºæœŸ", stat: "level", completed: false },
                { name: "ä¸¹è¯å¤§å¸ˆ", desc: "ç‚¼åˆ¶10é¢—ä¸¹è¯", target: 10, stat: "potions", customCheck: true, completed: false },
                { name: "ç¬¦ç®“å®—å¸ˆ", desc: "åˆ¶ä½œ20å¼ çµç¬¦", target: 20, stat: "talismans", customCheck: true, completed: false }
            ],
            activities: {
                meditation: {
                    name: "ç›˜åå†¥æƒ³",
                    effects: {
                        cultivation: 1,
                        spirit: 2,
                        energy: -1
                    }
                },
                reading: {
                    name: "ç ”è¯»é“ç»",
                    effects: {
                        enlightenment: 0.1,
                        taoism: 0.1,
                        energy: -2,
                        spirit: -1
                    }
                },
                breathing: {
                    name: "åçº³æ³•",
                    effects: {
                        energy: 5,
                        spirit: 3
                    }
                },
                tea: {
                    name: "å“èŒ—æ‚Ÿé“",
                    effects: {
                        enlightenment: 0.05,
                        luck: 0.05,
                        spirit: 1
                    }
                },
                talisman: {
                    name: "ç‚¼åˆ¶ç¬¦ç®“",
                    effects: {
                        taoism: 0.2,
                        cultivation: 0.5,
                        energy: -3,
                        spirit: -2
                    }
                },
                herbs: {
                    name: "é‡‡é›†è¯è‰",
                    effects: {
                        energy: -2,
                        luck: 0.1
                    }
                },
                teaching: {
                    name: "æˆå¾’è®²é“",
                    effects: {
                        taoism: 0.3,
                        cultivation: 0.5,
                        energy: -2,
                        spirit: -3
                    }
                },
                alchemy: {
                    name: "ç‚¼ä¸¹ä¿®ç‚¼",
                    effects: {
                        cultivation: 2,
                        enlightenment: 0.2,
                        energy: -4,
                        spirit: -3
                    }
                },
                swordsmanship: {
                    name: "å‰‘æœ¯ä¿®ç‚¼",
                    effects: {
                        cultivation: 1.5,
                        energy: -5
                    },
                    special: "maxEnergy" // ç‰¹æ®Šæ•ˆæœï¼šå¢åŠ ä½“åŠ›ä¸Šé™
                },
                waterfall: {
                    name: "ç€‘å¸ƒå†¥æƒ³",
                    effects: {
                        spirit: 5,
                        cultivation: 2,
                        energy: -3
                    },
                    special: "maxSpirit" // ç‰¹æ®Šæ•ˆæœï¼šå¢åŠ ç²¾ç¥åŠ›ä¸Šé™
                }
            },
            levels: [
                { name: "åˆå…¥é“é—¨", req: 0 },
                { name: "ä¿®è¡Œå°æˆ", req: 100 },
                { name: "ç­‘åŸºæœŸ", req: 500 },
                { name: "å‡ç¥æœŸ", req: 1000 },
                { name: "é‡‘ä¸¹æœŸ", req: 3000 },
                { name: "å…ƒå©´æœŸ", req: 10000 },
                { name: "åŒ–ç¥æœŸ", req: 30000 },
                { name: "æ¸¡åŠ«æœŸ", req: 100000 },
                { name: "å¾—é“æˆä»™", req: 500000 }
            ]
        };

        // DOMå…ƒç´ 
        const elements = {
            stats: {
                name: document.getElementById('name'),
                level: document.getElementById('level'),
                cultivation: document.getElementById('cultivation'),
                spirit: document.getElementById('spirit'),
                energy: document.getElementById('energy'),
                enlightenment: document.getElementById('enlightenment'),
                luck: document.getElementById('luck'),
                taoism: document.getElementById('taoism')
            },
            currentActivity: document.getElementById('current-activity'),
            timePassed: document.getElementById('time-passed'),
            toggleAfk: document.getElementById('toggle-afk'),
            logContainer: document.getElementById('log-container'),
            activities: document.querySelectorAll('.activity'),
            randomEvent: document.getElementById('random-event'),
            eventOverlay: document.getElementById('event-overlay'),
            eventTitle: document.getElementById('event-title'),
            eventDesc: document.getElementById('event-desc'),
            eventOptions: document.getElementById('event-options'),
            challenges: {
                1: document.getElementById('challenge-1'),
                2: document.getElementById('challenge-2'),
                3: document.getElementById('challenge-3'),
                4: document.getElementById('challenge-4'),
                5: document.getElementById('challenge-5'),
                6: document.getElementById('challenge-6'),
                7: document.getElementById('challenge-7'),
                8: document.getElementById('challenge-8'),
                9: document.getElementById('challenge-9')
            }
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆå§‹åŒ–åº“å­˜
            gameState.inventory = gameState.inventory || {
                herbs: 0,
                talismans: 0,
                potions: 0,
                stones: 0
            };

            // åˆå§‹åŒ–æ¸¸æˆè®¾ç½®
            gameState.settings = gameState.settings || {
                soundEnabled: false,
                autoSave: true,
                autoSaveInterval: 1 // é»˜è®¤1åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
                // å·²ç§»é™¤å½“å‰å­˜æ¡£æ§½ä½è®¾ç½®
            };

            // åº”ç”¨è®¾ç½®
            document.getElementById('sound-toggle').checked = gameState.settings.soundEnabled || false;
            document.getElementById('auto-save-toggle').checked = gameState.settings.autoSave !== false;
            gameState.soundEnabled = gameState.settings.soundEnabled || false;

            // è®¾ç½®è‡ªåŠ¨ä¿å­˜é¢‘ç‡é€‰æ‹©å™¨
            const intervalSelect = document.getElementById('auto-save-interval');
            intervalSelect.value = gameState.settings.autoSaveInterval || 1;

            // ç»‘å®šè®¾ç½®æŒ‰é’®äº‹ä»¶
            document.getElementById('toggle-settings').addEventListener('click', function () {
                const panel = document.getElementById('settings-panel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });

            // ç»‘å®šè®¾ç½®é€‰é¡¹äº‹ä»¶
            document.getElementById('sound-toggle').addEventListener('change', function () {
                gameState.soundEnabled = this.checked;
                gameState.settings.soundEnabled = this.checked;
                saveSettings();
            });

            document.getElementById('auto-save-toggle').addEventListener('change', function () {
                gameState.settings.autoSave = this.checked;
                saveSettings();

                // åé¦ˆåˆ°ç•Œé¢
                if (this.checked) {
                    addLog("å·²å¼€å¯è‡ªåŠ¨ä¿å­˜åŠŸèƒ½", "system");
                } else {
                    addLog("å·²å…³é—­è‡ªåŠ¨ä¿å­˜åŠŸèƒ½", "system");
                }
            });

            document.getElementById('auto-save-interval').addEventListener('change', function () {
                gameState.settings.autoSaveInterval = parseInt(this.value);
                saveSettings();
                addLog(`è‡ªåŠ¨ä¿å­˜é¢‘ç‡å·²è®¾ç½®ä¸º${this.value}åˆ†é’Ÿä¸€æ¬¡`, "system");
            });

            document.getElementById('clear-cache').addEventListener('click', function () {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å—ï¼Ÿè¿™ä¸ä¼šåˆ é™¤ä½ çš„å­˜æ¡£ï¼Œä½†ä¼šæ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€‚')) {
                    // å°è¯•æ¸…ç†ä¸€äº›ç¼“å­˜
                    try {
                        localStorage.removeItem('daoshiCache');
                        if (window.caches) {
                            caches.keys().then(names => {
                                names.forEach(name => {
                                    if (name.includes('daoshi')) {
                                        caches.delete(name);
                                    }
                                });
                            });
                        }
                        alert('ç¼“å­˜å·²æ¸…ç†ï¼');
                    } catch (e) {
                        console.error('æ¸…ç†ç¼“å­˜å¤±è´¥', e);
                        alert('æ¸…ç†ç¼“å­˜å¤±è´¥: ' + e.message);
                    }
                }
            });

            document.getElementById('export-save').addEventListener('click', function () {
                // å¯¼å‡ºå­˜æ¡£ä¸ºJSONæ–‡ä»¶
                try {
                    const saveData = localStorage.getItem('daoshiGame');
                    if (!saveData) {
                        alert('æ²¡æœ‰å¯ç”¨çš„å­˜æ¡£æ•°æ®ï¼');
                        return;
                    }

                    const blob = new Blob([saveData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `daoshi_save_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();

                    setTimeout(() => {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    }, 0);
                } catch (e) {
                    console.error('å¯¼å‡ºå­˜æ¡£å¤±è´¥', e);
                    alert('å¯¼å‡ºå­˜æ¡£å¤±è´¥: ' + e.message);
                }
            });

            // å¯¼å…¥å­˜æ¡£
            document.getElementById('import-save').addEventListener('click', function () {
                document.getElementById('save-file-input').click();
            });

            document.getElementById('save-file-input').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const saveData = e.target.result;
                        // éªŒè¯JSONæ ¼å¼
                        JSON.parse(saveData);

                        if (confirm('ç¡®å®šè¦å¯¼å…¥æ­¤å­˜æ¡£å—ï¼Ÿè¿™å°†è¦†ç›–ä½ å½“å‰çš„æ¸¸æˆè¿›åº¦ã€‚')) {
                            localStorage.setItem('daoshiGame', saveData);
                            alert('å­˜æ¡£å¯¼å…¥æˆåŠŸï¼æ¸¸æˆå°†åˆ·æ–°ä»¥åŠ è½½æ–°å­˜æ¡£ã€‚');
                            location.reload();
                        }
                    } catch (e) {
                        console.error('å¯¼å…¥å­˜æ¡£å¤±è´¥', e);
                        alert('å¯¼å…¥å­˜æ¡£å¤±è´¥: æ–‡ä»¶æ ¼å¼æ— æ•ˆ');
                    }
                };
                reader.readAsText(file);
            });

            // ç§»é™¤å­˜æ¡£æ§½ä½ç›¸å…³ä»£ç 

            // åˆå§‹åŒ–UI
            updateAllUI();

            // åˆå§‹åŒ–æ ‡ç­¾ç³»ç»Ÿ
            initTabs();

            // åˆå§‹åŒ–æ—¶é—´å’Œå­£èŠ‚
            updateTimeDisplay();

            // ç»‘å®šæ´»åŠ¨é€‰æ‹©
            document.querySelectorAll('.activity').forEach(activity => {
                activity.addEventListener('click', () => {
                    const activityId = activity.getAttribute('data-activity');
                    selectActivity(activityId);
                });
            });

            // ç»‘å®šæŒ‚æœºæŒ‰é’®
            elements.toggleAfk.addEventListener('click', toggleAfk);

            // ç»‘å®šé‡ç½®æ¸¸æˆæŒ‰é’®
            document.getElementById('reset-game').addEventListener('click', resetGame);

            // é”å®šéœ€è¦è§£é”çš„æ´»åŠ¨
            checkActivityUnlocks();

            // åŠ è½½æ¸¸æˆ
            loadGame();

            // é˜²æ­¢iOS Safariä¸Šçš„è§¦æ‘¸äº‹ä»¶é—®é¢˜
            document.body.addEventListener('touchstart', function () { }, { passive: true });

            // æ·»åŠ æ¬¢è¿æ—¥å¿—
            addLog(`æ¬¢è¿ï¼Œ${gameState.stats.name}é“é•¿ï¼å¼€å§‹ä½ çš„ä¿®é“ä¹‹æ—…...`);

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­è®¾ç½®é¢æ¿
            document.addEventListener('click', function (e) {
                const settingsPanel = document.getElementById('settings-panel');
                const toggleButton = document.getElementById('toggle-settings');

                if (settingsPanel.style.display === 'block' &&
                    !settingsPanel.contains(e.target) &&
                    e.target !== toggleButton) {
                    settingsPanel.style.display = 'none';
                }
            });
        }

        // ä¿å­˜ç”¨æˆ·è®¾ç½®
        function saveSettings() {
            try {
                localStorage.setItem('daoshiSettings', JSON.stringify(gameState.settings));
            } catch (error) {
                console.error("ä¿å­˜è®¾ç½®æ—¶å‡ºé”™:", error);
            }
        }

        // é€‰æ‹©æ´»åŠ¨
        function selectActivity(activityId) {
            // æ£€æŸ¥æ´»åŠ¨æ˜¯å¦é”å®š
            const activityElement = document.querySelector(`.activity[data-activity="${activityId}"]`);
            if (activityElement && activityElement.classList.contains('locked')) {
                addLog(`ä½ å°šæœªæ»¡è¶³ä¿®ç‚¼${gameState.activities[activityId].name}çš„æ¡ä»¶`, 'error');
                return false;
            }

            // å¦‚æœä¹‹å‰æœ‰æ´»åŠ¨ï¼Œå…ˆæ¸…é™¤å®ƒçš„activeçŠ¶æ€
            if (gameState.currentActivity) {
                const oldActivity = document.querySelector(`.activity[data-activity="${gameState.currentActivity}"]`);
                if (oldActivity) oldActivity.classList.remove('active');
            }

            gameState.currentActivity = activityId;

            // è®¾ç½®æ–°æ´»åŠ¨çš„activeçŠ¶æ€
            if (activityElement) {
                activityElement.classList.add('active');
            }

            elements.currentActivity.textContent = gameState.activities[activityId].name;
            addLog(`å¼€å§‹${gameState.activities[activityId].name}`);

            // é€‰æ‹©æ´»åŠ¨åä¿å­˜æ¸¸æˆçŠ¶æ€
            saveGame();

            return true;
        }

        // åˆ‡æ¢æŒ‚æœºçŠ¶æ€
        function toggleAfk() {
            if (!gameState.currentActivity) {
                addLog("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä¿®ç‚¼æ´»åŠ¨", "error");
                return;
            }

            gameState.afk = !gameState.afk;

            if (gameState.afk) {
                elements.toggleAfk.textContent = "åœæ­¢æŒ‚æœºä¿®ç‚¼";
                addLog("å¼€å§‹æŒ‚æœºä¿®ç‚¼");
                document.getElementById('afk-status').classList.add('afk-active');
                // æ›´æ–°æŒ‚æœºçŠ¶æ€æ–‡æœ¬
                const statusValue = document.querySelector('#afk-status .status-value');
                if (statusValue) {
                    statusValue.textContent = "ä¿®ç‚¼ä¸­...";
                }
                startAfkLoop();
            } else {
                elements.toggleAfk.textContent = "å¼€å§‹æŒ‚æœºä¿®ç‚¼";
                addLog("åœæ­¢æŒ‚æœºä¿®ç‚¼");
                document.getElementById('afk-status').classList.remove('afk-active');
                // æ›´æ–°æŒ‚æœºçŠ¶æ€æ–‡æœ¬
                const statusValue = document.querySelector('#afk-status .status-value');
                if (statusValue) {
                    statusValue.textContent = "æœªå¼€å§‹";
                }
                stopAfkLoop();
            }
        }

        // æŒ‚æœºå¾ªç¯
        let afkInterval;
        function startAfkLoop() {
            // é˜²æ­¢å¤šä¸ªè®¡æ—¶å™¨åŒæ—¶è¿è¡Œ
            if (afkInterval) {
                clearInterval(afkInterval);
            }

            afkInterval = setInterval(() => {
                // æ—¶é—´æµé€
                gameState.timeElapsed++;

                // æ›´æ–°UIä¸­çš„æ—¶é—´æ˜¾ç¤º
                if (elements.timePassed) {
                    elements.timePassed.textContent = gameState.timeElapsed;
                }

                // æ—¶é—´ç³»ç»Ÿ
                updateGameTime();

                // åº”ç”¨æ´»åŠ¨æ•ˆæœ
                if (gameState.currentActivity && gameState.activities[gameState.currentActivity]) {
                    const activity = gameState.activities[gameState.currentActivity];

                    // å­£èŠ‚æ•ˆæœä¿®é¥°
                    const seasonMultiplier = getSeasonMultiplier(gameState.currentActivity);

                    for (const [stat, value] of Object.entries(activity.effects)) {
                        // åº”ç”¨å­£èŠ‚ä¿®é¥°æ•ˆæœ
                        let modifiedValue = value * seasonMultiplier;

                        // å¦‚æœæ˜¯å¤œæ™šï¼Œç²¾ç¥åŠ›æ¢å¤è·å¾—åŠ æˆ
                        if (!gameState.dayTime && stat === 'spirit' && modifiedValue > 0) {
                            modifiedValue *= 1.5;
                        }

                        addStat(stat, modifiedValue);
                    }

                    // å¤„ç†ç‰¹æ®Šæ•ˆæœ
                    if (activity.special) {
                        // æ¯10åˆ†é’Ÿåº”ç”¨ä¸€æ¬¡ç‰¹æ®Šæ•ˆæœ
                        if (gameState.timeElapsed % 10 === 0) {
                            if (activity.special === "maxEnergy") {
                                // å¢åŠ æœ€å¤§ä½“åŠ›
                                gameState.stats.maxEnergy += 0.5;
                                if (gameState.timeElapsed % 30 === 0) {
                                    addLog("å‰‘æœ¯ä¿®ç‚¼å¢å¼ºäº†ä½ çš„ä½“é­„ï¼Œä½“åŠ›ä¸Šé™æå‡äº†ï¼");
                                }
                            } else if (activity.special === "maxSpirit") {
                                // å¢åŠ æœ€å¤§ç²¾ç¥åŠ›
                                gameState.stats.maxSpirit += 0.5;
                                if (gameState.timeElapsed % 30 === 0) {
                                    addLog("ç€‘å¸ƒå†¥æƒ³å‡€åŒ–äº†ä½ çš„å¿ƒçµï¼Œç²¾ç¥åŠ›ä¸Šé™æå‡äº†ï¼");
                                }
                            }
                        }
                    }

                    // éšæœºç‰©å“è·å–
                    processActivityRewards(gameState.currentActivity);
                }

                // éšæœºäº‹ä»¶
                if (Math.random() < calculateEventChance()) {
                    triggerRandomEvent();
                }

                // æ›´æ–°UI
                updateAllUI();

                // è‡ªåŠ¨ä¿å­˜æ¸¸æˆ
                if (gameState.settings && gameState.settings.autoSave !== false) {
                    // ä½¿ç”¨è®¾ç½®ä¸­çš„ä¿å­˜é—´éš”ï¼ˆåˆ†é’Ÿï¼‰
                    const saveInterval = gameState.settings.autoSaveInterval || 1;

                    if (gameState.timeElapsed % (saveInterval * 60) === 0) {
                        saveGame();

                        // æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æç¤º
                        const saveNotification = document.createElement('div');
                        saveNotification.className = 'save-notification';
                        saveNotification.textContent = 'æ¸¸æˆå·²è‡ªåŠ¨ä¿å­˜';
                        document.body.appendChild(saveNotification);

                        // æ·»åŠ æ—¥å¿—
                        addLog("æ¸¸æˆå·²è‡ªåŠ¨ä¿å­˜", "system");

                        // 2ç§’åç§»é™¤æç¤º
                        setTimeout(() => {
                            if (saveNotification.parentNode) {
                                saveNotification.parentNode.removeChild(saveNotification);
                            }
                        }, 2000);
                    }
                }

                // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç»§ç»­
                if (gameState.stats.energy <= 0 || gameState.stats.spirit <= 0) {
                    addLog("ä½ å¤ªç–²æƒ«äº†ï¼Œæ— æ³•ç»§ç»­ä¿®ç‚¼", "error");
                    gameState.afk = false;
                    elements.toggleAfk.textContent = "å¼€å§‹æŒ‚æœºä¿®ç‚¼";
                    document.getElementById('afk-status').classList.remove('afk-active');
                    // æ›´æ–°æŒ‚æœºçŠ¶æ€æ–‡æœ¬
                    const statusValue = document.querySelector('#afk-status .status-value');
                    if (statusValue) {
                        statusValue.textContent = "æœªå¼€å§‹";
                    }
                    clearInterval(afkInterval);
                }
            }, 1000);
        }

        // æ›´æ–°æ¸¸æˆæ—¶é—´ç³»ç»Ÿ
        function updateGameTime() {
            gameState.time += 0.25; // æ¯æ¬¡å¢åŠ 15åˆ†é’Ÿ

            // æ—¥æœŸå˜æ›´
            if (gameState.time >= 24) {
                gameState.time = 0;
                gameState.daysPassed++;
                addLog(`è¿›å…¥ç¬¬${gameState.daysPassed}å¤©`);

                // æ¯10å¤©æå‡å±æ€§ä¸Šé™
                if (gameState.daysPassed % 10 === 0) {
                    gameState.stats.maxEnergy += 5;
                    gameState.stats.maxSpirit += 5;
                    addLog(`éšç€é•¿æœŸä¿®ç‚¼ï¼Œä½ çš„ä½“åŠ›ä¸Šé™å’Œç²¾ç¥åŠ›ä¸Šé™æå‡äº†ï¼`, 'achievement');
                }
            }

            // æ—¥å¤œå˜åŒ–
            const oldDayTime = gameState.dayTime;
            gameState.dayTime = (gameState.time >= 6 && gameState.time < 18);

            if (oldDayTime !== gameState.dayTime) {
                if (gameState.dayTime) {
                    addLog('å¤©äº®äº†ï¼Œä¸‡ç‰©å¤è‹');
                    document.body.classList.remove('night-mode');
                } else {
                    addLog('å¤œå¹•é™ä¸´ï¼Œç¾¤æ˜Ÿé—ªçƒ');
                    document.body.classList.add('night-mode');
                }
            }

            // å­£èŠ‚å˜åŒ–
            if (gameState.daysPassed % 30 === 0 && gameState.time === 0) {
                const seasons = ['spring', 'summer', 'autumn', 'winter'];
                const currentIndex = seasons.indexOf(gameState.season);
                const newSeason = seasons[(currentIndex + 1) % 4];

                if (newSeason !== gameState.season) {
                    gameState.season = newSeason;

                    const seasonNames = {
                        spring: 'æ˜¥å­£',
                        summer: 'å¤å­£',
                        autumn: 'ç§‹å­£',
                        winter: 'å†¬å­£'
                    };

                    addLog(`å­£èŠ‚å˜åŒ–ï¼Œè¿›å…¥${seasonNames[gameState.season]}`);

                    // æ›´æ–°UI
                    const seasonIndicator = document.getElementById('season-indicator');
                    if (seasonIndicator) {
                        seasonIndicator.textContent = seasonNames[gameState.season];
                        seasonIndicator.className = `season-indicator ${gameState.season}`;
                    }
                }
            }

            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            updateTimeDisplay();
        }

        // æ›´æ–°æ—¶é—´å’Œæ—¥å¤œæ˜¾ç¤º
        function updateTimeDisplay() {
            // æ›´æ–°æ—¶è¾°æ˜¾ç¤º
            const timeIndicator = document.getElementById('time-indicator');
            if (timeIndicator) {
                const chineseHours = ['å­æ—¶', 'ä¸‘æ—¶', 'å¯…æ—¶', 'å¯æ—¶', 'è¾°æ—¶', 'å·³æ—¶', 'åˆæ—¶', 'æœªæ—¶', 'ç”³æ—¶', 'é…‰æ—¶', 'æˆŒæ—¶', 'äº¥æ—¶'];
                const hourIndex = Math.floor(gameState.time / 2) % 12;
                timeIndicator.textContent = chineseHours[hourIndex];
            }

            // æ›´æ–°å¤©æ•°æ˜¾ç¤º
            const daysPassed = document.getElementById('days-passed');
            if (daysPassed) {
                daysPassed.textContent = `ç¬¬${gameState.daysPassed}å¤©`;
            }

            // æ›´æ–°æ—¥å¤œå›¾æ ‡
            const dayNightIndicator = document.getElementById('day-night-indicator');
            if (dayNightIndicator) {
                if (gameState.dayTime) {
                    dayNightIndicator.textContent = 'â˜€ï¸';
                    dayNightIndicator.className = 'day-night-indicator daytime';
                } else {
                    dayNightIndicator.textContent = 'ğŸŒ™';
                    dayNightIndicator.className = 'day-night-indicator nighttime';
                }
            }
        }

        // è·å–å­£èŠ‚ä¿®é¥°æ•ˆæœ
        function getSeasonMultiplier(activityId) {
            const seasonEffects = {
                spring: {
                    meditation: 1.2,   // æ˜¥å­£å†¥æƒ³æ•ˆæœæ›´ä½³
                    herbs: 1.5,        // æ˜¥å­£é‡‡è¯æ›´é«˜æ•ˆ
                    default: 1.1       // æ˜¥å­£å…¶ä»–æ´»åŠ¨è½»å¾®æå‡
                },
                summer: {
                    qigong: 1.3,       // å¤å­£æ°”åŠŸä¿®ç‚¼æ›´ä½³
                    talisman: 1.2,     // å¤å­£ç¬¦ç®“æ•ˆæœæ›´å¥½
                    default: 1.0       // å¤å­£æ™®é€šæ•ˆæœ
                },
                autumn: {
                    reading: 1.3,      // ç§‹å­£è¯»ç»æ›´é«˜æ•ˆ
                    tea: 1.2,          // ç§‹å­£å“èŒ¶æ•ˆæœæ›´å¥½
                    default: 1.1       // ç§‹å­£å…¶ä»–æ´»åŠ¨è½»å¾®æå‡
                },
                winter: {
                    meditation: 0.9,   // å†¬å­£å†¥æƒ³æ•ˆæœè¾ƒå¼±
                    breathing: 1.3,    // å†¬å­£åçº³æ•ˆæœæ›´ä½³
                    default: 0.95      // å†¬å­£è½»å¾®é™ä½æ•ˆç‡
                }
            };

            // è¿”å›å¯¹åº”å­£èŠ‚çš„ä¿®é¥°æ•ˆæœï¼Œå¦‚æœæ²¡æœ‰ç‰¹å®šæ•ˆæœåˆ™è¿”å›é»˜è®¤å€¼
            return seasonEffects[gameState.season][activityId] ||
                seasonEffects[gameState.season].default;
        }

        // åŸºäºå„ç§å› ç´ è®¡ç®—äº‹ä»¶è§¦å‘å‡ ç‡
        function calculateEventChance() {
            let chance = gameState.eventChance;

            // ç¦ç¼˜å½±å“äº‹ä»¶è§¦å‘å‡ ç‡
            chance += (gameState.stats.luck - 1) * 0.02;

            // å¤œæ™šäº‹ä»¶æ›´å¤š
            if (!gameState.dayTime) {
                chance *= 1.5;
            }

            // ä¸åŒå­£èŠ‚çš„äº‹ä»¶å‡ ç‡
            const seasonMultipliers = {
                spring: 1.1,
                summer: 0.9,
                autumn: 1.2,
                winter: 1.3
            };

            chance *= seasonMultipliers[gameState.season] || 1;

            // å¢ƒç•Œè¶Šé«˜ï¼Œé‡åˆ°ç¨€æœ‰äº‹ä»¶çš„å‡ ç‡è¶Šé«˜
            const levelIndex = gameState.levels.findIndex(l => l.name === gameState.stats.level);
            chance *= (1 + levelIndex * 0.05);

            // é•¿æ—¶é—´æ²¡æœ‰äº‹ä»¶ä¼šæé«˜è§¦å‘å‡ ç‡
            if (gameState.lastEventTime) {
                const minutesSinceLastEvent = (gameState.timeElapsed - gameState.lastEventTime);
                if (minutesSinceLastEvent > 30) {
                    // æ¯è¶…è¿‡30åˆ†é’Ÿå¢åŠ 5%æ¦‚ç‡
                    chance *= (1 + ((minutesSinceLastEvent - 30) / 30) * 0.05);
                }
            }

            return Math.min(chance, 0.35); // ä¸Šé™35%
        }

        // å¤„ç†æ´»åŠ¨éšæœºå¥–åŠ±
        function processActivityRewards(activityId) {
            switch (activityId) {
                case 'herbs':
                    // é‡‡è¯æœ‰å‡ ç‡è·å¾—è¯æ
                    if (Math.random() < 0.3) {
                        gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 1;
                        addLog(`ä½ é‡‡é›†åˆ°äº†ä¸€ä»½è¯æï¼`);
                    }
                    break;
                case 'talisman':
                    // ç¬¦ç®“æœ‰å‡ ç‡è·å¾—æˆå“ç¬¦
                    if (Math.random() < 0.2) {
                        gameState.inventory.talismans = (gameState.inventory.talismans || 0) + 1;
                        addLog(`ä½ æˆåŠŸç‚¼åˆ¶äº†ä¸€å¼ çµç¬¦ï¼`);
                    }
                    break;
                case 'teaching':
                    // æˆå¾’æœ‰å‡ ç‡è·å¾—çµçŸ³
                    if (Math.random() < 0.4) {
                        gameState.inventory.stones = (gameState.inventory.stones || 0) + 1;
                        addLog(`ä½ è·å¾—äº†ä¸€æšçµçŸ³ï¼`);
                    }
                    break;
                case 'alchemy':
                    // ç‚¼ä¸¹æœ‰å‡ ç‡è·å¾—ä¸¹è¯
                    if (Math.random() < 0.15) {
                        gameState.inventory.potions = (gameState.inventory.potions || 0) + 1;
                        addLog(`ä½ æˆåŠŸç‚¼åˆ¶äº†ä¸€é¢—ä¸¹è¯ï¼`, 'achievement');
                    }

                    // éœ€è¦æ¶ˆè€—è¯æ
                    if (gameState.inventory.herbs && gameState.inventory.herbs > 0 && gameState.timeElapsed % 5 === 0) {
                        gameState.inventory.herbs -= 1;
                        addLog(`ç‚¼ä¸¹æ¶ˆè€—äº†ä¸€ä»½è¯æ`);
                    }
                    break;
                case 'swordsmanship':
                    // å‰‘æœ¯ä¿®ç‚¼æœ‰å‡ ç‡è§¦å‘é¡¿æ‚Ÿ
                    if (Math.random() < 0.1) {
                        addStat('cultivation', 10);
                        addLog(`å‰‘æœ¯ä¿®ç‚¼ä¸­ä½ çªç„¶é¡¿æ‚Ÿï¼Œä¿®ä¸ºå¤§å¢ï¼`);
                    }
                    break;
                case 'waterfall':
                    // ç€‘å¸ƒå†¥æƒ³æœ‰å‡ ç‡å›å¤å…¨éƒ¨ç²¾ç¥åŠ›
                    if (Math.random() < 0.05) {
                        gameState.stats.spirit = gameState.stats.maxSpirit;
                        addLog(`åœ¨ç€‘å¸ƒä¸‹æ‚Ÿé“ï¼Œä½ çš„ç²¾ç¥åŠ›å®Œå…¨æ¢å¤äº†ï¼`, 'achievement');
                    }
                    break;
            }

            // æ›´æ–°ç‰©å“æ 
            updateInventory();
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStats() {
            for (const [stat, element] of Object.entries(elements.stats)) {
                element.textContent = typeof gameState.stats[stat] === 'number' ?
                    Math.floor(gameState.stats[stat] * 10) / 10 :
                    gameState.stats[stat];
            }
        }

        // æ·»åŠ å±æ€§å€¼
        function addStat(stat, value) {
            // å¦‚æœæ˜¯è´Ÿå€¼ï¼Œæ£€æŸ¥æ˜¯å¦ä¼šå¯¼è‡´å±æ€§ä½äº0
            if (value < 0 && gameState.stats[stat] + value < 0) {
                // å°†å±æ€§è®¾ä¸º0è€Œä¸æ˜¯è´Ÿå€¼
                gameState.stats[stat] = 0;
            } else {
                // åº”ç”¨å±æ€§å˜åŒ–
                gameState.stats[stat] += value;
            }

            // ç‰¹æ®Šå¤„ç†ä¸€äº›æœ‰ä¸Šé™çš„å±æ€§
            if (stat === 'energy' && gameState.stats.energy > gameState.stats.maxEnergy) {
                gameState.stats.energy = gameState.stats.maxEnergy;
            }
            if (stat === 'spirit' && gameState.stats.spirit > gameState.stats.maxSpirit) {
                gameState.stats.spirit = gameState.stats.maxSpirit;
            }

            // æ›´æ–°å¢ƒç•Œç­‰çº§
            checkLevelUp();
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥æå‡å¢ƒç•Œ
        function checkLevelUp() {
            // è·å–å½“å‰å¢ƒç•Œåœ¨ç­‰çº§æ•°ç»„ä¸­çš„ç´¢å¼•
            const currentLevelIndex = gameState.levels.findIndex(level => level.name === gameState.stats.level);

            // å¦‚æœæ‰¾åˆ°äº†å½“å‰å¢ƒç•Œï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥æ™‹çº§
            if (currentLevelIndex !== -1 && currentLevelIndex < gameState.levels.length - 1) {
                const nextLevel = gameState.levels[currentLevelIndex + 1];

                // å¦‚æœä¿®ä¸ºè¾¾åˆ°äº†ä¸‹ä¸€ä¸ªå¢ƒç•Œçš„è¦æ±‚
                if (gameState.stats.cultivation >= nextLevel.req) {
                    gameState.stats.level = nextLevel.name;
                    addLog(`æ­å–œï¼ä½ çš„å¢ƒç•Œæå‡åˆ°äº†ã€${nextLevel.name}ã€‘`, 'level-up');

                    // æå‡å¥–åŠ±
                    gameState.stats.maxEnergy += 10;
                    gameState.stats.maxSpirit += 10;
                    gameState.stats.energy = gameState.stats.maxEnergy;
                    gameState.stats.spirit = gameState.stats.maxSpirit;

                    // åœ¨å¢ƒç•Œæå‡æ—¶ä¿å­˜æ¸¸æˆçŠ¶æ€
                    saveGame();

                    // å¢ƒç•Œæå‡åé‡æ–°æ£€æŸ¥æ´»åŠ¨è§£é”
                    checkActivityUnlocks();
                }
            }
        }

        // æ›´æ–°æŒ‘æˆ˜è¿›åº¦
        function updateChallenges() {
            gameState.challenges.forEach((challenge, index) => {
                // è·å–å½“å‰å€¼
                let value;
                let progress = 0;

                if (challenge.customCheck) {
                    // è‡ªå®šä¹‰æ£€æŸ¥çš„æŒ‘æˆ˜ï¼Œä¾‹å¦‚ç‰©å“æŒ‘æˆ˜
                    switch (challenge.stat) {
                        case 'potions':
                            value = gameState.inventory.potions || 0;
                            progress = Math.min(Math.floor((value / challenge.target) * 100), 100);
                            break;
                        case 'talismans':
                            value = gameState.inventory.talismans || 0;
                            progress = Math.min(Math.floor((value / challenge.target) * 100), 100);
                            break;
                        default:
                            value = 0;
                            progress = 0;
                    }

                    updateChallengeProgress(index + 1, progress, challenge.completed);
                } else if (challenge.stat === 'level') {
                    // ç‰¹æ®Šå¤„ç†å¢ƒç•Œç­‰çº§
                    value = gameState.levels.findIndex(l => l.name === gameState.stats.level);
                    const targetIndex = gameState.levels.findIndex(l => l.name === challenge.target);
                    progress = targetIndex > 0 ? Math.min(Math.floor((value / targetIndex) * 100), 100) : 0;

                    updateChallengeProgress(index + 1, progress, challenge.completed);
                } else {
                    // æ™®é€šå±æ€§
                    value = gameState.stats[challenge.stat];
                    progress = Math.min(Math.floor((value / challenge.target) * 100), 100);

                    updateChallengeProgress(index + 1, progress, challenge.completed);
                }

                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (challenge.customCheck) {
                    // è‡ªå®šä¹‰æŒ‘æˆ˜å®Œæˆæ£€æŸ¥
                    switch (challenge.stat) {
                        case 'potions':
                            if ((gameState.inventory.potions || 0) >= challenge.target && !challenge.completed) {
                                completeChallengeReward(challenge, index);
                            }
                            break;
                        case 'talismans':
                            if ((gameState.inventory.talismans || 0) >= challenge.target && !challenge.completed) {
                                completeChallengeReward(challenge, index);
                            }
                            break;
                    }
                } else if (challenge.stat === 'level') {
                    // å¢ƒç•Œç­‰çº§å¯¹æ¯”
                    const currentLevel = gameState.levels.findIndex(l => l.name === gameState.stats.level);
                    const targetLevel = gameState.levels.findIndex(l => l.name === challenge.target);

                    if (currentLevel >= targetLevel && !challenge.completed) {
                        completeChallengeReward(challenge, index);
                    }
                } else if (value >= challenge.target && !challenge.completed) {
                    completeChallengeReward(challenge, index);
                }
            });
        }

        // æ›´æ–°æŒ‘æˆ˜è¿›åº¦æ¡
        function updateChallengeProgress(index, progress, completed) {
            const progressBar = elements.challenges[index];
            if (progressBar) {
                progressBar.style.width = `${progress}%`;

                // æ›´æ–°æŒ‘æˆ˜å…ƒç´ çŠ¶æ€
                const challengeElement = progressBar.closest('.challenge');
                if (challengeElement) {
                    if (completed) {
                        challengeElement.classList.add('completed');
                    } else {
                        challengeElement.classList.remove('completed');
                    }
                }
            }
        }

        // å®ŒæˆæŒ‘æˆ˜æ—¶ç»™äºˆå¥–åŠ±
        function completeChallengeReward(challenge, index) {
            challenge.completed = true;

            // æ·»åŠ å¥–åŠ±
            addLog(`å®ŒæˆæŒ‘æˆ˜ï¼š${challenge.name}`, 'achievement');

            // ä¸åŒæŒ‘æˆ˜ç»™äºˆä¸åŒå¥–åŠ±
            switch (index) {
                case 0: // åˆå…¥é“é—¨
                    addStat('cultivation', 50);
                    addStat('luck', 1);
                    break;
                case 1: // å°æœ‰æ‰€æˆ
                    addStat('taoism', 2);
                    addStat('spirit', 20);
                    break;
                case 2: // å¾—é“é«˜äºº
                    addStat('cultivation', 100);
                    addStat('enlightenment', 2);
                    break;
                case 3: // ä½“é­„å¼ºå¥
                    addStat('energy', 50);
                    addStat('maxEnergy', 20);
                    break;
                case 4: // ç²¾ç¥é¥±æ»¡
                    addStat('spirit', 50);
                    addStat('maxSpirit', 20);
                    break;
                case 5: // å¹¿ç§¯ç¦ç¼˜
                    addStat('luck', 3);
                    addStat('enlightenment', 2);
                    // é¢å¤–å¥–åŠ±ç‰©å“
                    gameState.inventory.stones = (gameState.inventory.stones || 0) + 5;
                    addLog("è·å¾—5æšçµçŸ³å¥–åŠ±ï¼");
                    break;
                case 6: // é“è¡Œç²¾æ·±
                    // å¤§å¹…æå‡å±æ€§ä¸Šé™
                    addStat('maxEnergy', 30);
                    addStat('maxSpirit', 30);
                    addStat('energy', 100);
                    addStat('spirit', 100);
                    break;
                case 7: // ä¸¹è¯å¤§å¸ˆ
                    // è·å¾—ç‚¼ä¸¹æœ¯ç‰¹æ®Šæ•ˆæœ
                    addStat('enlightenment', 3);
                    // é¢å¤–ç»™10ä¸ªè¯æ
                    gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 10;
                    addLog("è·å¾—10ä»½çè´µè¯æï¼");
                    break;
                case 8: // ç¬¦ç®“å®—å¸ˆ
                    addStat('taoism', 5);
                    addStat('cultivation', 100);
                    break;
                default:
                    addStat('cultivation', 50);
            }

            // æ›´æ–°ç‰©å“æ 
            updateInventory();

            // æŒ‘æˆ˜å®Œæˆåä¿å­˜æ¸¸æˆçŠ¶æ€
            saveGame();

            // æ£€æŸ¥æ˜¯å¦è§£é”æ–°æ´»åŠ¨
            checkActivityUnlocks();
        }

        // è§¦å‘éšæœºäº‹ä»¶
        function triggerRandomEvent() {
            // ç¡®ä¿åœæ­¢æŒ‚æœºå¾ªç¯
            stopAfkLoop();

            // è®°å½•æœ¬æ¬¡äº‹ä»¶æ—¶é—´
            gameState.lastEventTime = gameState.timeElapsed;

            // æ ¹æ®ç©å®¶çŠ¶æ€é€‰æ‹©åˆé€‚çš„äº‹ä»¶
            let availableEvents = [...gameState.events];

            // ç­›é€‰é€‚åˆå½“å‰ç©å®¶çŠ¶æ€çš„äº‹ä»¶
            // ä¾‹å¦‚ï¼Œå¦‚æœç©å®¶çš„é“æ³•å¾ˆä½ï¼Œæ’é™¤éœ€è¦é«˜é“æ³•çš„äº‹ä»¶é€‰é¡¹
            if (gameState.stats.taoism < 5) {
                availableEvents = availableEvents.filter(event => {
                    return !event.options.some(option =>
                        option.effect.toString().includes('taoism >= 5')
                    );
                });
            }

            // åŸºäºå½“å‰æ´»åŠ¨ç­›é€‰äº‹ä»¶ï¼ˆæŸäº›æ´»åŠ¨å¯èƒ½è§¦å‘ç‰¹å®šäº‹ä»¶ï¼‰
            if (gameState.currentActivity === 'herbs') {
                // åœ¨é‡‡è¯æ—¶å¢åŠ ä¸è¯æç›¸å…³äº‹ä»¶çš„æƒé‡
                const herbEvents = availableEvents.filter(e =>
                    e.title.includes('è¯') || e.desc.includes('è¯æ') || e.desc.includes('çµèŠ')
                );
                if (herbEvents.length > 0 && Math.random() < 0.7) {
                    availableEvents = herbEvents;
                }
            } else if (gameState.currentActivity === 'reading') {
                // åœ¨è¯»ç»æ—¶å¢åŠ ä¸æ‚Ÿé“ç›¸å…³äº‹ä»¶çš„æƒé‡
                const readingEvents = availableEvents.filter(e =>
                    e.title.includes('æ‚Ÿ') || e.desc.includes('ç§˜ç±') || e.desc.includes('å¤ç±')
                );
                if (readingEvents.length > 0 && Math.random() < 0.7) {
                    availableEvents = readingEvents;
                }
            }

            // éšæœºé€‰æ‹©ä¸€ä¸ªäº‹ä»¶
            const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];

            // æ’­æ”¾å£°éŸ³æé†’ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (gameState.soundEnabled) {
                playSound('event');
            }

            // æ›´æ–°äº‹ä»¶UI
            elements.eventTitle.textContent = event.title;
            elements.eventDesc.textContent = event.desc;

            // æ¸…ç©ºå¹¶æ·»åŠ é€‰é¡¹
            elements.eventOptions.innerHTML = '';
            event.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'btn';
                button.textContent = option.text;

                // æ£€æŸ¥æ˜¯å¦æœ‰æ¡ä»¶é™åˆ¶
                let isDisabled = false;
                let disabledReason = '';

                // æ£€æŸ¥é€‰é¡¹æ˜¯å¦æœ‰å‰ææ¡ä»¶
                if (option.requires) {
                    for (const [stat, value] of Object.entries(option.requires)) {
                        if (gameState.stats[stat] < value) {
                            isDisabled = true;
                            disabledReason = `éœ€è¦${stat === 'taoism' ? 'é“æ³•' :
                                stat === 'enlightenment' ? 'æ‚Ÿæ€§' :
                                    stat === 'luck' ? 'ç¦ç¼˜' : stat}è‡³å°‘${value}ç‚¹`;
                            break;
                        }
                    }
                }

                if (isDisabled) {
                    button.disabled = true;
                    button.title = disabledReason;
                    button.style.opacity = "0.6";
                    // æ·»åŠ æ¡ä»¶æç¤º
                    const reasonText = document.createElement('small');
                    reasonText.textContent = `(${disabledReason})`;
                    reasonText.style.display = 'block';
                    reasonText.style.marginTop = '3px';
                    reasonText.style.color = '#888';
                    button.appendChild(reasonText);
                }

                button.addEventListener('click', () => {
                    // æ‰§è¡Œé€‰é¡¹æ•ˆæœ
                    option.effect();

                    // éšè—äº‹ä»¶UI
                    elements.randomEvent.style.display = 'none';
                    elements.eventOverlay.style.display = 'none';

                    // æ·»åŠ åˆ°æ—¥å¿—
                    addLog(`äº‹ä»¶ï¼š${event.title} - é€‰æ‹©äº†"${option.text}"`, 'event');

                    // æ›´æ–°çŠ¶æ€å’ŒæŒ‘æˆ˜
                    updateStats();
                    updateChallenges();

                    // å¦‚æœä¹‹å‰åœ¨æŒ‚æœºï¼Œåˆ™ç»§ç»­æŒ‚æœº
                    if (gameState.afk) {
                        startAfkLoop();
                    }
                });
                elements.eventOptions.appendChild(button);
            });

            // æ˜¾ç¤ºäº‹ä»¶UI
            elements.randomEvent.style.display = 'block';
            elements.eventOverlay.style.display = 'block';
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            try {
                const sounds = {
                    event: new Audio('data:audio/mp3;base64,SUQzAwAAAAACJ1RZRV...'), // ç®€çŸ­éŸ³æ•ˆçš„base64ç¼–ç 
                    levelUp: new Audio('data:audio/mp3;base64,SUQzAwAAAAACJ1RZRV...')
                };

                if (sounds[type]) {
                    sounds[type].volume = 0.5; // è®¾ç½®éŸ³é‡
                    sounds[type].play().catch(err => console.log('æ— æ³•æ’­æ”¾éŸ³æ•ˆ:', err));
                }
            } catch (error) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
            }
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(text, type = "normal") {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `${text} <span class="time">${gameState.timeElapsed}åˆ†é’Ÿ</span>`;

            const logContainer = document.getElementById('log-container');
            if (logContainer) {
                logContainer.prepend(logEntry);

                // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
                if (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }

            // å¯¹é‡è¦æ—¥å¿—æ·»åŠ åŠ¨ç”»æ•ˆæœ
            if (type === 'achievement' || type === 'level-up') {
                logEntry.style.animation = 'none'; // é‡ç½®åŠ¨ç”»
                setTimeout(() => {
                    logEntry.style.animation = 'pulse 2s ease-in-out';
                }, 10);
            }
        }

        // ç¡®ä¿åœæ­¢æŒ‚æœºå¾ªç¯æ—¶æ¸…ç†å¹²å‡€
        function stopAfkLoop() {
            if (afkInterval) {
                clearInterval(afkInterval);
                afkInterval = null;
            }
        }

        // åˆå§‹åŒ–æ ‡ç­¾ç³»ç»Ÿ
        function initTabs() {
            // è·å–æ‰€æœ‰æ ‡ç­¾å’Œå†…å®¹åŒºåŸŸ
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            // ä¸ºæ¯ä¸ªæ ‡ç­¾æ·»åŠ ç‚¹å‡»äº‹ä»¶
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ´»è·ƒçŠ¶æ€
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // è®¾ç½®å½“å‰æ ‡ç­¾ä¸ºæ´»è·ƒ
                    tab.classList.add('active');

                    // è·å–æ ‡ç­¾å¯¹åº”çš„å†…å®¹ID
                    const tabId = tab.getAttribute('data-tab');
                    const tabContent = document.getElementById(`${tabId}-tab`);

                    // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                });
            });
        }

        // æ›´æ–°æ‰€æœ‰UI
        function updateAllUI() {
            updateStats();
            updateChallenges();
            updateInventory();
            updateActivityStatus();
            checkActivityUnlocks();
        }

        // æ›´æ–°æ´»åŠ¨çŠ¶æ€
        function updateActivityStatus() {
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çš„activeçŠ¶æ€
            document.querySelectorAll('.activity').forEach(activity => {
                if (activity.getAttribute('data-activity') !== gameState.currentActivity) {
                    activity.classList.remove('active');
                } else {
                    activity.classList.add('active');
                }
            });

            // æ›´æ–°å½“å‰æ´»åŠ¨æ˜¾ç¤º
            if (gameState.currentActivity && elements.currentActivity) {
                elements.currentActivity.textContent =
                    gameState.activities[gameState.currentActivity].name;
            } else if (elements.currentActivity) {
                elements.currentActivity.textContent = 'é—²æ•£';
            }
        }

        // æ›´æ–°ç‰©å“æ æ˜¾ç¤º
        function updateInventory() {
            // æ›´æ–°è¯ææ•°é‡
            const herbsElement = document.getElementById('herbs-count');
            if (herbsElement && gameState.inventory && typeof gameState.inventory.herbs !== 'undefined') {
                herbsElement.textContent = gameState.inventory.herbs;
            }

            // æ›´æ–°ç¬¦ç®“æ•°é‡
            const talismansElement = document.getElementById('talismans-count');
            if (talismansElement && gameState.inventory && typeof gameState.inventory.talismans !== 'undefined') {
                talismansElement.textContent = gameState.inventory.talismans;
            }

            // æ›´æ–°ä¸¹è¯æ•°é‡
            const potionsElement = document.getElementById('potions-count');
            if (potionsElement && gameState.inventory && typeof gameState.inventory.potions !== 'undefined') {
                potionsElement.textContent = gameState.inventory.potions;
            }

            // æ›´æ–°çµçŸ³æ•°é‡
            const stonesElement = document.getElementById('stones-count');
            if (stonesElement && gameState.inventory && typeof gameState.inventory.stones !== 'undefined') {
                stonesElement.textContent = gameState.inventory.stones;
            }
        }

        // æ£€æŸ¥å¹¶è§£é”æ´»åŠ¨
        function checkActivityUnlocks() {
            document.querySelectorAll('.activity[data-requirement]').forEach(activity => {
                const requirements = activity.getAttribute('data-requirement').split(',');
                let allMet = true;
                let missingReqs = [];

                for (let req of requirements) {
                    const [stat, value] = req.split(':');

                    if (stat === 'level') {
                        const currentLevelIndex = gameState.levels.findIndex(l => l.name === gameState.stats.level);
                        const requiredLevelIndex = gameState.levels.findIndex(l => l.name === value);

                        if (currentLevelIndex < requiredLevelIndex) {
                            allMet = false;
                            missingReqs.push(`éœ€è¦å¢ƒç•Œï¼š${value}`);
                            break;
                        }
                    } else {
                        if (gameState.stats[stat] < parseFloat(value)) {
                            allMet = false;
                            const statNames = {
                                'cultivation': 'ä¿®ä¸º',
                                'spirit': 'ç²¾ç¥åŠ›',
                                'energy': 'ä½“åŠ›',
                                'enlightenment': 'æ‚Ÿæ€§',
                                'luck': 'ç¦ç¼˜',
                                'taoism': 'é“æ³•',
                                'maxSpirit': 'ç²¾ç¥åŠ›ä¸Šé™',
                                'maxEnergy': 'ä½“åŠ›ä¸Šé™'
                            };

                            missingReqs.push(`${statNames[stat] || stat}ï¼š${value}`);
                            break;
                        }
                    }
                }

                if (allMet) {
                    if (activity.classList.contains('locked')) {
                        activity.classList.remove('locked');
                        const activityId = activity.getAttribute('data-activity');
                        addLog(`è§£é”äº†æ–°çš„ä¿®ç‚¼æ–¹å¼ï¼š${gameState.activities[activityId].name}`, 'achievement');

                        // ç§»é™¤æç¤ºå…ƒç´ 
                        const tooltipEl = activity.querySelector('.unlock-tooltip');
                        if (tooltipEl) {
                            tooltipEl.remove();
                        }
                    }
                } else {
                    activity.classList.add('locked');

                    // æ·»åŠ æˆ–æ›´æ–°æœªæ»¡è¶³æ¡ä»¶çš„æç¤º
                    let tooltipEl = activity.querySelector('.unlock-tooltip');
                    if (!tooltipEl) {
                        tooltipEl = document.createElement('div');
                        tooltipEl.className = 'unlock-tooltip';
                        activity.appendChild(tooltipEl);
                    }

                    tooltipEl.innerHTML = `<strong>æœªæ»¡è¶³æ¡ä»¶:</strong><br>` +
                        missingReqs.map(req => `- ${req}`).join('<br>');
                }
            });
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ¸¸æˆ
        function loadGame() {
            try {
                // å…ˆåŠ è½½è®¾ç½®
                const savedSettings = localStorage.getItem('daoshiSettings');
                if (savedSettings) {
                    gameState.settings = JSON.parse(savedSettings);
                }

                // å°è¯•åŠ è½½ä¸»å­˜æ¡£
                const savedGame = localStorage.getItem('daoshiGame');

                // å¦‚æœä¸»å­˜æ¡£ä¸å¯ç”¨ï¼Œå°è¯•åŠ è½½å¤‡ä»½
                if (!savedGame) {
                    const backupGame = localStorage.getItem('daoshiGame_backup');
                    if (backupGame) {
                        addLog("ä¸»å­˜æ¡£ä¸¢å¤±ï¼Œæ­£åœ¨ä»å¤‡ä»½æ¢å¤...", "system");
                        loadGameData(backupGame);
                        // æ¢å¤åç«‹å³ä¿å­˜åˆ°ä¸»å­˜æ¡£
                        saveGame();
                        return;
                    }
                } else {
                    // ä¸»å­˜æ¡£å¯ç”¨ï¼Œæ­£å¸¸åŠ è½½
                    loadGameData(savedGame);
                    return;
                }

                // å¦‚æœæ²¡æœ‰å­˜æ¡£ï¼Œåˆå§‹åŒ–æ–°æ¸¸æˆ
                initNewGame();

            } catch (error) {
                console.error("åŠ è½½æ¸¸æˆæ—¶å‡ºé”™:", error);
                addLog("åŠ è½½æ¸¸æˆæ•°æ®å¤±è´¥", "error");

                // å‡ºé”™æ—¶å°è¯•ä»å¤‡ä»½æ¢å¤
                try {
                    const backupGame = localStorage.getItem('daoshiGame_backup');
                    if (backupGame) {
                        addLog("å°è¯•ä»å¤‡ä»½æ¢å¤...", "system");
                        loadGameData(backupGame);
                        return;
                    }
                } catch (backupError) {
                    console.error("å¤‡ä»½æ¢å¤å¤±è´¥:", backupError);
                }

                // å¦‚æœä¸€åˆ‡å¤±è´¥ï¼Œåˆå§‹åŒ–æ–°æ¸¸æˆ
                initNewGame();
            }

            // åŠ è½½åæ›´æ–°UI
            updateAllUI();
        }

        // åˆå§‹åŒ–æ–°æ¸¸æˆ
        function initNewGame() {
            // åˆå§‹å­£èŠ‚å’Œæ—¶é—´
            gameState.season = 'spring';
            gameState.time = 8; // åˆå§‹æ—¶é—´ä¸ºæ—©ä¸Š8ç‚¹
            gameState.dayTime = true;
            gameState.daysPassed = 1;
            gameState.lastBackup = Date.now();

            // æ£€æŸ¥æ´»åŠ¨è§£é”çŠ¶æ€
            checkActivityUnlocks();

            addLog("å¼€å§‹æ–°çš„ä¿®é“ä¹‹æ—…");
        }

        // åŠ è½½æ¸¸æˆæ•°æ®
        function loadGameData(savedGameString) {
            const savedState = JSON.parse(savedGameString);

            // æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§ (æœªæ¥å¯æ‰©å±•)
            // if (savedState.version < requiredVersion) { æ‰§è¡Œæ•°æ®è¿ç§»é€»è¾‘ }

            // åˆå¹¶ä¿å­˜çš„çŠ¶æ€åˆ°å½“å‰æ¸¸æˆçŠ¶æ€
            if (savedState.stats) {
                Object.keys(savedState.stats).forEach(key => {
                    gameState.stats[key] = savedState.stats[key];
                });
            }

            if (savedState.inventory) {
                gameState.inventory = savedState.inventory;
            }

            if (savedState.timeElapsed) {
                gameState.timeElapsed = savedState.timeElapsed;
            }

            if (savedState.daysPassed) {
                gameState.daysPassed = savedState.daysPassed;
            }

            if (savedState.season) {
                gameState.season = savedState.season;
            }

            if (savedState.time) {
                gameState.time = savedState.time;
            }

            if (savedState.dayTime !== undefined) {
                gameState.dayTime = savedState.dayTime;
            }

            if (savedState.challenges) {
                gameState.challenges = savedState.challenges;
            }

            if (savedState.timestamp) {
                gameState.lastLoadTime = savedState.timestamp;
            }

            // è®°å½•ä¸Šæ¬¡å¤‡ä»½æ—¶é—´
            if (savedState.timestamp) {
                gameState.lastBackup = savedState.timestamp;
            }

            // æ›´æ–°æŒ‚æœºçŠ¶æ€
            if (savedState.currentActivity) {
                selectActivity(savedState.currentActivity);
            }

            // æ£€æŸ¥æ´»åŠ¨è§£é”çŠ¶æ€
            checkActivityUnlocks();

            addLog("æ¸¸æˆæ•°æ®å·²åŠ è½½", "achievement");
        }

        // ä¿å­˜æ¸¸æˆåˆ°æœ¬åœ°å­˜å‚¨
        function saveGame() {
            try {
                // åˆ›å»ºè¦ä¿å­˜çš„æ¸¸æˆæ•°æ®å¯¹è±¡
                const gameData = {
                    version: "1.0", // æ¸¸æˆç‰ˆæœ¬ï¼Œæ–¹ä¾¿æœªæ¥å¤„ç†æ•°æ®å…¼å®¹æ€§
                    timestamp: Date.now(), // ä¿å­˜æ—¶é—´æˆ³
                    stats: gameState.stats,
                    inventory: gameState.inventory,
                    timeElapsed: gameState.timeElapsed,
                    currentActivity: gameState.currentActivity,
                    daysPassed: gameState.daysPassed,
                    season: gameState.season,
                    time: gameState.time,
                    dayTime: gameState.dayTime,
                    challenges: gameState.challenges
                };

                // ä¿å­˜ä¸»å­˜æ¡£
                localStorage.setItem('daoshiGame', JSON.stringify(gameData));

                // åˆ›å»ºè‡ªåŠ¨å¤‡ä»½ (æ¯å°æ—¶ä¸€æ¬¡)
                if (!gameState.lastBackup || (Date.now() - gameState.lastBackup > 3600000)) {
                    localStorage.setItem('daoshiGame_backup', JSON.stringify(gameData));
                    gameState.lastBackup = Date.now();
                    console.log("åˆ›å»ºäº†æ¸¸æˆæ•°æ®å¤‡ä»½");
                }
            } catch (error) {
                console.error("ä¿å­˜æ¸¸æˆæ—¶å‡ºé”™:", error);
                addLog("ä¿å­˜æ¸¸æˆæ•°æ®å¤±è´¥", "error");
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            if (confirm("ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¼šä¸¢å¤±ï¼")) {
                // æ¸…é™¤æ¸¸æˆæ•°æ®
                localStorage.removeItem('daoshiGame');

                // ä¿ç•™ç”¨æˆ·è®¾ç½®
                const savedSettings = gameState.settings;

                // é‡ç½®æ¸¸æˆçŠ¶æ€
                gameState.stats = {
                    name: "æ¸…è™šå­",
                    level: "åˆå…¥é“é—¨",
                    cultivation: 0,
                    spirit: 10,
                    energy: 100,
                    enlightenment: 1,
                    luck: 1,
                    taoism: 1,
                    maxSpirit: 100,
                    maxEnergy: 100
                };

                gameState.inventory = {
                    herbs: 0,
                    talismans: 0,
                    potions: 0,
                    stones: 0
                };

                gameState.currentActivity = null;
                gameState.afk = false;
                gameState.timeElapsed = 0;

                // é‡ç½®æŒ‘æˆ˜çŠ¶æ€
                gameState.challenges.forEach(challenge => {
                    challenge.completed = false;
                });

                // åˆå§‹å­£èŠ‚å’Œæ—¶é—´
                gameState.season = 'spring';
                gameState.time = 8;
                gameState.dayTime = true;
                gameState.daysPassed = 1;

                // è¿˜åŸç”¨æˆ·è®¾ç½®
                gameState.settings = savedSettings;

                // å¦‚æœæ­£åœ¨æŒ‚æœºï¼Œåœæ­¢æŒ‚æœº
                if (afkInterval) {
                    stopAfkLoop();
                    elements.toggleAfk.textContent = "å¼€å§‹æŒ‚æœºä¿®ç‚¼";
                    document.getElementById('afk-status').classList.remove('afk-active');
                    const statusValue = document.querySelector('#afk-status .status-value');
                    if (statusValue) {
                        statusValue.textContent = "æœªå¼€å§‹";
                    }
                }

                // æ¸…ç©ºæ—¥å¿—
                const logContainer = document.getElementById('log-container');
                if (logContainer) {
                    logContainer.innerHTML = '';
                }

                // æ›´æ–°UI
                updateAllUI();

                // é‡æ–°æ£€æŸ¥æ´»åŠ¨è§£é”çŠ¶æ€
                checkActivityUnlocks();

                // æ·»åŠ é‡ç½®æ¸¸æˆçš„æ—¥å¿—
                addLog("æ¸¸æˆå·²é‡ç½®ï¼Œå¼€å§‹æ–°çš„ä¿®é“ä¹‹æ—…ï¼", "achievement");
            }
        }

        // ä½¿ç”¨ä¸¹è¯åŠŸèƒ½
        function usePotion() {
            if (gameState.inventory.potions && gameState.inventory.potions > 0) {
                gameState.inventory.potions--;

                // æ¢å¤ä½“åŠ›å’Œç²¾ç¥åŠ›
                gameState.stats.energy = gameState.stats.maxEnergy;
                gameState.stats.spirit = gameState.stats.maxSpirit;

                // å°æ¦‚ç‡æå‡ä¿®ä¸º
                if (Math.random() < 0.2) {
                    addStat('cultivation', 20);
                    addLog("æœç”¨ä¸¹è¯åä½ çªç„¶é¡¿æ‚Ÿï¼Œä¿®ä¸ºå¤§å¢ï¼", "achievement");
                } else {
                    addLog("æœç”¨ä¸¹è¯æ¢å¤äº†ä½“åŠ›å’Œç²¾ç¥åŠ›ï¼");
                }

                // æ›´æ–°ç•Œé¢
                updateStats();
                updateInventory();
            } else {
                addLog("ä½ æ²¡æœ‰ä¸¹è¯å¯ç”¨ï¼", "error");
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        initGame();

        function gotoPage(url) {
            url && window.open(url);
        }
    </script>

    <script>
        // åˆ›å»ºå…¨å±€æ ·å¼å’Œå¼¹çª—ç»“æ„ï¼ˆå…¼å®¹ç§»åŠ¨ç«¯ï¼‰
        document.addEventListener('DOMContentLoaded', function () {
            const style = document.createElement('style');
            style.textContent = `
    .meal-alert-mask {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 9999;
        display: none;
    }
    .meal-alert-box {
        position: relative;
        width: 80%;
        max-width: 300px;
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    .meal-close-btn {
        display: block;
        margin: 15px auto 0;
        padding: 8px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 12px;
        touch-action: manipulation;
    }
`;
            document.head.appendChild(style);

            const alertHTML = `
    <div class="meal-alert-mask">
        <div class="meal-alert-box">
            <h3>ğŸ´ ç”¨é¤æ—¶é—´åˆ°ï¼</h3>
            <p>è®°å¾—åŠæ—¶è¡¥å……èƒ½é‡å“¦~</p>
            <div style="display: flex;">
                <button class="meal-close-btn" style="background-color: #ffffff;color: #888888;border: 1px solid #888888;">å…³é—­</button>
                <button class="meal-close-btn meal-open-btn">ä¼˜æƒ å·</button>
            </div>
        </div>
    </div>
`;
            document.body.insertAdjacentHTML('beforeend', alertHTML);
        });

        // å¼¹çª—æ§åˆ¶é€»è¾‘ 
        const mealAlert = {
            init() {
                this.bindEvents();
                this.startTimer();
                // this.showAlert();
            },

            bindEvents() {
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.meal-close-btn')) {
                        this.hideAlert();
                    }

                    if (e.target.closest('.meal-open-btn')) {
                        gotoPage('https://moyugame965.github.io/Coupon/');
                    }
                });
            },

            showAlert() {
                document.querySelector('.meal-alert-mask').style.display = 'block';
            },

            hideAlert() {
                document.querySelector('.meal-alert-mask').style.display = 'none';
            },

            checkTime() {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMin = now.getMinutes();

                // åœ¨11:00å’Œ17:00æ•´ç‚¹è§¦å‘ï¼Œè¯¯å·®æ§åˆ¶åœ¨1åˆ†é’Ÿå†… 
                if ((currentHour === 11 || currentHour === 12 || currentHour === 17 || currentHour === 18) && currentMin === 0) {
                    this.showAlert();
                }
            },

            startTimer() {
                // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ—¶é—´ 
                setInterval(() => this.checkTime(), 60000);
                // åˆå§‹åŒ–ç«‹å³æ£€æŸ¥ï¼ˆé¿å…é¡µé¢æ‰“å¼€æ—¶æ­£å¥½å¤„äºç›®æ ‡æ—¶é—´ï¼‰
                this.checkTime();
            }
        };

        // åˆå§‹åŒ– 
        mealAlert.init();
        // setTimeout(() => {
        //     mealAlert.showAlert();
        // }, 2000);

    </script>
</body>

</html>