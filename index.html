<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÈÅìÂ£´‰øÆÁÇºÊ®°ÊãüÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            background-color: #f3ece7;
            /* background-image: url('https://img.freepik.com/free-photo/chinese-pavilion-mountains_1150-17812.jpg'); */
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            padding: 10px;
            font-size: 16px;
            /* Ê∑ªÂä†ÈªòËÆ§Â≠ó‰ΩìÂ§ßÂ∞è */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
            /* Â¢ûÂº∫Èò¥ÂΩ±ÊïàÊûú */
            backdrop-filter: blur(5px);
            /* Ê∑ªÂä†ËÉåÊôØÊ®°Á≥äÊïàÊûú */
            -webkit-backdrop-filter: blur(5px);
            /* SafariÊîØÊåÅ */
        }

        header {
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        h1 {
            color: #8b4513;
            font-size: 1.8em;
            text-shadow: 1px 1px 2px #ccc;
        }

        .section {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border-left: 4px solid #8b4513;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .section-header {
            background-color: rgba(139, 69, 19, 0.1);
            padding: 10px 15px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
        }

        .section-content {
            padding: 15px;
        }

        h2 {
            color: #8b4513;
            margin: 0;
            font-size: 1.3em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
        }

        .stat {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.95em;
            transition: all 0.2s;
        }

        .stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stat-name {
            font-weight: bold;
            color: #555;
        }

        .stat-value {
            float: right;
            color: #8b4513;
            font-weight: bold;
        }

        .activities {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .activity {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .activity:hover,
        .activity:active {
            background-color: #e9e9e9;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .activity.active {
            background-color: rgba(139, 69, 19, 0.15);
            border-color: #8b4513;
            box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.3);
        }

        .activity.locked {
            background-color: #f0f0f0;
            opacity: 0.7;
            cursor: not-allowed;
            position: relative;
            overflow: hidden;
        }

        .activity.locked::before {
            content: "üîí";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            color: #8b4513;
        }

        .activity.locked::after {
            content: "Êú™Ëß£ÈîÅ";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 5px;
            background-color: rgba(139, 69, 19, 0.5);
            color: white;
            font-size: 0.8em;
            text-align: center;
        }

        .unlock-tooltip {
            position: absolute;
            bottom: 25px;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px;
            font-size: 0.75em;
            border-radius: 4px;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            text-align: left;
            line-height: 1.4;
        }

        .activity.locked:hover .unlock-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .activity-name {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        .activity-desc {
            font-size: 0.85em;
            color: #777;
            flex-grow: 1;
        }

        /* Áä∂ÊÄÅÂíåÊó•ÂøóÈÉ®ÂàÜÊñ∞Ê†∑Âºè */
        .afk-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .status-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .current-status {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .status-icon {
            width: 40px;
            height: 40px;
            background-color: #8b4513;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 1.2em;
        }

        .status-details {
            flex-grow: 1;
        }

        .status-title {
            font-weight: bold;
            color: #555;
        }

        .status-value {
            color: #8b4513;
        }

        .status-time {
            font-size: 0.9em;
            color: #777;
        }

        .afk-active {
            background-color: rgba(139, 69, 19, 0.15);
            border-color: #8b4513;
            box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.3);
        }

        .afk-active .status-icon {
            background-color: #a0522d;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .btn {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            width: 100%;
            -webkit-appearance: none;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(139, 69, 19, 0.3);
        }

        .btn:hover,
        .btn:active {
            background-color: #a0522d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(139, 69, 19, 0.4);
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .logs {
            height: 230px;
            overflow-y: auto;
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.9em;
            -webkit-overflow-scrolling: touch;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 10px;
        }

        .log-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .log-entry:before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background-color: #8b4513;
            border-radius: 2px;
        }

        .log-entry.system {
            color: #888;
            font-style: italic;
            font-size: 0.9em;
        }

        .log-entry.system:before {
            background-color: #888;
        }

        .time {
            float: right;
            color: #999;
            font-size: 0.8em;
        }

        /* Ê†áÁ≠æÈ°µÊ†∑Âºè */
        .tab-container {
            display: flex;
            flex-direction: column;
            border-radius: 5px;
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            border-radius: 5px 5px 0 0;
        }

        .tab {
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f5f5f5;
            color: #666;
            font-weight: bold;
            text-align: center;
            flex-grow: 1;
            border-right: 1px solid #ddd;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab:hover {
            background-color: #e9e9e9;
        }

        .tab.active {
            background-color: #fff;
            color: #8b4513;
            border-bottom: 3px solid #8b4513;
        }

        .tab-content {
            display: none;
            background-color: #fff;
            padding: 15px;
            border-radius: 0 0 5px 5px;
            border: 1px solid #ddd;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .challenges {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .challenge {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            transition: all 0.3s;
        }

        .challenge:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .challenge-name {
            font-weight: bold;
            color: #555;
        }

        .challenge-desc {
            font-size: 0.85em;
            color: #777;
            margin-top: 3px;
        }

        .challenge-progress {
            margin-top: 8px;
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .challenge-progress-bar {
            height: 100%;
            background-color: #8b4513;
            width: 0%;
            transition: width 0.5s;
        }

        .event {
            background-color: #fff8e1;
            border-left: 4px solid #ffd54f;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .event-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        #event-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        #event-options .btn {
            margin-top: 0;
        }

        @media (max-width: 700px) {
            .afk-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 10px;
                border-radius: 8px;
                gap: 10px;
            }

            h1 {
                font-size: 1.5em;
            }

            h2 {
                font-size: 1.2em;
            }

            .tab {
                padding: 10px 8px;
                font-size: 0.9em;
            }

            .activity {
                min-height: 70px;
                padding: 10px;
            }

            .activity-name {
                font-size: 0.9em;
            }

            .activity-desc {
                font-size: 0.8em;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .activities {
                grid-template-columns: repeat(2, 1fr);
            }

            .btn {
                padding: 12px 10px;
                font-size: 0.95em;
            }

            .logs {
                height: 180px;
            }

            .log-entry {
                font-size: 0.9em;
            }

            .event {
                width: 95%;
                padding: 12px;
            }
        }

        @media (max-width: 320px) {

            .stats-grid,
            .activities {
                grid-template-columns: 1fr;
            }

            .activity {
                min-height: auto;
            }
        }

        /* Ëá™Âä®‰øùÂ≠òÊèêÁ§∫Ê†∑Âºè */
        .save-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(92, 184, 92, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 0.9em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            animation: fadeInOut 2s ease-in-out;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            20% {
                opacity: 1;
                transform: translateY(0);
            }

            80% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 0;
                transform: translateY(-20px);
            }
        }

        /* Ê∑ªÂä†Ê∑±Ëâ≤Ê®°ÂºèÊîØÊåÅ */
        @media (prefers-color-scheme: dark) {
            body {
                color: #f0f0f0;
            }

            .container {
                background-color: rgba(40, 40, 40, 0.9);
                color: #f0f0f0;
            }
        }

        /* Ê∑ªÂä†ÂìçÂ∫îÂºèËÆæËÆ°Â¢ûÂº∫ */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
        }
    </style>
</head>

<body>
    

    <div class="container">
        <header>
            <h1>ÈÅìÂ£´‰øÆÁÇºÊåÇÊú∫Ê®°ÊãüÂô®</h1>
            <p>‰ΩìÈ™åÈÅìÂ£´ÁöÑ‰øÆÁÇº‰πãÊóÖÔºåÊÑüÊÇüÂ§©Âú∞Ëá™ÁÑ∂</p>
            <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                <button class="btn" id="reset-game"
                    style="width: auto; padding: 5px 10px; background-color: #d9534f;">ÈáçÁΩÆÊ∏∏Êàè</button>
                <div class="game-settings">
                    <button class="btn" id="toggle-settings"
                        style="width: auto; padding: 5px 10px; background-color: #5bc0de;">ËÆæÁΩÆ</button>
                    <div id="settings-panel"
                        style="display: none; position: absolute; right: 15px; background: white; border: 1px solid #ddd; border-radius: 5px; padding: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; width: 200px;">
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="sound-toggle" style="margin-right: 8px;">
                                <span>ÂêØÁî®Èü≥Êïà</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="auto-save-toggle" style="margin-right: 8px;" checked>
                                <span>Ëá™Âä®‰øùÂ≠ò</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px;">Ëá™Âä®‰øùÂ≠òÈ¢ëÁéáÔºàÂàÜÈíüÔºâ</label>
                            <select id="auto-save-interval"
                                style="width: 100%; padding: 5px; border-radius: 3px; border: 1px solid #ddd;">
                                <option value="1">1ÂàÜÈíü</option>
                                <option value="3">3ÂàÜÈíü</option>
                                <option value="5">5ÂàÜÈíü</option>
                                <option value="10">10ÂàÜÈíü</option>
                            </select>
                        </div>
                        <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                            <button class="btn" id="clear-cache"
                                style="width: 100%; padding: 5px; background-color: #f0ad4e; margin-bottom: 5px;">Ê∏ÖÁêÜÁºìÂ≠ò</button>
                            <button class="btn" id="export-save"
                                style="width: 100%; padding: 5px; background-color: #5cb85c; margin-bottom: 5px;">ÂØºÂá∫Â≠òÊ°£</button>
                            <button class="btn" id="import-save"
                                style="width: 100%; padding: 5px; background-color: #5bc0de; margin-bottom: 5px;">ÂØºÂÖ•Â≠òÊ°£</button>
                            <input type="file" id="save-file-input" style="display:none" accept=".json">
                        </div>
                        <!-- ÁßªÈô§Â≠òÊ°£ÊßΩ‰ΩçÂäüËÉΩ -->
                    </div>
                </div>
            </div>
        </header>

        <div class="section">
            <div class="section-header">
                <h2>ÈÅìÈïø‰ø°ÊÅØ</h2>
            </div>
            <div class="section-content">
                <div class="stats-grid">
                    <div class="stat">
                        <span class="stat-name">ÈÅìÂè∑</span>
                        <span class="stat-value" id="name">Ê∏ÖËôöÂ≠ê</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">Â¢ÉÁïå</span>
                        <span class="stat-value" id="level">ÂàùÂÖ•ÈÅìÈó®</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">‰øÆ‰∏∫</span>
                        <span class="stat-value"><span id="cultivation">0</span></span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">Á≤æÁ•ûÂäõ</span>
                        <span class="stat-value"><span id="spirit">10</span>/100</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">‰ΩìÂäõ</span>
                        <span class="stat-value"><span id="energy">100</span>/100</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">ÊÇüÊÄß</span>
                        <span class="stat-value" id="enlightenment">1</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">Á¶èÁºò</span>
                        <span class="stat-value" id="luck">1</span>
                    </div>
                    <div class="stat">
                        <span class="stat-name">ÈÅìÊ≥ï</span>
                        <span class="stat-value" id="taoism">1</span>
                    </div>
                </div>
                <!-- ÁßªÈô§‰∫ÜÂéüÊù•‰ΩçÁΩÆÁöÑÈáçÁΩÆÊ∏∏ÊàèÊåâÈíÆ -->
            </div>
        </div>

        <!-- Ê†áÁ≠æÈ°µÁ≥ªÁªü -->
        <div class="section">
            <div class="tab-container">
                <div class="tab-nav">
                    <div class="tab active" data-tab="cultivation">ÂΩìÂâç‰øÆÁÇº</div>
                    <div class="tab" data-tab="challenges">ÊåÇÊú∫ÊåëÊàò</div>
                    <div class="tab" data-tab="inventory">ÈÅìÂÖ∑‰ªìÂ∫ì</div>
                </div>

                <div class="tab-content active" id="cultivation-tab">
                    <div class="section-content">
                        <div class="activities">
                            <div class="activity" data-activity="meditation">
                                <div class="activity-name">ÁõòÂùêÂÜ•ÊÉ≥</div>
                                <div class="activity-desc">ÈùôÂùêÂÜ•ÊÉ≥ÔºåÊèêÂçáÁ≤æÁ•ûÂäõÂíå‰øÆ‰∏∫</div>
                            </div>
                            <div class="activity" data-activity="reading">
                                <div class="activity-name">Á†îËØªÈÅìÁªè</div>
                                <div class="activity-desc">ÈòÖËØªÂè§Á±çÔºåÊèêÂçáÊÇüÊÄßÂíåÈÅìÊ≥ï</div>
                            </div>
                            <div class="activity" data-activity="breathing">
                                <div class="activity-name">ÂêêÁ∫≥Ê≥ï</div>
                                <div class="activity-desc">‰øÆÁÇºÂëºÂê∏Ê≥ïÈó®ÔºåÊÅ¢Â§ç‰ΩìÂäõÂíåÁ≤æÁ•ûÂäõ</div>
                            </div>
                            <div class="activity" data-activity="tea">
                                <div class="activity-name">ÂìÅËåóÊÇüÈÅì</div>
                                <div class="activity-desc">ÂìÅËå∂ÈùôÊÄùÔºåÊèêÂçáÊÇüÊÄßÂíåÁ¶èÁºò</div>
                            </div>
                            <div class="activity" data-activity="talisman">
                                <div class="activity-name">ÁÇºÂà∂Á¨¶ÁÆì</div>
                                <div class="activity-desc">ÁªòÂà∂ÈÅìÁ¨¶ÔºåÊèêÂçáÈÅìÊ≥ïÂíå‰øÆ‰∏∫</div>
                            </div>
                            <div class="activity" data-activity="herbs">
                                <div class="activity-name">ÈááÈõÜËçØËçâ</div>
                                <div class="activity-desc">Â±±‰∏≠ÈááËçØÔºåÊèêÂçá‰ΩìÂäõÂíåÁ¶èÁºò</div>
                            </div>
                            <div class="activity" data-activity="teaching" data-requirement="taoism:5">
                                <div class="activity-name">ÊéàÂæíËÆ≤ÈÅì</div>
                                <div class="activity-desc">‰º†ÈÅìÊéà‰∏öÔºåËé∑ÂæóÁÅµÁü≥ÂíåÊèêÂçáÈÅìÊ≥ï</div>
                            </div>
                            <div class="activity" data-activity="alchemy"
                                data-requirement="cultivation:200,enlightenment:3">
                                <div class="activity-name">ÁÇº‰∏π‰øÆÁÇº</div>
                                <div class="activity-desc">ÁÇºÂà∂‰∏πËçØÔºåÊèêÂçá‰øÆ‰∏∫ÂíåÊÇüÊÄß</div>
                            </div>
                            <div class="activity" data-activity="swordsmanship" data-requirement="energy:120">
                                <div class="activity-name">ÂâëÊúØ‰øÆÁÇº</div>
                                <div class="activity-desc">‰øÆÁÇºÂâëÊ≥ïÔºåÊèêÂçá‰ΩìÂäõ‰∏äÈôê</div>
                            </div>
                            <div class="activity" data-activity="waterfall" data-requirement="level:‰øÆË°åÂ∞èÊàê">
                                <div class="activity-name">ÁÄëÂ∏ÉÂÜ•ÊÉ≥</div>
                                <div class="activity-desc">Âú®ÁÄëÂ∏É‰∏ãÈùô‰øÆÔºåÂ§ßÂπÖÊèêÂçáÁ≤æÁ•ûÂäõ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="challenges-tab">
                    <div class="section-content">
                        <div class="challenges" id="challenges-container">
                            <div class="challenge">
                                <div class="challenge-name">ÂàùÂÖ•ÈÅìÈó®</div>
                                <div class="challenge-desc">Á¥ØÁßØ‰øÆÁÇº100ÁÇπ‰øÆ‰∏∫</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-1" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">Â∞èÊúâÊâÄÊàê</div>
                                <div class="challenge-desc">ÊÇüÊÄßËææÂà∞5ÁÇπ</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-2" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">ÂæóÈÅìÈ´ò‰∫∫</div>
                                <div class="challenge-desc">ÈÅìÊ≥ïËææÂà∞10ÁÇπ</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-3" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">‰ΩìÈ≠ÑÂº∫ÂÅ•</div>
                                <div class="challenge-desc">‰ΩìÂäõ‰∏äÈôêËææÂà∞150ÁÇπ</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-4" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">Á≤æÁ•ûÈ•±Êª°</div>
                                <div class="challenge-desc">Á≤æÁ•ûÂäõ‰∏äÈôêËææÂà∞150ÁÇπ</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-5" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">ÂπøÁßØÁ¶èÁºò</div>
                                <div class="challenge-desc">Á¶èÁºòËææÂà∞10ÁÇπ</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-6" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">ÈÅìË°åÁ≤æÊ∑±</div>
                                <div class="challenge-desc">ËææÂà∞Á≠ëÂü∫ÊúüÂ¢ÉÁïå</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-7" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">‰∏πËçØÂ§ßÂ∏à</div>
                                <div class="challenge-desc">ÁÇºÂà∂10È¢ó‰∏πËçØ</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-8" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="challenge">
                                <div class="challenge-name">Á¨¶ÁÆìÂÆóÂ∏à</div>
                                <div class="challenge-desc">Âà∂‰Ωú20Âº†ÁÅµÁ¨¶</div>
                                <div class="challenge-progress">
                                    <div class="challenge-progress-bar" id="challenge-9" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="inventory-tab">
                    <div class="section-content">
                        <div class="stats-grid">
                            <div class="stat">
                                <span class="stat-name">ËçØÊùê</span>
                                <span class="stat-value" id="herbs-count">0</span>
                            </div>
                            <div class="stat">
                                <span class="stat-name">ÁÅµÁ¨¶</span>
                                <span class="stat-value" id="talismans-count">0</span>
                            </div>
                            <div class="stat">
                                <span class="stat-name">‰∏πËçØ</span>
                                <span class="stat-value" id="potions-count">0</span>
                            </div>
                            <div class="stat">
                                <span class="stat-name">ÁÅµÁü≥</span>
                                <span class="stat-value" id="stones-count">0</span>
                            </div>
                        </div>
                        <div style="margin-top:15px">
                            <button class="btn" id="use-potion" onclick="usePotion()">ÊúçÁî®‰∏πËçØ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊåÇÊú∫Áä∂ÊÄÅÂíå‰øÆÁÇºËÆ∞ÂΩï -->
        <div class="afk-container">
            <div class="section">
                <div class="section-header">
                    <h2>ÊåÇÊú∫Áä∂ÊÄÅ</h2>
                </div>
                <div class="section-content status-section">
                    <div class="current-status">
                        <div class="status-icon">‚ö°</div>
                        <div class="status-details">
                            <div class="status-title">ÂΩìÂâçÁä∂ÊÄÅ</div>
                            <div class="status-value" id="current-activity">Èó≤Êï£</div>
                        </div>
                    </div>

                    <div class="current-status">
                        <div class="status-icon">‚è±Ô∏è</div>
                        <div class="status-details">
                            <div class="status-title">‰øÆÁÇºÊó∂Èó¥</div>
                            <div class="status-value"><span id="time-passed">0</span> ÂàÜÈíü</div>
                        </div>
                    </div>

                    <div class="current-status" id="afk-status">
                        <div class="status-icon">üîÑ</div>
                        <div class="status-details">
                            <div class="status-title">ÊåÇÊú∫Áä∂ÊÄÅ</div>
                            <div class="status-value">Êú™ÂºÄÂßã</div>
                        </div>
                    </div>

                    <button class="btn" id="toggle-afk">ÂºÄÂßãÊåÇÊú∫‰øÆÁÇº</button>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>‰øÆÁÇºËÆ∞ÂΩï</h2>
                </div>
                <div class="section-content">
                    <div class="logs" id="log-container">
                        <div class="log-entry">
                            ÂºÄÂßã‰∫Ü‰Ω†ÁöÑ‰øÆÈÅì‰πãÊóÖ...
                            <span class="time">0ÂàÜÈíü</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="event-overlay" id="event-overlay"></div>
        <div class="event" id="random-event">
            <h3 id="event-title">ÈöèÊú∫‰∫ã‰ª∂</h3>
            <p id="event-desc">‰∫ã‰ª∂ÊèèËø∞</p>
            <div id="event-options"></div>
        </div>
    </div>

    <div style="position: fixed; right: 2%; top: 20px;">
        <div onclick="gotoPage('https://moyugame965.github.io/GameList/')"
            style="margin: 10px 0; line-height:24px;width:50px; height: 24px;border: 1px solid #e6d5c3; background-color: #c7b299; color: #ffffff; text-align: center;border-radius: 5px;cursor: pointer;font-size: 15px;">
            Êõ¥Â§ö</div>
        <div onclick="gotoPage('https://moyugame965.github.io/Shopping/baodan.html')"
            style="margin: 10px 0;line-height:24px;width:50px;height: 24px;border: 1px solid #e6d5c3; background-color: #c7b299; color: #ffffff; text-align: center;border-radius: 5px;cursor: pointer;font-size: 15px;">
            ÂïÜÂ∫ó</div>
        <div onclick="gotoPage('https://moyugame965.github.io/Coupon/')"
            style="margin: 10px 0;line-height:24px;width:50px;height: 24px;border: 1px solid #e6d5c3; background-color: #c7b299; color: #ffffff; text-align: center;border-radius: 5px;cursor: pointer;font-size: 15px;">
            Â§ñÂçñ</div>
    </div>

    <script>
        // Ê∏∏ÊàèÁä∂ÊÄÅ
        const gameState = {
            stats: {
                name: "Ê∏ÖËôöÂ≠ê",
                level: "ÂàùÂÖ•ÈÅìÈó®",
                cultivation: 0,
                spirit: 10,
                energy: 100,
                enlightenment: 1,
                luck: 1,
                taoism: 1,
                maxSpirit: 100,
                maxEnergy: 100
            },
            currentActivity: null,
            afk: false,
            timeElapsed: 0,
            eventChance: 0.1,
            events: [
                {
                    title: "È´ò‰∫∫ÊåáÁÇπ",
                    desc: "‰∏Ä‰ΩçÁôΩÂèëÈÅìÈïøË∑ØËøáÔºå‰∏∫‰Ω†ÊåáÁÇπËø∑Ê¥•„ÄÇ",
                    options: [
                        { text: "ÊÅ≠Êï¨ËØ∑Êïô", effect: () => { addStat('enlightenment', 1); addStat('cultivation', 10); } },
                        { text: "Â©âË®ÄË∞¢Áªù", effect: () => { addStat('luck', 1); } }
                    ]
                },
                {
                    title: "ÁÅµËçØÂá∫‰∏ñ",
                    desc: "‰Ω†ÂèëÁé∞‰∏ÄÊ†™ÂçÉÂπ¥ÁÅµËäùÂú®Â±±Ê¥û‰∏≠ÁîüÈïø„ÄÇ",
                    options: [
                        { text: "ÈááÊëòÊúçÁî®", effect: () => { addStat('energy', 50); addStat('spirit', 20); } },
                        { text: "ÁïôÂÆÉÁîüÈïø", effect: () => { addStat('luck', 2); } }
                    ]
                },
                {
                    title: "Â§©ÈôçÂºÇË±°",
                    desc: "Â§©Á©∫‰∏≠Âá∫Áé∞Á¥´Ê∞î‰∏úÊù•ÁöÑÁ••Áëû‰πãÂÖÜ„ÄÇ",
                    options: [
                        { text: "ÈùôÂøÉÂèÇÊÇü", effect: () => { addStat('cultivation', 20); addStat('enlightenment', 1); } },
                        { text: "ÈªòÈªòËÆ∞‰∏ã", effect: () => { addStat('taoism', 1); } }
                    ]
                },
                {
                    title: "Âè§Á±çÂØÜËóè",
                    desc: "‰Ω†Âú®Â±±Ê¥û‰∏≠ÂèëÁé∞‰∫Ü‰∏ÄÈÉ®Â§±‰º†Â∑≤‰πÖÁöÑÈÅìÂÆ∂ÁßòÁ±ç„ÄÇ",
                    options: [
                        { text: "ÁªÜÂøÉÁ†îËØª", effect: () => { addStat('taoism', 2); addStat('enlightenment', 1); } },
                        { text: "Â∏¶ÂõûÈÅìËßÇ", effect: () => { addStat('luck', 1); addStat('cultivation', 15); } }
                    ]
                },
                {
                    title: "Á•ûÁßòËÆøÂÆ¢",
                    desc: "‰∏Ä‰ΩçËá™Áß∞Ê∏∏ÊñπÈÅì‰∫∫ÁöÑËÆøÂÆ¢Âêë‰Ω†ËØ∑ÊïôÈÅìÊ≥ï„ÄÇ",
                    options: [
                        { text: "ÂÄæÂõäÁõ∏Êéà", effect: () => { addStat('luck', 2); } },
                        { text: "Ë∞®ÊÖé‰∫§ÊµÅ", effect: () => { addStat('taoism', 1); addStat('spirit', 10); } }
                    ]
                },
                {
                    title: "Â±±ÊûóËø∑ÈÄî",
                    desc: "Âú®Ê∑±Â±±‰∏≠ÈááËçØÔºå‰Ω†‰∏çÊÖéËø∑Â§±‰∫ÜÊñπÂêë„ÄÇ",
                    options: [
                        { text: "ÂÜ∑ÈùôÂàÜÊûê", effect: () => { addStat('enlightenment', 1); gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 2; addLog("ÊâæÂà∞Âá∫Ë∑ØÁöÑÂêåÊó∂Ôºå‰Ω†ËøòÂèëÁé∞‰∫ÜÁèçË¥µËçØÊùêÔºÅ"); } },
                        { text: "ÈÅìÊ≥ïËøΩË∏™", effect: () => { addStat('taoism', 1); addStat('energy', -10); } }
                    ]
                },
                {
                    title: "Âá°Â∞òÂéÜÁªÉ",
                    desc: "‰∏Ä‰ΩçÊùëÊ∞ëËØ∑Ê±Ç‰Ω†Â∏ÆÂä©Ê≤ªÁñó‰ªñÁîüÁóÖÁöÑÂ≠©Â≠ê„ÄÇ",
                    options: [
                        {
                            text: "ÊñΩÂ±ïÈÅìÊ≥ï", effect: () => {
                                if (gameState.stats.taoism >= 5) {
                                    addStat('cultivation', 30);
                                    addLog("‰Ω†ÊàêÂäüÊ≤ªÊÑà‰∫ÜÂ≠©Â≠êÔºåÊùëÊ∞ëÊÑüÊøÄ‰∏çÂ∞ΩÔºÅ", "achievement");
                                } else {
                                    addStat('spirit', -30);
                                    addLog("‰Ω†ÁöÑÈÅìÊ≥ï‰∏çË∂≥ÔºåÊ∂àËÄó‰∫ÜÂ§ßÈáèÁ≤æÁ•ûÂäõ...", "error");
                                }
                            }
                        },
                        {
                            text: "Ëµ†ÈÄÅ‰∏πËçØ", effect: () => {
                                if (gameState.inventory.potions && gameState.inventory.potions > 0) {
                                    gameState.inventory.potions--;
                                    addStat('luck', 3);
                                    updateInventory();
                                    addLog("‰Ω†ÁöÑ‰∏πËçØÊ≤ªÂ•Ω‰∫ÜÂ≠©Â≠êÔºåÁßØÁ¥Ø‰∫ÜÁ¶èÁºòÔºÅ", "achievement");
                                } else {
                                    addStat('luck', -1);
                                    addLog("‰Ω†Ê≤°Êúâ‰∏πËçØÂèØ‰ª•Áªô‰∫àÔºåÂè™ËÉΩÈÅóÊÜæÁ¶ªÂºÄ...", "error");
                                }
                            }
                        }
                    ]
                },
                {
                    title: "Èõ∑Âä´ËÄÉÈ™å",
                    desc: "‰øÆ‰∏∫ÊèêÂçáÂºïÊù•Â§©Èõ∑ÔºåËøôÊòØ‰∏ÄÊ¨°Á™ÅÁ†¥ÁöÑÊú∫‰ºö„ÄÇ",
                    options: [
                        {
                            text: "ËøéÊé•Èõ∑Âä´", effect: () => {
                                const success = Math.random() < (gameState.stats.spirit / gameState.stats.maxSpirit);
                                if (success) {
                                    addStat('cultivation', 50);
                                    addStat('maxSpirit', 10);
                                    addStat('maxEnergy', 10);
                                    addLog("‰Ω†ÊàêÂäüÊ∏°ËøáÈõ∑Âä´Ôºå‰øÆ‰∏∫Â§ßËøõÔºÅ", "achievement");
                                } else {
                                    addStat('energy', -50);
                                    addStat('spirit', -50);
                                    addLog("Èõ∑Âä´Â®ÅÂäõÂ§™Âº∫Ôºå‰Ω†Âèó‰∫ÜÈáç‰º§...", "error");
                                }
                            }
                        },
                        { text: "ÈÅøÂºÄÈîãËäí", effect: () => { addStat('energy', -20); } }
                    ]
                },
                {
                    title: "‰ªô‰∫∫ËµêÂÆù",
                    desc: "‰∏Ä‰ΩçÈöê‰∏ñ‰ªô‰∫∫Ë¢´‰Ω†ÁöÑ‰øÆË°åÊâÄÊÑüÂä®ÔºåÊÉ≥Ë¶ÅËµê‰∫à‰Ω†ÂÆùÁâ©„ÄÇ",
                    options: [
                        { text: "ËØ∑ÊïôÈÅìÊ≥ï", effect: () => { addStat('taoism', 3); addStat('enlightenment', 2); } },
                        {
                            text: "ËØ∑Ê±ÇÊ≥ïÂÆù", effect: () => {
                                gameState.inventory.talismans = (gameState.inventory.talismans || 0) + 3;
                                updateInventory();
                                addLog("Ëé∑Âæó‰∫Ü‰∏âÂº†Âº∫Â§ßÁöÑÁÅµÁ¨¶ÔºÅ", "achievement");
                            }
                        }
                    ]
                },
                {
                    title: "ÂøÉÈ≠îËÄÉÈ™å",
                    desc: "‰øÆË°åÂà∞‰∏ÄÂÆöÈò∂ÊÆµÔºåÂÜÖÂøÉÁöÑÂøÉÈ≠îÂºÄÂßãÊòæÁé∞„ÄÇ",
                    options: [
                        {
                            text: "Ê≠£Èù¢ÂØπÊäó", effect: () => {
                                if (gameState.stats.enlightenment >= 5) {
                                    addStat('enlightenment', 3);
                                    addStat('cultivation', 30);
                                    addLog("‰Ω†ÊàòËÉú‰∫ÜÂøÉÈ≠îÔºåÊÇüÊÄßÂ§ßÂ¢ûÔºÅ", "achievement");
                                } else {
                                    addStat('spirit', -40);
                                    addLog("ÂøÉÈ≠îÂ§™Âº∫Ôºå‰Ω†Á≤æÁ•ûÂèóÂàõ...", "error");
                                }
                            }
                        },
                        { text: "È°∫ÂÖ∂Ëá™ÁÑ∂", effect: () => { addStat('spirit', -10); addStat('luck', 1); } }
                    ]
                },
                // Êñ∞Â¢û‰∫ã‰ª∂ÂºÄÂßã
                {
                    title: "‰∫ëÊ∏∏ÈÅì‰∫∫",
                    desc: "‰∏Ä‰Ωç‰∫ëÊ∏∏ÈÅì‰∫∫Êù•ËÆøÔºåË°®Á§∫ÂèØ‰ª•‰º†Êéà‰Ω†ÁßòÊ≥ïÊàñËµ†ÈÄÅ‰Ω†ËçØÊùê„ÄÇ",
                    options: [
                        {
                            text: "Â≠¶‰π†ÁßòÊ≥ï", effect: () => {
                                addStat('taoism', 2);
                                addStat('cultivation', 15);
                                addLog("‰Ω†Â≠¶‰ºö‰∫Ü‰∏ÄÁßçÂÖ®Êñ∞ÁöÑ‰øÆÁÇºÁßòÊ≥ïÔºÅ", "achievement");
                            }
                        },
                        {
                            text: "Êé•ÂèóËçØÊùê", effect: () => {
                                gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 5;
                                updateInventory();
                                addLog("Ëé∑Âæó‰∫Ü5‰ªΩÁèçË¥µËçØÊùêÔºÅ");
                            }
                        }
                    ]
                },
                {
                    title: "Âè§Ê¥ûÂ•áÈÅá",
                    desc: "‰Ω†Âú®Â±±‰∏≠ÂèëÁé∞‰∏Ä‰∏™ÂèëÂÖâÁöÑÂè§Ê¥ûÔºåÈáåÈù¢‰º†Êù•Â•áÂºÇÁöÑËÉΩÈáèÊ≥¢Âä®„ÄÇ",
                    options: [
                        {
                            text: "Ê∑±ÂÖ•Êé¢Á¥¢", effect: () => {
                                if (Math.random() < 0.7) {
                                    addStat('cultivation', 30);
                                    addStat('spirit', 30);
                                    addLog("‰Ω†Âú®Âè§Ê¥û‰∏≠ÊÑüÂèóÂà∞ÊµìÈÉÅÁöÑÁÅµÊ∞îÔºå‰øÆ‰∏∫Â§ßËøõÔºÅ", "achievement");
                                } else {
                                    addStat('energy', -30);
                                    addLog("Âè§Ê¥û‰∏≠ÁöÑÈòµÊ≥ïÊîªÂáª‰∫Ü‰Ω†ÔºåÊçüÂ§±‰∫Ü‰∏çÂ∞ë‰ΩìÂäõ...", "error");
                                }
                            }
                        },
                        {
                            text: "Ë∞®ÊÖéËßÇÂØü", effect: () => {
                                addStat('enlightenment', 1);
                                gameState.inventory.stones = (gameState.inventory.stones || 0) + 2;
                                updateInventory();
                                addLog("‰Ω†‰ªéÊ¥ûÂè£Êî∂ÈõÜÂà∞‰∫ÜÂá†ÂùóÈó™ÁÉÅÁöÑÁÅµÁü≥„ÄÇ");
                            }
                        }
                    ]
                },
                {
                    title: "È£ûÂâë‰º†‰π¶",
                    desc: "‰∏ÄÊääÂæÆÂûãÈ£ûÂâëÂ∏¶ÁùÄ‰π¶‰ø°È£ûÂà∞‰Ω†Èù¢ÂâçÔºåÊòØËøúÊñπÁöÑÈÅìÂèãÈÇÄËØ∑‰Ω†ÂÖ±Âêå‰øÆÁÇº„ÄÇ",
                    options: [
                        {
                            text: "Ê¨£ÁÑ∂ÂâçÂæÄ", effect: () => {
                                if (gameState.stats.level === "ÂàùÂÖ•ÈÅìÈó®") {
                                    addStat('cultivation', 10);
                                    addLog("‰∏éÈÅìÂèãÂàáÁ£ãÔºåËé∑ÁõäËâØÂ§ö„ÄÇ");
                                } else {
                                    addStat('taoism', 2);
                                    addStat('enlightenment', 1);
                                    addLog("‰Ω†‰ª¨‰∫§Êç¢‰∫Ü‰øÆÁÇºÂøÉÂæóÔºå‰∫íÁõ∏ÂêØÂèë„ÄÇ", "achievement");
                                }
                            }
                        },
                        {
                            text: "Â©âÊãíÈÇÄËØ∑", effect: () => {
                                addStat('spirit', 15);
                                addLog("‰Ω†‰∏ìÊ≥®‰∫éËá™Â∑±ÁöÑ‰øÆË°åÔºåÁ≤æÁ•ûÊõ¥Âä†ÈõÜ‰∏≠„ÄÇ");
                            }
                        }
                    ]
                },
                {
                    title: "ÁÅµÂÖΩÁé∞Ë∫´",
                    desc: "‰∏ÄÂè™ÊµëË∫´Êï£ÂèëÁÅµÂÖâÁöÑÁôΩÈπøÂú®‰Ω†‰øÆÁÇºÊó∂Áé∞Ë∫´ÔºåÈùôÈùôÂú∞Ê≥®ËßÜÁùÄ‰Ω†„ÄÇ",
                    options: [
                        {
                            text: "Â∞ùËØïÊ≤üÈÄö", effect: () => {
                                if (gameState.stats.spirit >= 50) {
                                    addStat('enlightenment', 2);
                                    addStat('luck', 2);
                                    addLog("‰Ω†‰∏éÁÅµÂÖΩÂª∫Á´ã‰∫ÜÂøÉÁÅµÊÑüÂ∫îÔºåËé∑Âæó‰∫ÜÂÆÉÁöÑÁ•ùÁ¶èÔºÅ", "achievement");
                                } else {
                                    addLog("‰Ω†ÁöÑÁ≤æÁ•ûÂäõ‰∏çË∂≥ÔºåÊó†Ê≥ï‰∏éÁÅµÂÖΩÊ≤üÈÄö„ÄÇ");
                                }
                            }
                        },
                        {
                            text: "ÂÆâÈùôËßÇÂØü", effect: () => {
                                addStat('spirit', 10);
                                addLog("ÁÅµÂÖΩÁ¶ªÂéª‰∫ÜÔºå‰ΩÜÂÆÉÁöÑÂá∫Áé∞ËÆ©‰Ω†ÊÑüÂà∞Âπ≥Èùô„ÄÇ");
                            }
                        }
                    ]
                },
                {
                    title: "ÁÅµÈõ®Èôç‰∏¥",
                    desc: "Â§©Á©∫Á™ÅÁÑ∂‰∏ãËµ∑‰∫ÜÁÅµÊ∞îÂÖÖÁõàÁöÑÈõ®ÔºåËøôÊòØÈöæÂæóÁöÑ‰øÆÁÇºËâØÊú∫„ÄÇ",
                    options: [
                        {
                            text: "Èõ®‰∏≠ÊâìÂùê", effect: () => {
                                addStat('cultivation', 25);
                                addStat('spirit', 25);
                                addLog("ÁÅµÈõ®Ê¥óÊ∂§Ë∫´ÂøÉÔºå‰Ω†ÁöÑ‰øÆ‰∏∫Â§ßÂπÖÊèêÂçáÔºÅ", "achievement");
                            }
                        },
                        {
                            text: "Êî∂ÈõÜÈõ®Ê∞¥", effect: () => {
                                gameState.inventory.potions = (gameState.inventory.potions || 0) + 1;
                                updateInventory();
                                addLog("‰Ω†Êî∂ÈõÜ‰∫ÜÁÅµÈõ®ÁÇºÂà∂Êàê‰∏πËçØÔºåËé∑Âæó‰∫Ü1È¢ó‰∏πËçØÔºÅ");
                            }
                        }
                    ]
                },
                {
                    title: "Â±±Á•ûËØïÁÇº",
                    desc: "ÂΩìÂú∞Â±±Á•ûÊòæÁÅµÔºåÊÉ≥Ë¶ÅËÄÉÈ™å‰Ω†ÁöÑÈÅìÂøÉÂíåÂÆûÂäõ„ÄÇ",
                    options: [
                        {
                            text: "Êé•ÂèóËØïÁÇº", effect: () => {
                                const successRate = (gameState.stats.taoism * 0.1) + (gameState.stats.cultivation / 100) + (gameState.stats.luck * 0.05);
                                if (Math.random() < successRate) {
                                    addStat('taoism', 3);
                                    addStat('cultivation', 40);
                                    addLog("‰Ω†ÈÄöËøá‰∫ÜÂ±±Á•ûÁöÑËØïÁÇºÔºåËé∑Âæó‰∫ÜÂ±±Á•ûËµêÁ¶èÔºÅ", "achievement");
                                } else {
                                    addStat('energy', -40);
                                    addLog("ËØïÁÇºÂ§±Ë¥•Ôºå‰Ω†Ê∂àËÄó‰∫ÜÂ§ßÈáè‰ΩìÂäõ...", "error");
                                }
                            }
                        },
                        {
                            text: "Ë∞¶ËôöËá¥Ê≠â", effect: () => {
                                addStat('luck', 1);
                                addLog("Â±±Á•ûÊ¨£Ëµè‰Ω†ÁöÑË∞¶ÈÄäÊÄÅÂ∫¶ÔºåÁ¶ªÂºÄÂâçÁªô‰∫Ü‰Ω†‰∏Ä‰∏ùÁ¶èÁºò„ÄÇ");
                            }
                        }
                    ]
                },
                {
                    title: "ÊµÅÊòüÂù†ËêΩ",
                    desc: "‰∏ÄÈ¢óÊµÅÊòüÂù†ËêΩÂú®ÈôÑËøëÁöÑÂ±±Ë∞∑‰∏≠ÔºåÊï£ÂèëÁùÄÂ•áÂºÇÁöÑËÉΩÈáè„ÄÇ",
                    options: [
                        {
                            text: "ÂØªÊâæÈô®Áü≥", effect: () => {
                                if (Math.random() < 0.6) {
                                    gameState.inventory.stones = (gameState.inventory.stones || 0) + 5;
                                    updateInventory();
                                    addLog("‰Ω†ÊâæÂà∞‰∫ÜÂá†ÂùóËï¥Âê´Âº∫Â§ßËÉΩÈáèÁöÑÈô®Áü≥ÔºÅ", "achievement");
                                } else {
                                    addStat('energy', -20);
                                    addLog("‰Ω†ÊêúÂØª‰∫ÜÂæà‰πÖ‰ΩÜ‰∏ÄÊó†ÊâÄËé∑ÔºåÂæíÂä≥Ê∂àËÄó‰∫Ü‰ΩìÂäõ„ÄÇ", "error");
                                }
                            }
                        },
                        {
                            text: "ËøúÁ®ãÊÑüÂ∫î", effect: () => {
                                addStat('spirit', 15);
                                addStat('enlightenment', 0.5);
                                addLog("‰Ω†ÊÑüÂ∫îÂà∞ÊµÅÊòüÁöÑËÉΩÈáèÔºåÊèêÂçá‰∫ÜÁ≤æÁ•ûÂäõ„ÄÇ");
                            }
                        }
                    ]
                },
                {
                    title: "ÁôæËçâ‰∫âÈ∏£",
                    desc: "‰Ω†ÁªèËøáÁöÑËçâÂú∞‰∏äÔºåÊâÄÊúâÊ§çÁâ©Á™ÅÁÑ∂Êï£ÂèëÁÅµÂÖâÔºåÂºÄÂßãÁîüÈïøÔºåËøôÊòØÈöæÂæóÁöÑÂ§©Âú∞ÂºÇË±°„ÄÇ",
                    options: [
                        {
                            text: "Ê±≤ÂèñÁÅµÊ∞î", effect: () => {
                                addStat('cultivation', 20);
                                addStat('spirit', 20);
                                addLog("‰Ω†Âê∏Êî∂‰∫ÜÂ§ßÈáèÊ§çÁâ©Á≤æÂçéÔºå‰øÆ‰∏∫Â§ßÂ¢ûÔºÅ");
                            }
                        },
                        {
                            text: "ÈááÈõÜ‰ªôËçâ", effect: () => {
                                gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 3;
                                addStat('luck', 1);
                                updateInventory();
                                addLog("‰Ω†ÈááÈõÜÂà∞‰∫ÜÂá†Ê†™ÁèçË¥µÁöÑ‰ªôËçâÔºÅ");
                            }
                        }
                    ]
                },
                {
                    title: "ÂπªÂ¢ÉËØïÁÇº",
                    desc: "‰Ω†‰∏çÁü•‰∏çËßâËµ∞ÂÖ•‰∫Ü‰∏Ä‰∏™ÂπªÂ¢ÉÔºåËøô‰ºº‰πéÊòØ‰∏ÄÂú∫ÈíàÂØπÂøÉÊÄßÁöÑËÄÉÈ™å„ÄÇ",
                    options: [
                        {
                            text: "ÂèÇÊÇüÂπªË±°", effect: () => {
                                if (gameState.stats.enlightenment >= 4) {
                                    addStat('enlightenment', 2);
                                    addStat('cultivation', 30);
                                    addLog("‰Ω†ÁúãÁ†¥ÂπªË±°ÔºåËé∑Âæó‰∫ÜÊ∑±ÂàªÁöÑÈ¢ÜÊÇüÔºÅ", "achievement");
                                } else {
                                    addStat('spirit', -20);
                                    addLog("ÂπªÂ¢ÉÂ§™ËøáÂ§çÊùÇÔºåËÄóË¥π‰∫Ü‰Ω†‰∏çÂ∞ëÁ≤æÁ•ûÂäõ...", "error");
                                }
                            }
                        },
                        {
                            text: "ÊâìÁ†¥ÂπªÂ¢É", effect: () => {
                                addStat('taoism', 1);
                                addStat('energy', -10);
                                addLog("‰Ω†Áî®ÈÅìÊ≥ïÁ†¥Èô§‰∫ÜÂπªÂ¢ÉÔºåËé∑Âæó‰∫Ü‰∏Ä‰∫õÊÑüÊÇü„ÄÇ");
                            }
                        }
                    ]
                }
                // Êñ∞Â¢û‰∫ã‰ª∂ÁªìÊùü
            ],
            challenges: [
                { name: "ÂàùÂÖ•ÈÅìÈó®", desc: "Á¥ØÁßØ‰øÆÁÇº100ÁÇπ‰øÆ‰∏∫", target: 100, stat: "cultivation", completed: false },
                { name: "Â∞èÊúâÊâÄÊàê", desc: "ÊÇüÊÄßËææÂà∞5ÁÇπ", target: 5, stat: "enlightenment", completed: false },
                { name: "ÂæóÈÅìÈ´ò‰∫∫", desc: "ÈÅìÊ≥ïËææÂà∞10ÁÇπ", target: 10, stat: "taoism", completed: false },
                { name: "‰ΩìÈ≠ÑÂº∫ÂÅ•", desc: "‰ΩìÂäõ‰∏äÈôêËææÂà∞150ÁÇπ", target: 150, stat: "maxEnergy", completed: false },
                { name: "Á≤æÁ•ûÈ•±Êª°", desc: "Á≤æÁ•ûÂäõ‰∏äÈôêËææÂà∞150ÁÇπ", target: 150, stat: "maxSpirit", completed: false },
                { name: "ÂπøÁßØÁ¶èÁºò", desc: "Á¶èÁºòËææÂà∞10ÁÇπ", target: 10, stat: "luck", completed: false },
                { name: "ÈÅìË°åÁ≤æÊ∑±", desc: "ËææÂà∞Á≠ëÂü∫ÊúüÂ¢ÉÁïå", target: "Á≠ëÂü∫Êúü", stat: "level", completed: false },
                { name: "‰∏πËçØÂ§ßÂ∏à", desc: "ÁÇºÂà∂10È¢ó‰∏πËçØ", target: 10, stat: "potions", customCheck: true, completed: false },
                { name: "Á¨¶ÁÆìÂÆóÂ∏à", desc: "Âà∂‰Ωú20Âº†ÁÅµÁ¨¶", target: 20, stat: "talismans", customCheck: true, completed: false }
            ],
            activities: {
                meditation: {
                    name: "ÁõòÂùêÂÜ•ÊÉ≥",
                    effects: {
                        cultivation: 1,
                        spirit: 2,
                        energy: -1
                    }
                },
                reading: {
                    name: "Á†îËØªÈÅìÁªè",
                    effects: {
                        enlightenment: 0.1,
                        taoism: 0.1,
                        energy: -2,
                        spirit: -1
                    }
                },
                breathing: {
                    name: "ÂêêÁ∫≥Ê≥ï",
                    effects: {
                        energy: 5,
                        spirit: 3
                    }
                },
                tea: {
                    name: "ÂìÅËåóÊÇüÈÅì",
                    effects: {
                        enlightenment: 0.05,
                        luck: 0.05,
                        spirit: 1
                    }
                },
                talisman: {
                    name: "ÁÇºÂà∂Á¨¶ÁÆì",
                    effects: {
                        taoism: 0.2,
                        cultivation: 0.5,
                        energy: -3,
                        spirit: -2
                    }
                },
                herbs: {
                    name: "ÈááÈõÜËçØËçâ",
                    effects: {
                        energy: -2,
                        luck: 0.1
                    }
                },
                teaching: {
                    name: "ÊéàÂæíËÆ≤ÈÅì",
                    effects: {
                        taoism: 0.3,
                        cultivation: 0.5,
                        energy: -2,
                        spirit: -3
                    }
                },
                alchemy: {
                    name: "ÁÇº‰∏π‰øÆÁÇº",
                    effects: {
                        cultivation: 2,
                        enlightenment: 0.2,
                        energy: -4,
                        spirit: -3
                    }
                },
                swordsmanship: {
                    name: "ÂâëÊúØ‰øÆÁÇº",
                    effects: {
                        cultivation: 1.5,
                        energy: -5
                    },
                    special: "maxEnergy" // ÁâπÊÆäÊïàÊûúÔºöÂ¢ûÂä†‰ΩìÂäõ‰∏äÈôê
                },
                waterfall: {
                    name: "ÁÄëÂ∏ÉÂÜ•ÊÉ≥",
                    effects: {
                        spirit: 5,
                        cultivation: 2,
                        energy: -3
                    },
                    special: "maxSpirit" // ÁâπÊÆäÊïàÊûúÔºöÂ¢ûÂä†Á≤æÁ•ûÂäõ‰∏äÈôê
                }
            },
            levels: [
                { name: "ÂàùÂÖ•ÈÅìÈó®", req: 0 },
                { name: "‰øÆË°åÂ∞èÊàê", req: 100 },
                { name: "Á≠ëÂü∫Êúü", req: 500 },
                { name: "ÂáùÁ•ûÊúü", req: 1000 },
                { name: "Èáë‰∏πÊúü", req: 3000 },
                { name: "ÂÖÉÂ©¥Êúü", req: 10000 },
                { name: "ÂåñÁ•ûÊúü", req: 30000 },
                { name: "Ê∏°Âä´Êúü", req: 100000 },
                { name: "ÂæóÈÅìÊàê‰ªô", req: 500000 }
            ]
        };

        // DOMÂÖÉÁ¥†
        const elements = {
            stats: {
                name: document.getElementById('name'),
                level: document.getElementById('level'),
                cultivation: document.getElementById('cultivation'),
                spirit: document.getElementById('spirit'),
                energy: document.getElementById('energy'),
                enlightenment: document.getElementById('enlightenment'),
                luck: document.getElementById('luck'),
                taoism: document.getElementById('taoism')
            },
            currentActivity: document.getElementById('current-activity'),
            timePassed: document.getElementById('time-passed'),
            toggleAfk: document.getElementById('toggle-afk'),
            logContainer: document.getElementById('log-container'),
            activities: document.querySelectorAll('.activity'),
            randomEvent: document.getElementById('random-event'),
            eventOverlay: document.getElementById('event-overlay'),
            eventTitle: document.getElementById('event-title'),
            eventDesc: document.getElementById('event-desc'),
            eventOptions: document.getElementById('event-options'),
            challenges: {
                1: document.getElementById('challenge-1'),
                2: document.getElementById('challenge-2'),
                3: document.getElementById('challenge-3'),
                4: document.getElementById('challenge-4'),
                5: document.getElementById('challenge-5'),
                6: document.getElementById('challenge-6'),
                7: document.getElementById('challenge-7'),
                8: document.getElementById('challenge-8'),
                9: document.getElementById('challenge-9')
            }
        };

        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            // ÂàùÂßãÂåñÂ∫ìÂ≠ò
            gameState.inventory = gameState.inventory || {
                herbs: 0,
                talismans: 0,
                potions: 0,
                stones: 0
            };

            // ÂàùÂßãÂåñÊ∏∏ÊàèËÆæÁΩÆ
            gameState.settings = gameState.settings || {
                soundEnabled: false,
                autoSave: true,
                autoSaveInterval: 1 // ÈªòËÆ§1ÂàÜÈíüËá™Âä®‰øùÂ≠ò‰∏ÄÊ¨°
                // Â∑≤ÁßªÈô§ÂΩìÂâçÂ≠òÊ°£ÊßΩ‰ΩçËÆæÁΩÆ
            };

            // Â∫îÁî®ËÆæÁΩÆ
            document.getElementById('sound-toggle').checked = gameState.settings.soundEnabled || false;
            document.getElementById('auto-save-toggle').checked = gameState.settings.autoSave !== false;
            gameState.soundEnabled = gameState.settings.soundEnabled || false;

            // ËÆæÁΩÆËá™Âä®‰øùÂ≠òÈ¢ëÁéáÈÄâÊã©Âô®
            const intervalSelect = document.getElementById('auto-save-interval');
            intervalSelect.value = gameState.settings.autoSaveInterval || 1;

            // ÁªëÂÆöËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂
            document.getElementById('toggle-settings').addEventListener('click', function () {
                const panel = document.getElementById('settings-panel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });

            // ÁªëÂÆöËÆæÁΩÆÈÄâÈ°π‰∫ã‰ª∂
            document.getElementById('sound-toggle').addEventListener('change', function () {
                gameState.soundEnabled = this.checked;
                gameState.settings.soundEnabled = this.checked;
                saveSettings();
            });

            document.getElementById('auto-save-toggle').addEventListener('change', function () {
                gameState.settings.autoSave = this.checked;
                saveSettings();

                // ÂèçÈ¶àÂà∞ÁïåÈù¢
                if (this.checked) {
                    addLog("Â∑≤ÂºÄÂêØËá™Âä®‰øùÂ≠òÂäüËÉΩ", "system");
                } else {
                    addLog("Â∑≤ÂÖ≥Èó≠Ëá™Âä®‰øùÂ≠òÂäüËÉΩ", "system");
                }
            });

            document.getElementById('auto-save-interval').addEventListener('change', function () {
                gameState.settings.autoSaveInterval = parseInt(this.value);
                saveSettings();
                addLog(`Ëá™Âä®‰øùÂ≠òÈ¢ëÁéáÂ∑≤ËÆæÁΩÆ‰∏∫${this.value}ÂàÜÈíü‰∏ÄÊ¨°`, "system");
            });

            document.getElementById('clear-cache').addEventListener('click', function () {
                if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊµèËßàÂô®ÁºìÂ≠òÂêóÔºüËøô‰∏ç‰ºöÂà†Èô§‰Ω†ÁöÑÂ≠òÊ°£Ôºå‰ΩÜ‰ºöÊ∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂„ÄÇ')) {
                    // Â∞ùËØïÊ∏ÖÁêÜ‰∏Ä‰∫õÁºìÂ≠ò
                    try {
                        localStorage.removeItem('daoshiCache');
                        if (window.caches) {
                            caches.keys().then(names => {
                                names.forEach(name => {
                                    if (name.includes('daoshi')) {
                                        caches.delete(name);
                                    }
                                });
                            });
                        }
                        alert('ÁºìÂ≠òÂ∑≤Ê∏ÖÁêÜÔºÅ');
                    } catch (e) {
                        console.error('Ê∏ÖÁêÜÁºìÂ≠òÂ§±Ë¥•', e);
                        alert('Ê∏ÖÁêÜÁºìÂ≠òÂ§±Ë¥•: ' + e.message);
                    }
                }
            });

            document.getElementById('export-save').addEventListener('click', function () {
                // ÂØºÂá∫Â≠òÊ°£‰∏∫JSONÊñá‰ª∂
                try {
                    const saveData = localStorage.getItem('daoshiGame');
                    if (!saveData) {
                        alert('Ê≤°ÊúâÂèØÁî®ÁöÑÂ≠òÊ°£Êï∞ÊçÆÔºÅ');
                        return;
                    }

                    const blob = new Blob([saveData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `daoshi_save_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();

                    setTimeout(() => {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    }, 0);
                } catch (e) {
                    console.error('ÂØºÂá∫Â≠òÊ°£Â§±Ë¥•', e);
                    alert('ÂØºÂá∫Â≠òÊ°£Â§±Ë¥•: ' + e.message);
                }
            });

            // ÂØºÂÖ•Â≠òÊ°£
            document.getElementById('import-save').addEventListener('click', function () {
                document.getElementById('save-file-input').click();
            });

            document.getElementById('save-file-input').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const saveData = e.target.result;
                        // È™åËØÅJSONÊ†ºÂºè
                        JSON.parse(saveData);

                        if (confirm('Á°ÆÂÆöË¶ÅÂØºÂÖ•Ê≠§Â≠òÊ°£ÂêóÔºüËøôÂ∞ÜË¶ÜÁõñ‰Ω†ÂΩìÂâçÁöÑÊ∏∏ÊàèËøõÂ∫¶„ÄÇ')) {
                            localStorage.setItem('daoshiGame', saveData);
                            alert('Â≠òÊ°£ÂØºÂÖ•ÊàêÂäüÔºÅÊ∏∏ÊàèÂ∞ÜÂà∑Êñ∞‰ª•Âä†ËΩΩÊñ∞Â≠òÊ°£„ÄÇ');
                            location.reload();
                        }
                    } catch (e) {
                        console.error('ÂØºÂÖ•Â≠òÊ°£Â§±Ë¥•', e);
                        alert('ÂØºÂÖ•Â≠òÊ°£Â§±Ë¥•: Êñá‰ª∂Ê†ºÂºèÊó†Êïà');
                    }
                };
                reader.readAsText(file);
            });

            // ÁßªÈô§Â≠òÊ°£ÊßΩ‰ΩçÁõ∏ÂÖ≥‰ª£Á†Å

            // ÂàùÂßãÂåñUI
            updateAllUI();

            // ÂàùÂßãÂåñÊ†áÁ≠æÁ≥ªÁªü
            initTabs();

            // ÂàùÂßãÂåñÊó∂Èó¥ÂíåÂ≠£ËäÇ
            updateTimeDisplay();

            // ÁªëÂÆöÊ¥ªÂä®ÈÄâÊã©
            document.querySelectorAll('.activity').forEach(activity => {
                activity.addEventListener('click', () => {
                    const activityId = activity.getAttribute('data-activity');
                    selectActivity(activityId);
                });
            });

            // ÁªëÂÆöÊåÇÊú∫ÊåâÈíÆ
            elements.toggleAfk.addEventListener('click', toggleAfk);

            // ÁªëÂÆöÈáçÁΩÆÊ∏∏ÊàèÊåâÈíÆ
            document.getElementById('reset-game').addEventListener('click', resetGame);

            // ÈîÅÂÆöÈúÄË¶ÅËß£ÈîÅÁöÑÊ¥ªÂä®
            checkActivityUnlocks();

            // Âä†ËΩΩÊ∏∏Êàè
            loadGame();

            // Èò≤Ê≠¢iOS Safari‰∏äÁöÑËß¶Êë∏‰∫ã‰ª∂ÈóÆÈ¢ò
            document.body.addEventListener('touchstart', function () { }, { passive: true });

            // Ê∑ªÂä†Ê¨¢ËøéÊó•Âøó
            addLog(`Ê¨¢ËøéÔºå${gameState.stats.name}ÈÅìÈïøÔºÅÂºÄÂßã‰Ω†ÁöÑ‰øÆÈÅì‰πãÊóÖ...`);

            // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠ËÆæÁΩÆÈù¢Êùø
            document.addEventListener('click', function (e) {
                const settingsPanel = document.getElementById('settings-panel');
                const toggleButton = document.getElementById('toggle-settings');

                if (settingsPanel.style.display === 'block' &&
                    !settingsPanel.contains(e.target) &&
                    e.target !== toggleButton) {
                    settingsPanel.style.display = 'none';
                }
            });
        }

        // ‰øùÂ≠òÁî®Êà∑ËÆæÁΩÆ
        function saveSettings() {
            try {
                localStorage.setItem('daoshiSettings', JSON.stringify(gameState.settings));
            } catch (error) {
                console.error("‰øùÂ≠òËÆæÁΩÆÊó∂Âá∫Èîô:", error);
            }
        }

        // ÈÄâÊã©Ê¥ªÂä®
        function selectActivity(activityId) {
            // Ê£ÄÊü•Ê¥ªÂä®ÊòØÂê¶ÈîÅÂÆö
            const activityElement = document.querySelector(`.activity[data-activity="${activityId}"]`);
            if (activityElement && activityElement.classList.contains('locked')) {
                addLog(`‰Ω†Â∞öÊú™Êª°Ë∂≥‰øÆÁÇº${gameState.activities[activityId].name}ÁöÑÊù°‰ª∂`, 'error');
                return false;
            }

            // Â¶ÇÊûú‰πãÂâçÊúâÊ¥ªÂä®ÔºåÂÖàÊ∏ÖÈô§ÂÆÉÁöÑactiveÁä∂ÊÄÅ
            if (gameState.currentActivity) {
                const oldActivity = document.querySelector(`.activity[data-activity="${gameState.currentActivity}"]`);
                if (oldActivity) oldActivity.classList.remove('active');
            }

            gameState.currentActivity = activityId;

            // ËÆæÁΩÆÊñ∞Ê¥ªÂä®ÁöÑactiveÁä∂ÊÄÅ
            if (activityElement) {
                activityElement.classList.add('active');
            }

            elements.currentActivity.textContent = gameState.activities[activityId].name;
            addLog(`ÂºÄÂßã${gameState.activities[activityId].name}`);

            // ÈÄâÊã©Ê¥ªÂä®Âêé‰øùÂ≠òÊ∏∏ÊàèÁä∂ÊÄÅ
            saveGame();

            return true;
        }

        // ÂàáÊç¢ÊåÇÊú∫Áä∂ÊÄÅ
        function toggleAfk() {
            if (!gameState.currentActivity) {
                addLog("ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™‰øÆÁÇºÊ¥ªÂä®", "error");
                return;
            }

            gameState.afk = !gameState.afk;

            if (gameState.afk) {
                elements.toggleAfk.textContent = "ÂÅúÊ≠¢ÊåÇÊú∫‰øÆÁÇº";
                addLog("ÂºÄÂßãÊåÇÊú∫‰øÆÁÇº");
                document.getElementById('afk-status').classList.add('afk-active');
                // Êõ¥Êñ∞ÊåÇÊú∫Áä∂ÊÄÅÊñáÊú¨
                const statusValue = document.querySelector('#afk-status .status-value');
                if (statusValue) {
                    statusValue.textContent = "‰øÆÁÇº‰∏≠...";
                }
                startAfkLoop();
            } else {
                elements.toggleAfk.textContent = "ÂºÄÂßãÊåÇÊú∫‰øÆÁÇº";
                addLog("ÂÅúÊ≠¢ÊåÇÊú∫‰øÆÁÇº");
                document.getElementById('afk-status').classList.remove('afk-active');
                // Êõ¥Êñ∞ÊåÇÊú∫Áä∂ÊÄÅÊñáÊú¨
                const statusValue = document.querySelector('#afk-status .status-value');
                if (statusValue) {
                    statusValue.textContent = "Êú™ÂºÄÂßã";
                }
                stopAfkLoop();
            }
        }

        // ÊåÇÊú∫Âæ™ÁéØ
        let afkInterval;
        function startAfkLoop() {
            // Èò≤Ê≠¢Â§ö‰∏™ËÆ°Êó∂Âô®ÂêåÊó∂ËøêË°å
            if (afkInterval) {
                clearInterval(afkInterval);
            }

            afkInterval = setInterval(() => {
                // Êó∂Èó¥ÊµÅÈÄù
                gameState.timeElapsed++;

                // Êõ¥Êñ∞UI‰∏≠ÁöÑÊó∂Èó¥ÊòæÁ§∫
                if (elements.timePassed) {
                    elements.timePassed.textContent = gameState.timeElapsed;
                }

                // Êó∂Èó¥Á≥ªÁªü
                updateGameTime();

                // Â∫îÁî®Ê¥ªÂä®ÊïàÊûú
                if (gameState.currentActivity && gameState.activities[gameState.currentActivity]) {
                    const activity = gameState.activities[gameState.currentActivity];

                    // Â≠£ËäÇÊïàÊûú‰øÆÈ•∞
                    const seasonMultiplier = getSeasonMultiplier(gameState.currentActivity);

                    for (const [stat, value] of Object.entries(activity.effects)) {
                        // Â∫îÁî®Â≠£ËäÇ‰øÆÈ•∞ÊïàÊûú
                        let modifiedValue = value * seasonMultiplier;

                        // Â¶ÇÊûúÊòØÂ§úÊôöÔºåÁ≤æÁ•ûÂäõÊÅ¢Â§çËé∑ÂæóÂä†Êàê
                        if (!gameState.dayTime && stat === 'spirit' && modifiedValue > 0) {
                            modifiedValue *= 1.5;
                        }

                        addStat(stat, modifiedValue);
                    }

                    // Â§ÑÁêÜÁâπÊÆäÊïàÊûú
                    if (activity.special) {
                        // ÊØè10ÂàÜÈíüÂ∫îÁî®‰∏ÄÊ¨°ÁâπÊÆäÊïàÊûú
                        if (gameState.timeElapsed % 10 === 0) {
                            if (activity.special === "maxEnergy") {
                                // Â¢ûÂä†ÊúÄÂ§ß‰ΩìÂäõ
                                gameState.stats.maxEnergy += 0.5;
                                if (gameState.timeElapsed % 30 === 0) {
                                    addLog("ÂâëÊúØ‰øÆÁÇºÂ¢ûÂº∫‰∫Ü‰Ω†ÁöÑ‰ΩìÈ≠ÑÔºå‰ΩìÂäõ‰∏äÈôêÊèêÂçá‰∫ÜÔºÅ");
                                }
                            } else if (activity.special === "maxSpirit") {
                                // Â¢ûÂä†ÊúÄÂ§ßÁ≤æÁ•ûÂäõ
                                gameState.stats.maxSpirit += 0.5;
                                if (gameState.timeElapsed % 30 === 0) {
                                    addLog("ÁÄëÂ∏ÉÂÜ•ÊÉ≥ÂáÄÂåñ‰∫Ü‰Ω†ÁöÑÂøÉÁÅµÔºåÁ≤æÁ•ûÂäõ‰∏äÈôêÊèêÂçá‰∫ÜÔºÅ");
                                }
                            }
                        }
                    }

                    // ÈöèÊú∫Áâ©ÂìÅËé∑Âèñ
                    processActivityRewards(gameState.currentActivity);
                }

                // ÈöèÊú∫‰∫ã‰ª∂
                if (Math.random() < calculateEventChance()) {
                    triggerRandomEvent();
                }

                // Êõ¥Êñ∞UI
                updateAllUI();

                // Ëá™Âä®‰øùÂ≠òÊ∏∏Êàè
                if (gameState.settings && gameState.settings.autoSave !== false) {
                    // ‰ΩøÁî®ËÆæÁΩÆ‰∏≠ÁöÑ‰øùÂ≠òÈó¥ÈöîÔºàÂàÜÈíüÔºâ
                    const saveInterval = gameState.settings.autoSaveInterval || 1;

                    if (gameState.timeElapsed % (saveInterval * 60) === 0) {
                        saveGame();

                        // ÊòæÁ§∫Ëá™Âä®‰øùÂ≠òÊèêÁ§∫
                        const saveNotification = document.createElement('div');
                        saveNotification.className = 'save-notification';
                        saveNotification.textContent = 'Ê∏∏ÊàèÂ∑≤Ëá™Âä®‰øùÂ≠ò';
                        document.body.appendChild(saveNotification);

                        // Ê∑ªÂä†Êó•Âøó
                        addLog("Ê∏∏ÊàèÂ∑≤Ëá™Âä®‰øùÂ≠ò", "system");

                        // 2ÁßíÂêéÁßªÈô§ÊèêÁ§∫
                        setTimeout(() => {
                            if (saveNotification.parentNode) {
                                saveNotification.parentNode.removeChild(saveNotification);
                            }
                        }, 2000);
                    }
                }

                // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ÁªßÁª≠
                if (gameState.stats.energy <= 0 || gameState.stats.spirit <= 0) {
                    addLog("‰Ω†Â§™Áñ≤ÊÉ´‰∫ÜÔºåÊó†Ê≥ïÁªßÁª≠‰øÆÁÇº", "error");
                    gameState.afk = false;
                    elements.toggleAfk.textContent = "ÂºÄÂßãÊåÇÊú∫‰øÆÁÇº";
                    document.getElementById('afk-status').classList.remove('afk-active');
                    // Êõ¥Êñ∞ÊåÇÊú∫Áä∂ÊÄÅÊñáÊú¨
                    const statusValue = document.querySelector('#afk-status .status-value');
                    if (statusValue) {
                        statusValue.textContent = "Êú™ÂºÄÂßã";
                    }
                    clearInterval(afkInterval);
                }
            }, 1000);
        }

        // Êõ¥Êñ∞Ê∏∏ÊàèÊó∂Èó¥Á≥ªÁªü
        function updateGameTime() {
            gameState.time += 0.25; // ÊØèÊ¨°Â¢ûÂä†15ÂàÜÈíü

            // Êó•ÊúüÂèòÊõ¥
            if (gameState.time >= 24) {
                gameState.time = 0;
                gameState.daysPassed++;
                addLog(`ËøõÂÖ•Á¨¨${gameState.daysPassed}Â§©`);

                // ÊØè10Â§©ÊèêÂçáÂ±ûÊÄß‰∏äÈôê
                if (gameState.daysPassed % 10 === 0) {
                    gameState.stats.maxEnergy += 5;
                    gameState.stats.maxSpirit += 5;
                    addLog(`ÈöèÁùÄÈïøÊúü‰øÆÁÇºÔºå‰Ω†ÁöÑ‰ΩìÂäõ‰∏äÈôêÂíåÁ≤æÁ•ûÂäõ‰∏äÈôêÊèêÂçá‰∫ÜÔºÅ`, 'achievement');
                }
            }

            // Êó•Â§úÂèòÂåñ
            const oldDayTime = gameState.dayTime;
            gameState.dayTime = (gameState.time >= 6 && gameState.time < 18);

            if (oldDayTime !== gameState.dayTime) {
                if (gameState.dayTime) {
                    addLog('Â§©‰∫Æ‰∫ÜÔºå‰∏áÁâ©Â§çËãè');
                    document.body.classList.remove('night-mode');
                } else {
                    addLog('Â§úÂπïÈôç‰∏¥ÔºåÁæ§ÊòüÈó™ÁÉÅ');
                    document.body.classList.add('night-mode');
                }
            }

            // Â≠£ËäÇÂèòÂåñ
            if (gameState.daysPassed % 30 === 0 && gameState.time === 0) {
                const seasons = ['spring', 'summer', 'autumn', 'winter'];
                const currentIndex = seasons.indexOf(gameState.season);
                const newSeason = seasons[(currentIndex + 1) % 4];

                if (newSeason !== gameState.season) {
                    gameState.season = newSeason;

                    const seasonNames = {
                        spring: 'Êò•Â≠£',
                        summer: 'Â§èÂ≠£',
                        autumn: 'ÁßãÂ≠£',
                        winter: 'ÂÜ¨Â≠£'
                    };

                    addLog(`Â≠£ËäÇÂèòÂåñÔºåËøõÂÖ•${seasonNames[gameState.season]}`);

                    // Êõ¥Êñ∞UI
                    const seasonIndicator = document.getElementById('season-indicator');
                    if (seasonIndicator) {
                        seasonIndicator.textContent = seasonNames[gameState.season];
                        seasonIndicator.className = `season-indicator ${gameState.season}`;
                    }
                }
            }

            // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
            updateTimeDisplay();
        }

        // Êõ¥Êñ∞Êó∂Èó¥ÂíåÊó•Â§úÊòæÁ§∫
        function updateTimeDisplay() {
            // Êõ¥Êñ∞Êó∂Ëæ∞ÊòæÁ§∫
            const timeIndicator = document.getElementById('time-indicator');
            if (timeIndicator) {
                const chineseHours = ['Â≠êÊó∂', '‰∏ëÊó∂', 'ÂØÖÊó∂', 'ÂçØÊó∂', 'Ëæ∞Êó∂', 'Â∑≥Êó∂', 'ÂçàÊó∂', 'Êú™Êó∂', 'Áî≥Êó∂', 'ÈÖâÊó∂', 'ÊàåÊó∂', '‰∫•Êó∂'];
                const hourIndex = Math.floor(gameState.time / 2) % 12;
                timeIndicator.textContent = chineseHours[hourIndex];
            }

            // Êõ¥Êñ∞Â§©Êï∞ÊòæÁ§∫
            const daysPassed = document.getElementById('days-passed');
            if (daysPassed) {
                daysPassed.textContent = `Á¨¨${gameState.daysPassed}Â§©`;
            }

            // Êõ¥Êñ∞Êó•Â§úÂõæÊ†á
            const dayNightIndicator = document.getElementById('day-night-indicator');
            if (dayNightIndicator) {
                if (gameState.dayTime) {
                    dayNightIndicator.textContent = '‚òÄÔ∏è';
                    dayNightIndicator.className = 'day-night-indicator daytime';
                } else {
                    dayNightIndicator.textContent = 'üåô';
                    dayNightIndicator.className = 'day-night-indicator nighttime';
                }
            }
        }

        // Ëé∑ÂèñÂ≠£ËäÇ‰øÆÈ•∞ÊïàÊûú
        function getSeasonMultiplier(activityId) {
            const seasonEffects = {
                spring: {
                    meditation: 1.2,   // Êò•Â≠£ÂÜ•ÊÉ≥ÊïàÊûúÊõ¥‰Ω≥
                    herbs: 1.5,        // Êò•Â≠£ÈááËçØÊõ¥È´òÊïà
                    default: 1.1       // Êò•Â≠£ÂÖ∂‰ªñÊ¥ªÂä®ËΩªÂæÆÊèêÂçá
                },
                summer: {
                    qigong: 1.3,       // Â§èÂ≠£Ê∞îÂäü‰øÆÁÇºÊõ¥‰Ω≥
                    talisman: 1.2,     // Â§èÂ≠£Á¨¶ÁÆìÊïàÊûúÊõ¥Â•Ω
                    default: 1.0       // Â§èÂ≠£ÊôÆÈÄöÊïàÊûú
                },
                autumn: {
                    reading: 1.3,      // ÁßãÂ≠£ËØªÁªèÊõ¥È´òÊïà
                    tea: 1.2,          // ÁßãÂ≠£ÂìÅËå∂ÊïàÊûúÊõ¥Â•Ω
                    default: 1.1       // ÁßãÂ≠£ÂÖ∂‰ªñÊ¥ªÂä®ËΩªÂæÆÊèêÂçá
                },
                winter: {
                    meditation: 0.9,   // ÂÜ¨Â≠£ÂÜ•ÊÉ≥ÊïàÊûúËæÉÂº±
                    breathing: 1.3,    // ÂÜ¨Â≠£ÂêêÁ∫≥ÊïàÊûúÊõ¥‰Ω≥
                    default: 0.95      // ÂÜ¨Â≠£ËΩªÂæÆÈôç‰ΩéÊïàÁéá
                }
            };

            // ËøîÂõûÂØπÂ∫îÂ≠£ËäÇÁöÑ‰øÆÈ•∞ÊïàÊûúÔºåÂ¶ÇÊûúÊ≤°ÊúâÁâπÂÆöÊïàÊûúÂàôËøîÂõûÈªòËÆ§ÂÄº
            return seasonEffects[gameState.season][activityId] ||
                seasonEffects[gameState.season].default;
        }

        // Âü∫‰∫éÂêÑÁßçÂõ†Á¥†ËÆ°ÁÆó‰∫ã‰ª∂Ëß¶ÂèëÂá†Áéá
        function calculateEventChance() {
            let chance = gameState.eventChance;

            // Á¶èÁºòÂΩ±Âìç‰∫ã‰ª∂Ëß¶ÂèëÂá†Áéá
            chance += (gameState.stats.luck - 1) * 0.02;

            // Â§úÊôö‰∫ã‰ª∂Êõ¥Â§ö
            if (!gameState.dayTime) {
                chance *= 1.5;
            }

            // ‰∏çÂêåÂ≠£ËäÇÁöÑ‰∫ã‰ª∂Âá†Áéá
            const seasonMultipliers = {
                spring: 1.1,
                summer: 0.9,
                autumn: 1.2,
                winter: 1.3
            };

            chance *= seasonMultipliers[gameState.season] || 1;

            // Â¢ÉÁïåË∂äÈ´òÔºåÈÅáÂà∞Á®ÄÊúâ‰∫ã‰ª∂ÁöÑÂá†ÁéáË∂äÈ´ò
            const levelIndex = gameState.levels.findIndex(l => l.name === gameState.stats.level);
            chance *= (1 + levelIndex * 0.05);

            // ÈïøÊó∂Èó¥Ê≤°Êúâ‰∫ã‰ª∂‰ºöÊèêÈ´òËß¶ÂèëÂá†Áéá
            if (gameState.lastEventTime) {
                const minutesSinceLastEvent = (gameState.timeElapsed - gameState.lastEventTime);
                if (minutesSinceLastEvent > 30) {
                    // ÊØèË∂ÖËøá30ÂàÜÈíüÂ¢ûÂä†5%Ê¶ÇÁéá
                    chance *= (1 + ((minutesSinceLastEvent - 30) / 30) * 0.05);
                }
            }

            return Math.min(chance, 0.35); // ‰∏äÈôê35%
        }

        // Â§ÑÁêÜÊ¥ªÂä®ÈöèÊú∫Â•ñÂä±
        function processActivityRewards(activityId) {
            switch (activityId) {
                case 'herbs':
                    // ÈááËçØÊúâÂá†ÁéáËé∑ÂæóËçØÊùê
                    if (Math.random() < 0.3) {
                        gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 1;
                        addLog(`‰Ω†ÈááÈõÜÂà∞‰∫Ü‰∏Ä‰ªΩËçØÊùêÔºÅ`);
                    }
                    break;
                case 'talisman':
                    // Á¨¶ÁÆìÊúâÂá†ÁéáËé∑ÂæóÊàêÂìÅÁ¨¶
                    if (Math.random() < 0.2) {
                        gameState.inventory.talismans = (gameState.inventory.talismans || 0) + 1;
                        addLog(`‰Ω†ÊàêÂäüÁÇºÂà∂‰∫Ü‰∏ÄÂº†ÁÅµÁ¨¶ÔºÅ`);
                    }
                    break;
                case 'teaching':
                    // ÊéàÂæíÊúâÂá†ÁéáËé∑ÂæóÁÅµÁü≥
                    if (Math.random() < 0.4) {
                        gameState.inventory.stones = (gameState.inventory.stones || 0) + 1;
                        addLog(`‰Ω†Ëé∑Âæó‰∫Ü‰∏ÄÊûöÁÅµÁü≥ÔºÅ`);
                    }
                    break;
                case 'alchemy':
                    // ÁÇº‰∏πÊúâÂá†ÁéáËé∑Âæó‰∏πËçØ
                    if (Math.random() < 0.15) {
                        gameState.inventory.potions = (gameState.inventory.potions || 0) + 1;
                        addLog(`‰Ω†ÊàêÂäüÁÇºÂà∂‰∫Ü‰∏ÄÈ¢ó‰∏πËçØÔºÅ`, 'achievement');
                    }

                    // ÈúÄË¶ÅÊ∂àËÄóËçØÊùê
                    if (gameState.inventory.herbs && gameState.inventory.herbs > 0 && gameState.timeElapsed % 5 === 0) {
                        gameState.inventory.herbs -= 1;
                        addLog(`ÁÇº‰∏πÊ∂àËÄó‰∫Ü‰∏Ä‰ªΩËçØÊùê`);
                    }
                    break;
                case 'swordsmanship':
                    // ÂâëÊúØ‰øÆÁÇºÊúâÂá†ÁéáËß¶ÂèëÈ°øÊÇü
                    if (Math.random() < 0.1) {
                        addStat('cultivation', 10);
                        addLog(`ÂâëÊúØ‰øÆÁÇº‰∏≠‰Ω†Á™ÅÁÑ∂È°øÊÇüÔºå‰øÆ‰∏∫Â§ßÂ¢ûÔºÅ`);
                    }
                    break;
                case 'waterfall':
                    // ÁÄëÂ∏ÉÂÜ•ÊÉ≥ÊúâÂá†ÁéáÂõûÂ§çÂÖ®ÈÉ®Á≤æÁ•ûÂäõ
                    if (Math.random() < 0.05) {
                        gameState.stats.spirit = gameState.stats.maxSpirit;
                        addLog(`Âú®ÁÄëÂ∏É‰∏ãÊÇüÈÅìÔºå‰Ω†ÁöÑÁ≤æÁ•ûÂäõÂÆåÂÖ®ÊÅ¢Â§ç‰∫ÜÔºÅ`, 'achievement');
                    }
                    break;
            }

            // Êõ¥Êñ∞Áâ©ÂìÅÊ†è
            updateInventory();
        }

        // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
        function updateStats() {
            for (const [stat, element] of Object.entries(elements.stats)) {
                element.textContent = typeof gameState.stats[stat] === 'number' ?
                    Math.floor(gameState.stats[stat] * 10) / 10 :
                    gameState.stats[stat];
            }
        }

        // Ê∑ªÂä†Â±ûÊÄßÂÄº
        function addStat(stat, value) {
            // Â¶ÇÊûúÊòØË¥üÂÄºÔºåÊ£ÄÊü•ÊòØÂê¶‰ºöÂØºËá¥Â±ûÊÄß‰Ωé‰∫é0
            if (value < 0 && gameState.stats[stat] + value < 0) {
                // Â∞ÜÂ±ûÊÄßËÆæ‰∏∫0ËÄå‰∏çÊòØË¥üÂÄº
                gameState.stats[stat] = 0;
            } else {
                // Â∫îÁî®Â±ûÊÄßÂèòÂåñ
                gameState.stats[stat] += value;
            }

            // ÁâπÊÆäÂ§ÑÁêÜ‰∏Ä‰∫õÊúâ‰∏äÈôêÁöÑÂ±ûÊÄß
            if (stat === 'energy' && gameState.stats.energy > gameState.stats.maxEnergy) {
                gameState.stats.energy = gameState.stats.maxEnergy;
            }
            if (stat === 'spirit' && gameState.stats.spirit > gameState.stats.maxSpirit) {
                gameState.stats.spirit = gameState.stats.maxSpirit;
            }

            // Êõ¥Êñ∞Â¢ÉÁïåÁ≠âÁ∫ß
            checkLevelUp();
        }

        // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ÊèêÂçáÂ¢ÉÁïå
        function checkLevelUp() {
            // Ëé∑ÂèñÂΩìÂâçÂ¢ÉÁïåÂú®Á≠âÁ∫ßÊï∞ÁªÑ‰∏≠ÁöÑÁ¥¢Âºï
            const currentLevelIndex = gameState.levels.findIndex(level => level.name === gameState.stats.level);

            // Â¶ÇÊûúÊâæÂà∞‰∫ÜÂΩìÂâçÂ¢ÉÁïåÔºåÊ£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ÊôãÁ∫ß
            if (currentLevelIndex !== -1 && currentLevelIndex < gameState.levels.length - 1) {
                const nextLevel = gameState.levels[currentLevelIndex + 1];

                // Â¶ÇÊûú‰øÆ‰∏∫ËææÂà∞‰∫Ü‰∏ã‰∏Ä‰∏™Â¢ÉÁïåÁöÑË¶ÅÊ±Ç
                if (gameState.stats.cultivation >= nextLevel.req) {
                    gameState.stats.level = nextLevel.name;
                    addLog(`ÊÅ≠ÂñúÔºÅ‰Ω†ÁöÑÂ¢ÉÁïåÊèêÂçáÂà∞‰∫Ü„Äê${nextLevel.name}„Äë`, 'level-up');

                    // ÊèêÂçáÂ•ñÂä±
                    gameState.stats.maxEnergy += 10;
                    gameState.stats.maxSpirit += 10;
                    gameState.stats.energy = gameState.stats.maxEnergy;
                    gameState.stats.spirit = gameState.stats.maxSpirit;

                    // Âú®Â¢ÉÁïåÊèêÂçáÊó∂‰øùÂ≠òÊ∏∏ÊàèÁä∂ÊÄÅ
                    saveGame();

                    // Â¢ÉÁïåÊèêÂçáÂêéÈáçÊñ∞Ê£ÄÊü•Ê¥ªÂä®Ëß£ÈîÅ
                    checkActivityUnlocks();
                }
            }
        }

        // Êõ¥Êñ∞ÊåëÊàòËøõÂ∫¶
        function updateChallenges() {
            gameState.challenges.forEach((challenge, index) => {
                // Ëé∑ÂèñÂΩìÂâçÂÄº
                let value;
                let progress = 0;

                if (challenge.customCheck) {
                    // Ëá™ÂÆö‰πâÊ£ÄÊü•ÁöÑÊåëÊàòÔºå‰æãÂ¶ÇÁâ©ÂìÅÊåëÊàò
                    switch (challenge.stat) {
                        case 'potions':
                            value = gameState.inventory.potions || 0;
                            progress = Math.min(Math.floor((value / challenge.target) * 100), 100);
                            break;
                        case 'talismans':
                            value = gameState.inventory.talismans || 0;
                            progress = Math.min(Math.floor((value / challenge.target) * 100), 100);
                            break;
                        default:
                            value = 0;
                            progress = 0;
                    }

                    updateChallengeProgress(index + 1, progress, challenge.completed);
                } else if (challenge.stat === 'level') {
                    // ÁâπÊÆäÂ§ÑÁêÜÂ¢ÉÁïåÁ≠âÁ∫ß
                    value = gameState.levels.findIndex(l => l.name === gameState.stats.level);
                    const targetIndex = gameState.levels.findIndex(l => l.name === challenge.target);
                    progress = targetIndex > 0 ? Math.min(Math.floor((value / targetIndex) * 100), 100) : 0;

                    updateChallengeProgress(index + 1, progress, challenge.completed);
                } else {
                    // ÊôÆÈÄöÂ±ûÊÄß
                    value = gameState.stats[challenge.stat];
                    progress = Math.min(Math.floor((value / challenge.target) * 100), 100);

                    updateChallengeProgress(index + 1, progress, challenge.completed);
                }

                // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàê
                if (challenge.customCheck) {
                    // Ëá™ÂÆö‰πâÊåëÊàòÂÆåÊàêÊ£ÄÊü•
                    switch (challenge.stat) {
                        case 'potions':
                            if ((gameState.inventory.potions || 0) >= challenge.target && !challenge.completed) {
                                completeChallengeReward(challenge, index);
                            }
                            break;
                        case 'talismans':
                            if ((gameState.inventory.talismans || 0) >= challenge.target && !challenge.completed) {
                                completeChallengeReward(challenge, index);
                            }
                            break;
                    }
                } else if (challenge.stat === 'level') {
                    // Â¢ÉÁïåÁ≠âÁ∫ßÂØπÊØî
                    const currentLevel = gameState.levels.findIndex(l => l.name === gameState.stats.level);
                    const targetLevel = gameState.levels.findIndex(l => l.name === challenge.target);

                    if (currentLevel >= targetLevel && !challenge.completed) {
                        completeChallengeReward(challenge, index);
                    }
                } else if (value >= challenge.target && !challenge.completed) {
                    completeChallengeReward(challenge, index);
                }
            });
        }

        // Êõ¥Êñ∞ÊåëÊàòËøõÂ∫¶Êù°
        function updateChallengeProgress(index, progress, completed) {
            const progressBar = elements.challenges[index];
            if (progressBar) {
                progressBar.style.width = `${progress}%`;

                // Êõ¥Êñ∞ÊåëÊàòÂÖÉÁ¥†Áä∂ÊÄÅ
                const challengeElement = progressBar.closest('.challenge');
                if (challengeElement) {
                    if (completed) {
                        challengeElement.classList.add('completed');
                    } else {
                        challengeElement.classList.remove('completed');
                    }
                }
            }
        }

        // ÂÆåÊàêÊåëÊàòÊó∂Áªô‰∫àÂ•ñÂä±
        function completeChallengeReward(challenge, index) {
            challenge.completed = true;

            // Ê∑ªÂä†Â•ñÂä±
            addLog(`ÂÆåÊàêÊåëÊàòÔºö${challenge.name}`, 'achievement');

            // ‰∏çÂêåÊåëÊàòÁªô‰∫à‰∏çÂêåÂ•ñÂä±
            switch (index) {
                case 0: // ÂàùÂÖ•ÈÅìÈó®
                    addStat('cultivation', 50);
                    addStat('luck', 1);
                    break;
                case 1: // Â∞èÊúâÊâÄÊàê
                    addStat('taoism', 2);
                    addStat('spirit', 20);
                    break;
                case 2: // ÂæóÈÅìÈ´ò‰∫∫
                    addStat('cultivation', 100);
                    addStat('enlightenment', 2);
                    break;
                case 3: // ‰ΩìÈ≠ÑÂº∫ÂÅ•
                    addStat('energy', 50);
                    addStat('maxEnergy', 20);
                    break;
                case 4: // Á≤æÁ•ûÈ•±Êª°
                    addStat('spirit', 50);
                    addStat('maxSpirit', 20);
                    break;
                case 5: // ÂπøÁßØÁ¶èÁºò
                    addStat('luck', 3);
                    addStat('enlightenment', 2);
                    // È¢ùÂ§ñÂ•ñÂä±Áâ©ÂìÅ
                    gameState.inventory.stones = (gameState.inventory.stones || 0) + 5;
                    addLog("Ëé∑Âæó5ÊûöÁÅµÁü≥Â•ñÂä±ÔºÅ");
                    break;
                case 6: // ÈÅìË°åÁ≤æÊ∑±
                    // Â§ßÂπÖÊèêÂçáÂ±ûÊÄß‰∏äÈôê
                    addStat('maxEnergy', 30);
                    addStat('maxSpirit', 30);
                    addStat('energy', 100);
                    addStat('spirit', 100);
                    break;
                case 7: // ‰∏πËçØÂ§ßÂ∏à
                    // Ëé∑ÂæóÁÇº‰∏πÊúØÁâπÊÆäÊïàÊûú
                    addStat('enlightenment', 3);
                    // È¢ùÂ§ñÁªô10‰∏™ËçØÊùê
                    gameState.inventory.herbs = (gameState.inventory.herbs || 0) + 10;
                    addLog("Ëé∑Âæó10‰ªΩÁèçË¥µËçØÊùêÔºÅ");
                    break;
                case 8: // Á¨¶ÁÆìÂÆóÂ∏à
                    addStat('taoism', 5);
                    addStat('cultivation', 100);
                    break;
                default:
                    addStat('cultivation', 50);
            }

            // Êõ¥Êñ∞Áâ©ÂìÅÊ†è
            updateInventory();

            // ÊåëÊàòÂÆåÊàêÂêé‰øùÂ≠òÊ∏∏ÊàèÁä∂ÊÄÅ
            saveGame();

            // Ê£ÄÊü•ÊòØÂê¶Ëß£ÈîÅÊñ∞Ê¥ªÂä®
            checkActivityUnlocks();
        }

        // Ëß¶ÂèëÈöèÊú∫‰∫ã‰ª∂
        function triggerRandomEvent() {
            // Á°Æ‰øùÂÅúÊ≠¢ÊåÇÊú∫Âæ™ÁéØ
            stopAfkLoop();

            // ËÆ∞ÂΩïÊú¨Ê¨°‰∫ã‰ª∂Êó∂Èó¥
            gameState.lastEventTime = gameState.timeElapsed;

            // Ê†πÊçÆÁé©ÂÆ∂Áä∂ÊÄÅÈÄâÊã©ÂêàÈÄÇÁöÑ‰∫ã‰ª∂
            let availableEvents = [...gameState.events];

            // Á≠õÈÄâÈÄÇÂêàÂΩìÂâçÁé©ÂÆ∂Áä∂ÊÄÅÁöÑ‰∫ã‰ª∂
            // ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÁé©ÂÆ∂ÁöÑÈÅìÊ≥ïÂæà‰ΩéÔºåÊéíÈô§ÈúÄË¶ÅÈ´òÈÅìÊ≥ïÁöÑ‰∫ã‰ª∂ÈÄâÈ°π
            if (gameState.stats.taoism < 5) {
                availableEvents = availableEvents.filter(event => {
                    return !event.options.some(option =>
                        option.effect.toString().includes('taoism >= 5')
                    );
                });
            }

            // Âü∫‰∫éÂΩìÂâçÊ¥ªÂä®Á≠õÈÄâ‰∫ã‰ª∂ÔºàÊüê‰∫õÊ¥ªÂä®ÂèØËÉΩËß¶ÂèëÁâπÂÆö‰∫ã‰ª∂Ôºâ
            if (gameState.currentActivity === 'herbs') {
                // Âú®ÈááËçØÊó∂Â¢ûÂä†‰∏éËçØÊùêÁõ∏ÂÖ≥‰∫ã‰ª∂ÁöÑÊùÉÈáç
                const herbEvents = availableEvents.filter(e =>
                    e.title.includes('ËçØ') || e.desc.includes('ËçØÊùê') || e.desc.includes('ÁÅµËäù')
                );
                if (herbEvents.length > 0 && Math.random() < 0.7) {
                    availableEvents = herbEvents;
                }
            } else if (gameState.currentActivity === 'reading') {
                // Âú®ËØªÁªèÊó∂Â¢ûÂä†‰∏éÊÇüÈÅìÁõ∏ÂÖ≥‰∫ã‰ª∂ÁöÑÊùÉÈáç
                const readingEvents = availableEvents.filter(e =>
                    e.title.includes('ÊÇü') || e.desc.includes('ÁßòÁ±ç') || e.desc.includes('Âè§Á±ç')
                );
                if (readingEvents.length > 0 && Math.random() < 0.7) {
                    availableEvents = readingEvents;
                }
            }

            // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™‰∫ã‰ª∂
            const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];

            // Êí≠ÊîæÂ£∞Èü≥ÊèêÈÜíÔºàÂ¶ÇÊûúÂêØÁî®Ôºâ
            if (gameState.soundEnabled) {
                playSound('event');
            }

            // Êõ¥Êñ∞‰∫ã‰ª∂UI
            elements.eventTitle.textContent = event.title;
            elements.eventDesc.textContent = event.desc;

            // Ê∏ÖÁ©∫Âπ∂Ê∑ªÂä†ÈÄâÈ°π
            elements.eventOptions.innerHTML = '';
            event.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'btn';
                button.textContent = option.text;

                // Ê£ÄÊü•ÊòØÂê¶ÊúâÊù°‰ª∂ÈôêÂà∂
                let isDisabled = false;
                let disabledReason = '';

                // Ê£ÄÊü•ÈÄâÈ°πÊòØÂê¶ÊúâÂâçÊèêÊù°‰ª∂
                if (option.requires) {
                    for (const [stat, value] of Object.entries(option.requires)) {
                        if (gameState.stats[stat] < value) {
                            isDisabled = true;
                            disabledReason = `ÈúÄË¶Å${stat === 'taoism' ? 'ÈÅìÊ≥ï' :
                                stat === 'enlightenment' ? 'ÊÇüÊÄß' :
                                    stat === 'luck' ? 'Á¶èÁºò' : stat}Ëá≥Â∞ë${value}ÁÇπ`;
                            break;
                        }
                    }
                }

                if (isDisabled) {
                    button.disabled = true;
                    button.title = disabledReason;
                    button.style.opacity = "0.6";
                    // Ê∑ªÂä†Êù°‰ª∂ÊèêÁ§∫
                    const reasonText = document.createElement('small');
                    reasonText.textContent = `(${disabledReason})`;
                    reasonText.style.display = 'block';
                    reasonText.style.marginTop = '3px';
                    reasonText.style.color = '#888';
                    button.appendChild(reasonText);
                }

                button.addEventListener('click', () => {
                    // ÊâßË°åÈÄâÈ°πÊïàÊûú
                    option.effect();

                    // ÈöêËóè‰∫ã‰ª∂UI
                    elements.randomEvent.style.display = 'none';
                    elements.eventOverlay.style.display = 'none';

                    // Ê∑ªÂä†Âà∞Êó•Âøó
                    addLog(`‰∫ã‰ª∂Ôºö${event.title} - ÈÄâÊã©‰∫Ü"${option.text}"`, 'event');

                    // Êõ¥Êñ∞Áä∂ÊÄÅÂíåÊåëÊàò
                    updateStats();
                    updateChallenges();

                    // Â¶ÇÊûú‰πãÂâçÂú®ÊåÇÊú∫ÔºåÂàôÁªßÁª≠ÊåÇÊú∫
                    if (gameState.afk) {
                        startAfkLoop();
                    }
                });
                elements.eventOptions.appendChild(button);
            });

            // ÊòæÁ§∫‰∫ã‰ª∂UI
            elements.randomEvent.style.display = 'block';
            elements.eventOverlay.style.display = 'block';
        }

        // Êí≠ÊîæÈü≥Êïà
        function playSound(type) {
            try {
                const sounds = {
                    event: new Audio('data:audio/mp3;base64,SUQzAwAAAAACJ1RZRV...'), // ÁÆÄÁü≠Èü≥ÊïàÁöÑbase64ÁºñÁ†Å
                    levelUp: new Audio('data:audio/mp3;base64,SUQzAwAAAAACJ1RZRV...')
                };

                if (sounds[type]) {
                    sounds[type].volume = 0.5; // ËÆæÁΩÆÈü≥Èáè
                    sounds[type].play().catch(err => console.log('Êó†Ê≥ïÊí≠ÊîæÈü≥Êïà:', err));
                }
            } catch (error) {
                console.log('Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•:', error);
            }
        }

        // Ê∑ªÂä†Êó•Âøó
        function addLog(text, type = "normal") {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `${text} <span class="time">${gameState.timeElapsed}ÂàÜÈíü</span>`;

            const logContainer = document.getElementById('log-container');
            if (logContainer) {
                logContainer.prepend(logEntry);

                // ÈôêÂà∂Êó•ÂøóÊù°ÁõÆÊï∞Èáè
                if (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }

            // ÂØπÈáçË¶ÅÊó•ÂøóÊ∑ªÂä†Âä®ÁîªÊïàÊûú
            if (type === 'achievement' || type === 'level-up') {
                logEntry.style.animation = 'none'; // ÈáçÁΩÆÂä®Áîª
                setTimeout(() => {
                    logEntry.style.animation = 'pulse 2s ease-in-out';
                }, 10);
            }
        }

        // Á°Æ‰øùÂÅúÊ≠¢ÊåÇÊú∫Âæ™ÁéØÊó∂Ê∏ÖÁêÜÂπ≤ÂáÄ
        function stopAfkLoop() {
            if (afkInterval) {
                clearInterval(afkInterval);
                afkInterval = null;
            }
        }

        // ÂàùÂßãÂåñÊ†áÁ≠æÁ≥ªÁªü
        function initTabs() {
            // Ëé∑ÂèñÊâÄÊúâÊ†áÁ≠æÂíåÂÜÖÂÆπÂå∫Âüü
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            // ‰∏∫ÊØè‰∏™Ê†áÁ≠æÊ∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ÁßªÈô§ÊâÄÊúâÊ¥ªË∑ÉÁä∂ÊÄÅ
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // ËÆæÁΩÆÂΩìÂâçÊ†áÁ≠æ‰∏∫Ê¥ªË∑É
                    tab.classList.add('active');

                    // Ëé∑ÂèñÊ†áÁ≠æÂØπÂ∫îÁöÑÂÜÖÂÆπID
                    const tabId = tab.getAttribute('data-tab');
                    const tabContent = document.getElementById(`${tabId}-tab`);

                    // ÊòæÁ§∫ÂØπÂ∫îÁöÑÂÜÖÂÆπ
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                });
            });
        }

        // Êõ¥Êñ∞ÊâÄÊúâUI
        function updateAllUI() {
            updateStats();
            updateChallenges();
            updateInventory();
            updateActivityStatus();
            checkActivityUnlocks();
        }

        // Êõ¥Êñ∞Ê¥ªÂä®Áä∂ÊÄÅ
        function updateActivityStatus() {
            // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®ÁöÑactiveÁä∂ÊÄÅ
            document.querySelectorAll('.activity').forEach(activity => {
                if (activity.getAttribute('data-activity') !== gameState.currentActivity) {
                    activity.classList.remove('active');
                } else {
                    activity.classList.add('active');
                }
            });

            // Êõ¥Êñ∞ÂΩìÂâçÊ¥ªÂä®ÊòæÁ§∫
            if (gameState.currentActivity && elements.currentActivity) {
                elements.currentActivity.textContent =
                    gameState.activities[gameState.currentActivity].name;
            } else if (elements.currentActivity) {
                elements.currentActivity.textContent = 'Èó≤Êï£';
            }
        }

        // Êõ¥Êñ∞Áâ©ÂìÅÊ†èÊòæÁ§∫
        function updateInventory() {
            // Êõ¥Êñ∞ËçØÊùêÊï∞Èáè
            const herbsElement = document.getElementById('herbs-count');
            if (herbsElement && gameState.inventory && typeof gameState.inventory.herbs !== 'undefined') {
                herbsElement.textContent = gameState.inventory.herbs;
            }

            // Êõ¥Êñ∞Á¨¶ÁÆìÊï∞Èáè
            const talismansElement = document.getElementById('talismans-count');
            if (talismansElement && gameState.inventory && typeof gameState.inventory.talismans !== 'undefined') {
                talismansElement.textContent = gameState.inventory.talismans;
            }

            // Êõ¥Êñ∞‰∏πËçØÊï∞Èáè
            const potionsElement = document.getElementById('potions-count');
            if (potionsElement && gameState.inventory && typeof gameState.inventory.potions !== 'undefined') {
                potionsElement.textContent = gameState.inventory.potions;
            }

            // Êõ¥Êñ∞ÁÅµÁü≥Êï∞Èáè
            const stonesElement = document.getElementById('stones-count');
            if (stonesElement && gameState.inventory && typeof gameState.inventory.stones !== 'undefined') {
                stonesElement.textContent = gameState.inventory.stones;
            }
        }

        // Ê£ÄÊü•Âπ∂Ëß£ÈîÅÊ¥ªÂä®
        function checkActivityUnlocks() {
            document.querySelectorAll('.activity[data-requirement]').forEach(activity => {
                const requirements = activity.getAttribute('data-requirement').split(',');
                let allMet = true;
                let missingReqs = [];

                for (let req of requirements) {
                    const [stat, value] = req.split(':');

                    if (stat === 'level') {
                        const currentLevelIndex = gameState.levels.findIndex(l => l.name === gameState.stats.level);
                        const requiredLevelIndex = gameState.levels.findIndex(l => l.name === value);

                        if (currentLevelIndex < requiredLevelIndex) {
                            allMet = false;
                            missingReqs.push(`ÈúÄË¶ÅÂ¢ÉÁïåÔºö${value}`);
                            break;
                        }
                    } else {
                        if (gameState.stats[stat] < parseFloat(value)) {
                            allMet = false;
                            const statNames = {
                                'cultivation': '‰øÆ‰∏∫',
                                'spirit': 'Á≤æÁ•ûÂäõ',
                                'energy': '‰ΩìÂäõ',
                                'enlightenment': 'ÊÇüÊÄß',
                                'luck': 'Á¶èÁºò',
                                'taoism': 'ÈÅìÊ≥ï',
                                'maxSpirit': 'Á≤æÁ•ûÂäõ‰∏äÈôê',
                                'maxEnergy': '‰ΩìÂäõ‰∏äÈôê'
                            };

                            missingReqs.push(`${statNames[stat] || stat}Ôºö${value}`);
                            break;
                        }
                    }
                }

                if (allMet) {
                    if (activity.classList.contains('locked')) {
                        activity.classList.remove('locked');
                        const activityId = activity.getAttribute('data-activity');
                        addLog(`Ëß£ÈîÅ‰∫ÜÊñ∞ÁöÑ‰øÆÁÇºÊñπÂºèÔºö${gameState.activities[activityId].name}`, 'achievement');

                        // ÁßªÈô§ÊèêÁ§∫ÂÖÉÁ¥†
                        const tooltipEl = activity.querySelector('.unlock-tooltip');
                        if (tooltipEl) {
                            tooltipEl.remove();
                        }
                    }
                } else {
                    activity.classList.add('locked');

                    // Ê∑ªÂä†ÊàñÊõ¥Êñ∞Êú™Êª°Ë∂≥Êù°‰ª∂ÁöÑÊèêÁ§∫
                    let tooltipEl = activity.querySelector('.unlock-tooltip');
                    if (!tooltipEl) {
                        tooltipEl = document.createElement('div');
                        tooltipEl.className = 'unlock-tooltip';
                        activity.appendChild(tooltipEl);
                    }

                    tooltipEl.innerHTML = `<strong>Êú™Êª°Ë∂≥Êù°‰ª∂:</strong><br>` +
                        missingReqs.map(req => `- ${req}`).join('<br>');
                }
            });
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊ∏∏Êàè
        function loadGame() {
            try {
                // ÂÖàÂä†ËΩΩËÆæÁΩÆ
                const savedSettings = localStorage.getItem('daoshiSettings');
                if (savedSettings) {
                    gameState.settings = JSON.parse(savedSettings);
                }

                // Â∞ùËØïÂä†ËΩΩ‰∏ªÂ≠òÊ°£
                const savedGame = localStorage.getItem('daoshiGame');

                // Â¶ÇÊûú‰∏ªÂ≠òÊ°£‰∏çÂèØÁî®ÔºåÂ∞ùËØïÂä†ËΩΩÂ§á‰ªΩ
                if (!savedGame) {
                    const backupGame = localStorage.getItem('daoshiGame_backup');
                    if (backupGame) {
                        addLog("‰∏ªÂ≠òÊ°£‰∏¢Â§±ÔºåÊ≠£Âú®‰ªéÂ§á‰ªΩÊÅ¢Â§ç...", "system");
                        loadGameData(backupGame);
                        // ÊÅ¢Â§çÂêéÁ´ãÂç≥‰øùÂ≠òÂà∞‰∏ªÂ≠òÊ°£
                        saveGame();
                        return;
                    }
                } else {
                    // ‰∏ªÂ≠òÊ°£ÂèØÁî®ÔºåÊ≠£Â∏∏Âä†ËΩΩ
                    loadGameData(savedGame);
                    return;
                }

                // Â¶ÇÊûúÊ≤°ÊúâÂ≠òÊ°£ÔºåÂàùÂßãÂåñÊñ∞Ê∏∏Êàè
                initNewGame();

            } catch (error) {
                console.error("Âä†ËΩΩÊ∏∏ÊàèÊó∂Âá∫Èîô:", error);
                addLog("Âä†ËΩΩÊ∏∏ÊàèÊï∞ÊçÆÂ§±Ë¥•", "error");

                // Âá∫ÈîôÊó∂Â∞ùËØï‰ªéÂ§á‰ªΩÊÅ¢Â§ç
                try {
                    const backupGame = localStorage.getItem('daoshiGame_backup');
                    if (backupGame) {
                        addLog("Â∞ùËØï‰ªéÂ§á‰ªΩÊÅ¢Â§ç...", "system");
                        loadGameData(backupGame);
                        return;
                    }
                } catch (backupError) {
                    console.error("Â§á‰ªΩÊÅ¢Â§çÂ§±Ë¥•:", backupError);
                }

                // Â¶ÇÊûú‰∏ÄÂàáÂ§±Ë¥•ÔºåÂàùÂßãÂåñÊñ∞Ê∏∏Êàè
                initNewGame();
            }

            // Âä†ËΩΩÂêéÊõ¥Êñ∞UI
            updateAllUI();
        }

        // ÂàùÂßãÂåñÊñ∞Ê∏∏Êàè
        function initNewGame() {
            // ÂàùÂßãÂ≠£ËäÇÂíåÊó∂Èó¥
            gameState.season = 'spring';
            gameState.time = 8; // ÂàùÂßãÊó∂Èó¥‰∏∫Êó©‰∏ä8ÁÇπ
            gameState.dayTime = true;
            gameState.daysPassed = 1;
            gameState.lastBackup = Date.now();

            // Ê£ÄÊü•Ê¥ªÂä®Ëß£ÈîÅÁä∂ÊÄÅ
            checkActivityUnlocks();

            addLog("ÂºÄÂßãÊñ∞ÁöÑ‰øÆÈÅì‰πãÊóÖ");
        }

        // Âä†ËΩΩÊ∏∏ÊàèÊï∞ÊçÆ
        function loadGameData(savedGameString) {
            const savedState = JSON.parse(savedGameString);

            // Ê£ÄÊü•ÁâàÊú¨ÂÖºÂÆπÊÄß (Êú™Êù•ÂèØÊâ©Â±ï)
            // if (savedState.version < requiredVersion) { ÊâßË°åÊï∞ÊçÆËøÅÁßªÈÄªËæë }

            // ÂêàÂπ∂‰øùÂ≠òÁöÑÁä∂ÊÄÅÂà∞ÂΩìÂâçÊ∏∏ÊàèÁä∂ÊÄÅ
            if (savedState.stats) {
                Object.keys(savedState.stats).forEach(key => {
                    gameState.stats[key] = savedState.stats[key];
                });
            }

            if (savedState.inventory) {
                gameState.inventory = savedState.inventory;
            }

            if (savedState.timeElapsed) {
                gameState.timeElapsed = savedState.timeElapsed;
            }

            if (savedState.daysPassed) {
                gameState.daysPassed = savedState.daysPassed;
            }

            if (savedState.season) {
                gameState.season = savedState.season;
            }

            if (savedState.time) {
                gameState.time = savedState.time;
            }

            if (savedState.dayTime !== undefined) {
                gameState.dayTime = savedState.dayTime;
            }

            if (savedState.challenges) {
                gameState.challenges = savedState.challenges;
            }

            if (savedState.timestamp) {
                gameState.lastLoadTime = savedState.timestamp;
            }

            // ËÆ∞ÂΩï‰∏äÊ¨°Â§á‰ªΩÊó∂Èó¥
            if (savedState.timestamp) {
                gameState.lastBackup = savedState.timestamp;
            }

            // Êõ¥Êñ∞ÊåÇÊú∫Áä∂ÊÄÅ
            if (savedState.currentActivity) {
                selectActivity(savedState.currentActivity);
            }

            // Ê£ÄÊü•Ê¥ªÂä®Ëß£ÈîÅÁä∂ÊÄÅ
            checkActivityUnlocks();

            addLog("Ê∏∏ÊàèÊï∞ÊçÆÂ∑≤Âä†ËΩΩ", "achievement");
        }

        // ‰øùÂ≠òÊ∏∏ÊàèÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveGame() {
            try {
                // ÂàõÂª∫Ë¶Å‰øùÂ≠òÁöÑÊ∏∏ÊàèÊï∞ÊçÆÂØπË±°
                const gameData = {
                    version: "1.0", // Ê∏∏ÊàèÁâàÊú¨ÔºåÊñπ‰æøÊú™Êù•Â§ÑÁêÜÊï∞ÊçÆÂÖºÂÆπÊÄß
                    timestamp: Date.now(), // ‰øùÂ≠òÊó∂Èó¥Êà≥
                    stats: gameState.stats,
                    inventory: gameState.inventory,
                    timeElapsed: gameState.timeElapsed,
                    currentActivity: gameState.currentActivity,
                    daysPassed: gameState.daysPassed,
                    season: gameState.season,
                    time: gameState.time,
                    dayTime: gameState.dayTime,
                    challenges: gameState.challenges
                };

                // ‰øùÂ≠ò‰∏ªÂ≠òÊ°£
                localStorage.setItem('daoshiGame', JSON.stringify(gameData));

                // ÂàõÂª∫Ëá™Âä®Â§á‰ªΩ (ÊØèÂ∞èÊó∂‰∏ÄÊ¨°)
                if (!gameState.lastBackup || (Date.now() - gameState.lastBackup > 3600000)) {
                    localStorage.setItem('daoshiGame_backup', JSON.stringify(gameData));
                    gameState.lastBackup = Date.now();
                    console.log("ÂàõÂª∫‰∫ÜÊ∏∏ÊàèÊï∞ÊçÆÂ§á‰ªΩ");
                }
            } catch (error) {
                console.error("‰øùÂ≠òÊ∏∏ÊàèÊó∂Âá∫Èîô:", error);
                addLog("‰øùÂ≠òÊ∏∏ÊàèÊï∞ÊçÆÂ§±Ë¥•", "error");
            }
        }

        // ÈáçÁΩÆÊ∏∏Êàè
        function resetGame() {
            if (confirm("Á°ÆÂÆöË¶ÅÈáçÁΩÆÊ∏∏ÊàèÂêóÔºüÊâÄÊúâËøõÂ∫¶Â∞Ü‰ºö‰∏¢Â§±ÔºÅ")) {
                // Ê∏ÖÈô§Ê∏∏ÊàèÊï∞ÊçÆ
                localStorage.removeItem('daoshiGame');

                // ‰øùÁïôÁî®Êà∑ËÆæÁΩÆ
                const savedSettings = gameState.settings;

                // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
                gameState.stats = {
                    name: "Ê∏ÖËôöÂ≠ê",
                    level: "ÂàùÂÖ•ÈÅìÈó®",
                    cultivation: 0,
                    spirit: 10,
                    energy: 100,
                    enlightenment: 1,
                    luck: 1,
                    taoism: 1,
                    maxSpirit: 100,
                    maxEnergy: 100
                };

                gameState.inventory = {
                    herbs: 0,
                    talismans: 0,
                    potions: 0,
                    stones: 0
                };

                gameState.currentActivity = null;
                gameState.afk = false;
                gameState.timeElapsed = 0;

                // ÈáçÁΩÆÊåëÊàòÁä∂ÊÄÅ
                gameState.challenges.forEach(challenge => {
                    challenge.completed = false;
                });

                // ÂàùÂßãÂ≠£ËäÇÂíåÊó∂Èó¥
                gameState.season = 'spring';
                gameState.time = 8;
                gameState.dayTime = true;
                gameState.daysPassed = 1;

                // ËøòÂéüÁî®Êà∑ËÆæÁΩÆ
                gameState.settings = savedSettings;

                // Â¶ÇÊûúÊ≠£Âú®ÊåÇÊú∫ÔºåÂÅúÊ≠¢ÊåÇÊú∫
                if (afkInterval) {
                    stopAfkLoop();
                    elements.toggleAfk.textContent = "ÂºÄÂßãÊåÇÊú∫‰øÆÁÇº";
                    document.getElementById('afk-status').classList.remove('afk-active');
                    const statusValue = document.querySelector('#afk-status .status-value');
                    if (statusValue) {
                        statusValue.textContent = "Êú™ÂºÄÂßã";
                    }
                }

                // Ê∏ÖÁ©∫Êó•Âøó
                const logContainer = document.getElementById('log-container');
                if (logContainer) {
                    logContainer.innerHTML = '';
                }

                // Êõ¥Êñ∞UI
                updateAllUI();

                // ÈáçÊñ∞Ê£ÄÊü•Ê¥ªÂä®Ëß£ÈîÅÁä∂ÊÄÅ
                checkActivityUnlocks();

                // Ê∑ªÂä†ÈáçÁΩÆÊ∏∏ÊàèÁöÑÊó•Âøó
                addLog("Ê∏∏ÊàèÂ∑≤ÈáçÁΩÆÔºåÂºÄÂßãÊñ∞ÁöÑ‰øÆÈÅì‰πãÊóÖÔºÅ", "achievement");
            }
        }

        // ‰ΩøÁî®‰∏πËçØÂäüËÉΩ
        function usePotion() {
            if (gameState.inventory.potions && gameState.inventory.potions > 0) {
                gameState.inventory.potions--;

                // ÊÅ¢Â§ç‰ΩìÂäõÂíåÁ≤æÁ•ûÂäõ
                gameState.stats.energy = gameState.stats.maxEnergy;
                gameState.stats.spirit = gameState.stats.maxSpirit;

                // Â∞èÊ¶ÇÁéáÊèêÂçá‰øÆ‰∏∫
                if (Math.random() < 0.2) {
                    addStat('cultivation', 20);
                    addLog("ÊúçÁî®‰∏πËçØÂêé‰Ω†Á™ÅÁÑ∂È°øÊÇüÔºå‰øÆ‰∏∫Â§ßÂ¢ûÔºÅ", "achievement");
                } else {
                    addLog("ÊúçÁî®‰∏πËçØÊÅ¢Â§ç‰∫Ü‰ΩìÂäõÂíåÁ≤æÁ•ûÂäõÔºÅ");
                }

                // Êõ¥Êñ∞ÁïåÈù¢
                updateStats();
                updateInventory();
            } else {
                addLog("‰Ω†Ê≤°Êúâ‰∏πËçØÂèØÁî®ÔºÅ", "error");
            }
        }

        // ÂêØÂä®Ê∏∏Êàè
        initGame();

        function gotoPage(url) {
            url && window.open(url);
        }
    </script>

    <script>
        // ÂàõÂª∫ÂÖ®Â±ÄÊ†∑ÂºèÂíåÂºπÁ™óÁªìÊûÑÔºàÂÖºÂÆπÁßªÂä®Á´ØÔºâ
        document.addEventListener('DOMContentLoaded', function () {
            const style = document.createElement('style');
            style.textContent = `
    .meal-alert-mask {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 9999;
        display: none;
    }
    .meal-alert-box {
        position: relative;
        width: 80%;
        max-width: 300px;
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    .meal-close-btn {
        display: block;
        margin: 15px auto 0;
        padding: 8px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 12px;
        touch-action: manipulation;
    }
`;
            document.head.appendChild(style);

            const alertHTML = `
    <div class="meal-alert-mask">
        <div class="meal-alert-box">
            <h3>üç¥ Áî®È§êÊó∂Èó¥Âà∞ÔºÅ</h3>
            <p>ËÆ∞ÂæóÂèäÊó∂Ë°•ÂÖÖËÉΩÈáèÂì¶~</p>
            <div style="display: flex;">
                <button class="meal-close-btn" style="background-color: #ffffff;color: #888888;border: 1px solid #888888;">ÂÖ≥Èó≠</button>
                <button class="meal-close-btn meal-open-btn">‰ºòÊÉ†Âç∑</button>
            </div>
        </div>
    </div>
`;
            document.body.insertAdjacentHTML('beforeend', alertHTML);
        });

        // ÂºπÁ™óÊéßÂà∂ÈÄªËæë 
        const mealAlert = {
            init() {
                this.bindEvents();
                this.startTimer();
                // this.showAlert();
            },

            bindEvents() {
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.meal-close-btn')) {
                        this.hideAlert();
                    }

                    if (e.target.closest('.meal-open-btn')) {
                        gotoPage('https://moyugame965.github.io/Coupon/');
                    }
                });
            },

            showAlert() {
                document.querySelector('.meal-alert-mask').style.display = 'block';
            },

            hideAlert() {
                document.querySelector('.meal-alert-mask').style.display = 'none';
            },

            checkTime() {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMin = now.getMinutes();

                // Âú®11:00Âíå17:00Êï¥ÁÇπËß¶ÂèëÔºåËØØÂ∑ÆÊéßÂà∂Âú®1ÂàÜÈíüÂÜÖ 
                if ((currentHour === 11 || currentHour === 12 || currentHour === 17 || currentHour === 18) && currentMin === 0) {
                    this.showAlert();
                }
            },

            startTimer() {
                // ÊØèÂàÜÈíüÊ£ÄÊü•‰∏ÄÊ¨°Êó∂Èó¥ 
                setInterval(() => this.checkTime(), 60000);
                // ÂàùÂßãÂåñÁ´ãÂç≥Ê£ÄÊü•ÔºàÈÅøÂÖçÈ°µÈù¢ÊâìÂºÄÊó∂Ê≠£Â•ΩÂ§Ñ‰∫éÁõÆÊ†áÊó∂Èó¥Ôºâ
                this.checkTime();
            }
        };

        // ÂàùÂßãÂåñ 
        mealAlert.init();
        // setTimeout(() => {
        //     mealAlert.showAlert();
        // }, 2000);

    </script>
</body>

</html>